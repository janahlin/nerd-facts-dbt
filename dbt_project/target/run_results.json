{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.2", "generated_at": "2025-03-24T09:38:06.469072Z", "invocation_id": "f16d65d5-2c5d-4fe8-b97f-dee20f3e33e9", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:50.461394Z", "completed_at": "2025-03-24T09:37:50.476123Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:50.487020Z", "completed_at": "2025-03-24T09:37:51.293783Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.8367135524749756, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.base_metric_relationships", "compiled": true, "compiled_code": "\n\n\n    \n\n\n/* Bigquery won't let us `where` without `from` so we use this workaround */\nwith dummy_cte as (\n    select 1 as foo\n) \n\nselect \n    cast(null as TEXT) as resource_id,\n    cast(null as TEXT) as direct_parent_id,\n    cast(True as boolean) as is_primary_relationship\n\nfrom dummy_cte\nwhere false", "relation_name": "\"nerd_facts\".\"public\".\"base_metric_relationships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:50.482417Z", "completed_at": "2025-03-24T09:37:50.520360Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:50.527368Z", "completed_at": "2025-03-24T09:37:51.279373Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.8153715133666992, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.base_node_relationships", "compiled": true, "compiled_code": "\n\n\n    \n\n/* Bigquery won't let us `where` without `from` so we use this workaround */\nwith dummy_cte as (\n    select 1 as foo\n) \n\nselect \n    cast(null as TEXT) as resource_id,\n    cast(null as TEXT) as direct_parent_id,\n    cast(True as boolean) as is_primary_relationship\n\nfrom dummy_cte\nwhere false", "relation_name": "\"nerd_facts\".\"public\".\"base_node_relationships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:50.440251Z", "completed_at": "2025-03-24T09:37:50.475284Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:50.520892Z", "completed_at": "2025-03-24T09:37:51.288132Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.8502156734466553, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.base_exposure_relationships", "compiled": true, "compiled_code": "\n\n\n    \n\n\n/* Bigquery won't let us `where` without `from` so we use this workaround */\nwith dummy_cte as (\n    select 1 as foo\n) \n\nselect \n    cast(null as TEXT) as resource_id,\n    cast(null as TEXT) as direct_parent_id,\n    cast(True as boolean) as is_primary_relationship\n\nfrom dummy_cte\nwhere false", "relation_name": "\"nerd_facts\".\"public\".\"base_exposure_relationships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:50.470105Z", "completed_at": "2025-03-24T09:37:50.525985Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:50.533135Z", "completed_at": "2025-03-24T09:37:51.343249Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.8833131790161133, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.base_node_columns", "compiled": true, "compiled_code": "\n\n\n    \n\n/* Bigquery won't let us `where` without `from` so we use this workaround */\nwith dummy_cte as (\n    select 1 as foo\n) \n\nselect \n    cast(null as TEXT) as node_unique_id,\n    cast(null as TEXT) as name,\n    cast(null as TEXT) as description,\n    cast(null as TEXT) as data_type,\n    cast(null as TEXT) as constraints,\n    cast(True as boolean) as has_not_null_constraint,\n    cast(0 as integer) as constraints_count,\n    cast(null as TEXT) as quote\n\nfrom dummy_cte\nwhere false", "relation_name": "\"nerd_facts\".\"public\".\"base_node_columns\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:51.320679Z", "completed_at": "2025-03-24T09:37:51.344568Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:51.352900Z", "completed_at": "2025-03-24T09:37:51.829971Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.5123379230499268, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_exposures", "compiled": true, "compiled_code": "\n\n\n    \n\n/* Bigquery won't let us `where` without `from` so we use this workaround */\nwith dummy_cte as (\n    select 1 as foo\n)\n\nselect \n\n    cast(null as TEXT ) as unique_id,\n    cast(null as TEXT ) as name,\n    cast(null as TEXT ) as resource_type,\n    cast(null as TEXT ) as file_path,\n    cast(True as boolean) as is_described,\n    cast(null as TEXT ) as exposure_type,\n    cast(null as TEXT ) as maturity,\n    cast(null as TEXT ) as package_name,\n    cast(null as TEXT ) as url,\n    cast(null as TEXT ) as owner_name,\n    cast(null as TEXT ) as owner_email,\n    cast(null as TEXT ) as meta\n\nfrom dummy_cte\nwhere false", "relation_name": "\"nerd_facts\".\"public\".\"stg_exposures\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:51.329875Z", "completed_at": "2025-03-24T09:37:51.358174Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:51.362277Z", "completed_at": "2025-03-24T09:37:51.836813Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.5273492336273193, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_metrics", "compiled": true, "compiled_code": "\n\n\n    \n\n/* Bigquery won't let us `where` without `from` so we use this workaround */\nwith dummy_cte as (\n    select 1 as foo\n)\n\nselect \n\n    cast(null as TEXT) as unique_id,\n    cast(null as TEXT) as name,\n    cast(null as TEXT) as resource_type,\n    cast(null as TEXT) as file_path,\n    cast(True as boolean) as is_described,\n    cast(null as TEXT) as metric_type,\n    cast(null as TEXT) as label,\n    cast(null as TEXT) as package_name,\n    cast(null as TEXT) as metric_filter,\n    cast(null as TEXT) as metric_measure,\n    cast(null as TEXT) as metric_measure_alias,\n    cast(null as TEXT) as numerator,\n    cast(null as TEXT) as denominator,\n    cast(null as TEXT) as expr,\n    cast(null as TEXT) as metric_window,\n    cast(null as TEXT) as grain_to_date,\n    cast(null as TEXT) as meta\n\nfrom dummy_cte\nwhere false", "relation_name": "\"nerd_facts\".\"public\".\"stg_metrics\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:51.307053Z", "completed_at": "2025-03-24T09:37:51.343908Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:51.345701Z", "completed_at": "2025-03-24T09:37:51.885416Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.5944626331329346, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.base_source_columns", "compiled": true, "compiled_code": "\n\n\n    \n\n/* Bigquery won't let us `where` without `from` so we use this workaround */\nwith dummy_cte as (\n    select 1 as foo\n) \n\nselect \n    cast(null as TEXT) as node_unique_id,\n    cast(null as TEXT) as name,\n    cast(null as TEXT) as description,\n    cast(null as TEXT) as data_type,\n    cast(null as TEXT) as constraints,\n    cast(True as boolean) as has_not_null_constraint,\n    cast(0 as integer) as constraints_count,\n    cast(null as TEXT) as quote\n\nfrom dummy_cte\nwhere false", "relation_name": "\"nerd_facts\".\"public\".\"base_source_columns\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:51.369796Z", "completed_at": "2025-03-24T09:37:51.389372Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:51.389905Z", "completed_at": "2025-03-24T09:37:51.878258Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.5221185684204102, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_naming_convention_folders", "compiled": true, "compiled_code": "\n\n\n\n\n\n  \n\n  \n\n  \n\n  \n\n  \n\n\nwith vars_folders_table as (\n    \n        select 'base_folder_name' as var_name, 'base' as var_value\n        union all\n        select 'staging_folder_name' as var_name, 'staging' as var_value\n        union all\n        select 'intermediate_folder_name' as var_name, 'intermediate' as var_value\n        union all\n        select 'marts_folder_name' as var_name, 'marts' as var_value\n        \n)\n\nselect\n    var_name as folder_name, \n    \n\n    replace(\n        var_name,\n        \n  \n    '_folder_name'\n  \n,\n        ''\n    )\n\n\n as model_type,\n    var_value as folder_name_value\nfrom vars_folders_table", "relation_name": "\"nerd_facts\".\"public\".\"stg_naming_convention_folders\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:51.855340Z", "completed_at": "2025-03-24T09:37:51.883908Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:51.891598Z", "completed_at": "2025-03-24T09:37:52.056210Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.22835230827331543, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_naming_convention_prefixes", "compiled": true, "compiled_code": "\n\n\n\n\n\n  \n\n  \n\n  \n\n  \n\n  \n\n\nwith vars_prefix_table as (\n    \n            select 'base_prefixes' as var_name, 'base_' as var_value\n            union all\n            select 'staging_prefixes' as var_name, 'stg_' as var_value\n            union all\n            select 'intermediate_prefixes' as var_name, 'int_' as var_value\n            union all\n            select 'marts_prefixes' as var_name, 'fct_' as var_value\n            union all\n            select 'marts_prefixes' as var_name, 'dim_' as var_value\n            union all\n            select 'other_prefixes' as var_name, 'rpt_' as var_value\n            \n),\n\nparsed as (\n\nselect\n    var_name as prefix_name, \n    \n\n    replace(\n        var_name,\n        \n  \n    '_prefixes'\n  \n,\n        ''\n    )\n\n\n as model_type,\n    var_value as prefix_value\nfrom vars_prefix_table\n\n),\n\nfinal as (\n\n    select\n        md5(cast(coalesce(cast(model_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(prefix_value as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as unique_id,\n        *\n    from parsed\n\n)\n\nselect * from final", "relation_name": "\"nerd_facts\".\"public\".\"stg_naming_convention_prefixes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:51.909359Z", "completed_at": "2025-03-24T09:37:51.931946Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:51.934207Z", "completed_at": "2025-03-24T09:37:52.149679Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.40413951873779297, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_netrunner_cards", "compiled": true, "compiled_code": "/*\n  Model: stg_netrunner_cards\n  Description: Standardizes Netrunner card data from the raw source with faction and type enrichment\n\n  \n  Note: This model combines and replaces the previous stg_netrunner.sql model.\n*/\n\nWITH raw_data AS (\n    -- Explicitly list columns to prevent issues if source schema changes\n    SELECT\n        -- Primary identifiers\n        id,\n\n        -- Text fields\n        code,\n        flavor,\n        title,\n        type_code,\n        faction_code,\n        pack_code,\n        illustrator,\n        keywords,        \n        side_code,        \n        text,                      \n        uniqueness, \n        stripped_text,\n        stripped_title,\n\n        -- Numeric fields\n        CASE WHEN agenda_points~E'^[0-9]+$' THEN agenda_points ELSE NULL END AS agenda_points,\n        CASE WHEN position~E'^[0-9]+$' THEN position ELSE NULL END AS position,\n        CASE WHEN quantity~E'^[0-9]+$' THEN quantity ELSE NULL END AS quantity,\n        CASE WHEN deck_limit~E'^[0-9]+$' THEN deck_limit ELSE NULL END AS deck_limit,\n        CASE WHEN minimum_deck_size~E'^[0-9]+$' THEN minimum_deck_size ELSE NULL END AS minimum_deck_size,\n        CASE WHEN memory_cost~E'^[0-9]+$' THEN memory_cost ELSE NULL END AS memory_cost,\n        CASE WHEN influence_limit~E'^[0-9]+$' THEN influence_limit ELSE NULL END AS influence_limit,\n        CASE WHEN strength~E'^[0-9]+$' THEN strength ELSE NULL END AS strength,\n        CASE WHEN base_link~E'^[0-9]+$' THEN base_link ELSE NULL END AS base_link,\n        CASE WHEN cost~E'^[0-9]+$' THEN cost ELSE NULL END AS cost,\n        CASE WHEN trash_cost~E'^[0-9]+$' THEN trash_cost ELSE NULL END AS trash_cost,\n        CASE WHEN faction_cost~E'^[0-9]+$' THEN faction_cost ELSE NULL END AS faction_cost,\n        CASE WHEN advancement_cost~E'^[0-9]+$' THEN advancement_cost ELSE NULL END AS advancement_cost        \n        \n    FROM \"nerd_facts\".\"raw\".\"netrunner_cards\"\n    WHERE code IS NOT NULL -- Ensure we don't include invalid entries\n)\n\nSELECT    \n    -- Primary identifiers\n    id as card_id,\n\n    -- Text fields\n    code,\n    flavor,\n    title as card_name,\n    type_code,\n    faction_code,\n    pack_code,\n    illustrator,\n    keywords,        \n    side_code,        \n    text,                      \n    uniqueness, \n    stripped_text,\n    stripped_title,\n\n    -- Numeric fields\n    CAST(agenda_points AS NUMERIC) AS agenda_points,\n    CAST(position AS NUMERIC) AS position,\n    CAST(quantity AS NUMERIC) AS quantity,\n    CAST(deck_limit AS NUMERIC) AS deck_limit,\n    CAST(minimum_deck_size AS NUMERIC) AS minimum_deck_size,\n    CAST(memory_cost AS NUMERIC) AS memory_cost,\n    CAST(influence_limit AS NUMERIC) AS influence_limit,\n    CAST(strength AS NUMERIC) AS strength,\n    CAST(base_link AS NUMERIC) AS base_link,\n    CAST(cost AS NUMERIC) AS cost,\n    CAST(trash_cost AS NUMERIC) AS trash_cost,\n    CAST(faction_cost AS NUMERIC) AS faction_cost,\n    CAST(advancement_cost AS NUMERIC) AS advancement_cost,\n\n    -- Add data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at  \n        \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_netrunner_cards\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:51.921139Z", "completed_at": "2025-03-24T09:37:51.933795Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:51.941232Z", "completed_at": "2025-03-24T09:37:52.673300Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.7541122436523438, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_sources", "compiled": true, "compiled_code": "\n\n\n    \n\n\n/* Bigquery won't let us `where` without `from` so we use this workaround */\nwith dummy_cte as (\n    select 1 as foo\n)\n\nselect \n\n    cast(null as TEXT) as unique_id,\n    cast(null as TEXT) as name,\n    cast(null as TEXT) as file_path,\n    cast(null as TEXT) as alias,\n    cast(null as TEXT) as resource_type,\n    cast(null as TEXT) as source_name,\n    cast(True as boolean) as is_source_described,\n    cast(True as boolean) as is_described,\n    cast(True as boolean) as is_enabled,\n    cast(null as TEXT) as loaded_at_field,\n    cast(True as boolean) as is_freshness_enabled,\n    cast(null as TEXT) as database,\n    cast(null as TEXT) as schema,\n    cast(null as TEXT) as package_name,\n    cast(null as TEXT) as loader,\n    cast(null as TEXT) as identifier,\n    cast(null as TEXT)  as meta,\n    cast(True as boolean) as is_excluded\n\nfrom dummy_cte\nwhere false", "relation_name": "\"nerd_facts\".\"public\".\"stg_sources\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:52.317488Z", "completed_at": "2025-03-24T09:37:52.389930Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:52.442185Z", "completed_at": "2025-03-24T09:37:53.370036Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.1302869319915771, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_netrunner_factions", "compiled": true, "compiled_code": "/*\n  Model: stg_netrunner_factions\n  Description: Standardizes Netrunner faction data from the raw source\n  Source: raw.netrunner_factions\n  \n*/\n\nWITH raw_data AS (\n    -- Select all relevant columns from source\n    SELECT\n        -- Primary identifiers\n        id, \n\n        -- Text fields\n        code,\n        name,\n        side_code,\n        is_mini,\n        is_neutral,\n        color \n    FROM \"nerd_facts\".\"raw\".\"netrunner_factions\"\n    WHERE code IS NOT NULL -- Ensure we don't include invalid entries\n)\n\nSELECT\n         -- Primary identifiers\n        id as faction_id, \n\n        -- Text fields\n        code,\n        name as faction_name,\n        side_code,\n        is_mini,\n        is_neutral,\n        color,\n    \n    -- Track record creation\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_netrunner_factions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:52.677262Z", "completed_at": "2025-03-24T09:37:52.680041Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:52.680460Z", "completed_at": "2025-03-24T09:37:53.521414Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.850632905960083, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_pokeapi_abilities", "compiled": true, "compiled_code": "/*\n  Model: stg_pokeapi_abilities\n  Description: Standardizes Pok\u00e9mon ability data from the PokeAPI\n*/\n\nWITH raw_data AS (\n    -- Explicitly list columns to prevent issues if source schema changes\n    SELECT\n        -- Primary identifiers\n        id,\n\n        -- Text fields\n        name,\n        is_main_series,\n\n        -- Generation information with explicit JSONB casting\n        flavor_text_entries,\n        effect_entries,\n        effect_changes,\n        names,\n        generation, \n        pokemon\n    FROM raw.pokeapi_abilities\n    WHERE id IS NOT NULL\n)\n\n\nSELECT\n    -- Primary identifiers\n    id as ability_id,\n    name AS ability_name,\n\n    -- Text fields  \n    is_main_series,\n\n    -- Generation information with explicit JSONB casting    \n    flavor_text_entries,\n    effect_entries,\n    effect_changes,\n    names,\n    generation,    \n    pokemon,    \n\n    -- Add data tracking fields\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_pokeapi_abilities\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:52.462694Z", "completed_at": "2025-03-24T09:37:52.558598Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:52.575216Z", "completed_at": "2025-03-24T09:37:53.533897Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.1503891944885254, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_netrunner_packs", "compiled": true, "compiled_code": "/*\n  Model: stg_netrunner_packs\n  Description: Standardizes Netrunner card pack data from the raw source\n  Source: raw.netrunner_packs\n  \n  Packs represent the physical card sets released for Netrunner, such as core sets,\n  deluxe expansions, and data packs within a cycle.\n*/\n\nWITH raw_data AS (\n    -- Explicitly list columns to prevent issues if source schema changes\n    SELECT\n        -- Primary identifiers\n        id,\n\n        -- Text fields\n        code,\n        name,\n        cycle_code,\n\n        -- Numeric fields\n        CASE WHEN(position~E'^[0-9]+$') THEN position ELSE NULL END AS position,\n        CASE WHEN(size~E'^[0-9]+$') THEN size ELSE NULL END AS size,\n        CASE WHEN ffg_id~E'^[0-9]+$' THEN ffg_id ELSE NULL END AS ffg_id,\n\n        -- Date fields\n        date_release\n                \n    FROM \"nerd_facts\".\"raw\".\"netrunner_packs\"  -- Updated to use source macro\n    WHERE code IS NOT NULL -- Filter out invalid entries\n)\n\nSELECT\n    -- Primary identifiers\n    id AS pack_id,\n\n    -- Text fields\n    code,\n    name as pack_name,\n    cycle_code,\n\n    -- Numeric fields\n    CAST(position AS NUMERIC) AS position,\n    CAST(size AS NUMERIC) AS size,\n    CAST(ffg_id AS NUMERIC) AS ffg_id, \n\n    -- Date fields\n    date_release AS release_at,\n    \n    -- Add data tracking fields\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_netrunner_packs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:53.723607Z", "completed_at": "2025-03-24T09:37:53.773985Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:53.791635Z", "completed_at": "2025-03-24T09:37:54.019279Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.36664724349975586, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_pokeapi_moves", "compiled": true, "compiled_code": "\n\n/*\n  Model: stg_pokeapi_moves\n  Description: Standardizes Pok\u00e9mon move data from the PokeAPI\n  \n  Notes:\n  - Added safe type casting for numeric fields\n*/\n\nWITH raw_data AS (\n    -- Explicitly list columns to prevent issues if source schema changes\n    SELECT\n        -- Primary identifiers\n        id,\n\n        -- Text fields\n        name,\n        \n\n        -- Numeric fields\n        CASE WHEN power~E'^[0-9]+$' THEN power ELSE NULL END AS power,\n        CASE WHEN pp~E'^[0-9]+$' THEN pp ELSE NULL END AS pp,\n        CASE WHEN accuracy~E'^[0-9]+$' THEN accuracy ELSE NULL END AS accuracy,\n        CASE WHEN priority~E'^[0-9]+$' THEN priority ELSE NULL END AS priority,\n        CASE WHEN effect_chance~E'^[0-9]+$' THEN effect_chance ELSE NULL END AS effect_chance,        \n\n        -- JSON fields\n        damage_class,\n        contest_combos,\n        contest_type,\n        contest_effect,\n        effect_changes,\n        effect_entries,\n        flavor_text_entries,\n        generation,\n        learned_by_pokemon,\n        machines,\n        meta,\n        names,\n        past_values,\n        stat_changes,\n        type,\n        target\n    FROM \"nerd_facts\".\"raw\".\"pokeapi_moves\"\n    WHERE id IS NOT NULL\n)\n\n\n\nSELECT\n    -- Primary identifiers\n    id as move_id,\n\n    -- Text fields\n    name as move_name,\n    \n\n    -- Numeric fields\n    CAST(power AS NUMERIC) AS power,\n    CAST(pp AS NUMERIC) AS pp,\n    CAST(accuracy AS NUMERIC) AS accuracy,\n    CAST(priority AS NUMERIC) AS priority,\n    CAST(effect_chance AS NUMERIC) AS effect_chance,\n\n    -- JSON fields\n    damage_class,\n    contest_combos,\n    contest_type,\n    contest_effect,\n    effect_changes,\n    effect_entries,\n    flavor_text_entries,\n    generation,\n    learned_by_pokemon,\n    machines,\n    meta,\n    names,\n    past_values,\n    stat_changes,\n    type,\n    target,\n    -- Source tracking - removed missing source fields\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_pokeapi_moves\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:51.870751Z", "completed_at": "2025-03-24T09:37:51.908525Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:51.913635Z", "completed_at": "2025-03-24T09:37:54.020506Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.1757097244262695, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_nodes", "compiled": true, "compiled_code": "\n\n\n    \n\n\n/* Bigquery won't let us `where` without `from` so we use this workaround */\nwith dummy_cte as (\n    select 1 as foo\n)\n\nselect \n\n    cast(null as TEXT) as unique_id,\n    cast(null as TEXT) as name,\n    cast(null as TEXT) as resource_type,\n    cast(null as TEXT) as file_path,\n    cast(True as boolean) as is_enabled,\n    cast(null as TEXT) as materialized,\n    cast(null as TEXT) as on_schema_change,\n    cast(null as TEXT) as model_group,\n    cast(null as TEXT) as access,\n    cast(null as TEXT) as latest_version,\n    cast(null as TEXT) as version,\n    cast(null as TEXT) as deprecation_date,\n    cast(True as boolean) as is_contract_enforced,\n    cast(0 as integer) as total_defined_columns,\n    cast(0 as integer) as total_described_columns,\n    cast(null as TEXT) as database,\n    cast(null as TEXT) as schema,\n    cast(null as TEXT) as package_name,\n    cast(null as TEXT) as alias,\n    cast(True as boolean) as is_described,\n    cast(null as TEXT) as column_name,\n    cast(null as TEXT) as meta,\n    cast(null as TEXT) as hard_coded_references,\n    cast(null as integer) as number_lines,\n    cast(null as float) as sql_complexity,\n    cast(null as TEXT) as macro_dependencies,\n    cast(True as boolean) as is_generic_test,\n    cast(True as boolean) as is_excluded\n\nfrom dummy_cte\nwhere false", "relation_name": "\"nerd_facts\".\"public\".\"stg_nodes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:53.720968Z", "completed_at": "2025-03-24T09:37:53.732321Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:53.763760Z", "completed_at": "2025-03-24T09:37:54.048893Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.33020710945129395, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_pokeapi_pokemon", "compiled": true, "compiled_code": "/*\n  Model: stg_pokeapi_pokemon\n  Description: Standardizes Pok\u00e9mon data from the PokeAPI\n  Source: raw.pokeapi_pokemon\n  \n*/\n\nWITH raw_data AS (\n    -- Explicitly list columns to prevent issues if source schema changes\n    SELECT\n        -- Primary identifiers\n        id,\n\n        -- Text fields\n        name,\n        is_default,\n\n        -- Numeric fields\n        CASE WHEN height~E'^[0-9]+$' THEN height ELSE NULL END AS height,\n        CASE WHEN weight~E'^[0-9]+$' THEN weight ELSE NULL END AS weight,\n        CASE WHEN bmi~E'^[0-9]+[.][0-9]+$' THEN bmi ELSE NULL END AS bmi,\n        CASE WHEN base_experience~E'^[0-9]+$' THEN base_experience ELSE NULL END AS base_experience,\n        CASE WHEN \"order\"~E'^[0-9]+$' THEN \"order\" ELSE NULL END AS pokemon_order,        \n\n        -- JSON fields\n        abilities,\n        cries,\n        forms,\n        game_indices,\n        held_items,\n        location_area_encounters,\n        moves,\n        past_abilities,\n        past_types,      \n        stats,                \n        species,\n        sprites,\n        types        \n    FROM raw.pokeapi_pokemon\n    WHERE id IS NOT NULL\n)\n\nSELECT\n    -- Primary identifiers\n    id as pokemon_id,\n\n    -- Text fields\n    name as pokemon_name,\n    is_default,\n\n    -- Numeric fields\n    CAST(height AS NUMERIC) AS height,\n    CAST(weight AS NUMERIC) AS weight,\n    CAST(bmi AS NUMERIC) AS bmi,\n    CAST(base_experience AS NUMERIC) AS base_experience,\n    CAST(pokemon_order AS NUMERIC) AS pokemon_order,\n\n    -- JSON fields\n    abilities,\n    cries,\n    forms,\n    game_indices,\n    held_items,\n    location_area_encounters,\n    moves,\n    past_abilities,\n    past_types,      \n    stats,                \n    species,\n    sprites,\n    types,\n\n    -- Add data tracking fields\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:53.636656Z", "completed_at": "2025-03-24T09:37:53.723128Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:53.727048Z", "completed_at": "2025-03-24T09:37:54.042880Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.508561372756958, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_pokeapi_items", "compiled": true, "compiled_code": "/*\n  Model: stg_pokeapi_items\n  Description: Standardizes Pok\u00e9mon item data from the PokeAPI\n  Source: raw.pokeapi_items\n  \n  Notes:  \n  - Fixed type casting issues with numeric fields\n*/\n\nWITH raw_data AS (\n    -- Explicitly list columns to prevent issues if source schema changes\n    SELECT\n        -- Primary identifiers\n        id,\n\n        -- Text fields\n        name,        \n\n        -- Numeric fields\n        CASE WHEN cost ~ E'^[0-9]+$' THEN cost ELSE NULL END AS cost,\n        CASE WHEN fling_power ~ E'^[0-9]+$' THEN fling_power ELSE NULL END AS fling_power,\n\n        -- JSON fields\n        attributes,\n        baby_trigger_for,\n        category,\n        effect_entries, \n        flavor_text_entries,       \n        fling_effect,\n        game_indices,\n        held_by_pokemon,\n        names,\n        machines,        \n        sprites\n    FROM raw.pokeapi_items\n    WHERE id IS NOT NULL\n)\n\nSELECT\n         -- Primary identifiers\n        id as item_id,\n\n        -- Text fields\n        name as item_name,        \n\n        -- Numeric fields\n        CAST(cost AS NUMERIC) AS cost,\n        CAST(fling_power AS NUMERIC) AS fling_power,        \n\n        -- JSON fields\n        attributes,\n        baby_trigger_for,\n        category,\n        effect_entries, \n        flavor_text_entries,       \n        fling_effect,\n        game_indices,\n        held_by_pokemon,\n        names,\n        machines,        \n        sprites,\n    -- Add data tracking fields\n    CURRENT_TIMESTAMP AS dbt_loaded_at    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_pokeapi_items\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:54.037806Z", "completed_at": "2025-03-24T09:37:54.049482Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:54.056181Z", "completed_at": "2025-03-24T09:37:54.188090Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.15681838989257812, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_swapi_films", "compiled": true, "compiled_code": "\n\n/*\n  Model: stg_swapi_films\n  Description: Standardizes Star Wars film data from SWAPI\n  Source: raw.swapi_films\n  \n  Notes:\n  - Numeric fields are cleaned and converted to proper types  \n*/\n\nWITH raw_data AS (\n    -- Explicitly list columns to prevent issues if source schema changes\n    SELECT\n        -- Id fields\n        id,\n        episode_id,\n\n        -- Text fields\n        title,        \n        opening_crawl,\n        director,\n        producer,\n        url,\n\n        -- Date fields\n        release_date,\n        created,\n        edited,\n\n        -- Relationship arrays\n        planets,\n        starships,\n        vehicles,\n        species,\n        characters                        \n    FROM \"nerd_facts\".\"raw\".\"swapi_films\"\n    WHERE id IS NOT NULL\n)\n\nSELECT\n        -- Id fields\n        id as film_id,\n        CAST(episode_id AS INTEGER) AS episode_id,\n\n        -- Text fields\n        title,        \n        opening_crawl,\n        director,\n        producer,\n        url,\n\n        -- Date fields\n        CAST(release_date as DATE) AS release_date,\n\n        -- Timestamp fields\n        CAST(created as TIMESTAMP) AS created_at,\n        CAST(edited AS TIMESTAMP) AS edited_at,\n\n        -- Relationship arrays\n        planets,\n        starships,\n        vehicles,\n        species,\n        characters,\n\n        -- Add data tracking field\n        CURRENT_TIMESTAMP AS dbt_loaded_at    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_swapi_films\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:54.043320Z", "completed_at": "2025-03-24T09:37:54.053500Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:54.061923Z", "completed_at": "2025-03-24T09:37:54.200861Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.17264628410339355, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_pokeapi_types", "compiled": true, "compiled_code": "/*\n  Model: stg_pokeapi_types\n  Description: Standardizes Pok\u00e9mon type data from the PokeAPI\n  Source: raw.pokeapi_types\n  \n*/\n\nWITH raw_data AS (\n    -- Explicitly list columns to prevent issues if source schema changes\n    SELECT\n        -- Primary identifiers\n        id,\n\n        -- Text fields\n        name,\n\n        -- JSON fields\n        damage_relations,\n        game_indices,\n        generation,\n        move_damage_class,\n        moves,\n        names,\n        past_damage_relations,\n        pokemon,\n        sprites\n    FROM raw.pokeapi_types\n    WHERE id IS NOT NULL\n)\n\n\nSELECT\n    -- Primary identifiers\n    id AS type_id,\n\n    -- Text fields\n    name AS type_name,\n\n    -- JSON fields\n    damage_relations,\n    game_indices,\n    generation,\n    move_damage_class,\n    moves,\n    names,\n    past_damage_relations,\n    pokemon,\n    sprites,\n    -- Add data tracking fields\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_pokeapi_types\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:54.080673Z", "completed_at": "2025-03-24T09:37:54.092675Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:54.093464Z", "completed_at": "2025-03-24T09:37:54.209647Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.13646364212036133, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_swapi_planets", "compiled": true, "compiled_code": "\n\n/*\n  Model: stg_swapi_planets\n  Description: Standardizes Star Wars planet data from SWAPI\n  Source: raw.swapi_planets\n*/\n\nWITH raw_data AS (\n    SELECT\n        -- Identitfiers\n        id,\n\n        -- Text fields\n        name,        \n        climate,\n        gravity,\n        terrain,\n        url,\n\n        -- Numeric fields\n        CASE WHEN surface_water~E'^[0-9]+$' THEN surface_water ELSE NULL END AS surface_water,\n        CASE WHEN rotation_period~E'^[0-9]+$' THEN rotation_period ELSE NULL END AS rotation_period,\n        CASE WHEN orbital_period~E'^[0-9]+$' THEN orbital_period ELSE NULL END AS orbital_period,\n        CASE WHEN diameter~E'^[0-9]+$' THEN diameter ELSE NULL END AS diameter,\n        CASE WHEN population~E'^[0-9]+$' THEN population ELSE NULL END AS population,\n        \n        -- Timestamp fields\n        created,\n        edited\n    FROM \"nerd_facts\".\"raw\".\"swapi_planets\"\n    WHERE id IS NOT NULL\n)\n\nSELECT\n    -- Primary identifiers\n    id as planet_id,\n    name AS planet_name,\n\n    -- Text fields\n    name,        \n    climate,\n    gravity,\n    terrain,\n    url,\n    \n    -- Physical characteristics with proper numeric handling\n    CAST(surface_water AS NUMERIC) AS surface_water,\n    CAST(rotation_period AS NUMERIC) AS rotation_period,\n    CAST(orbital_period AS NUMERIC) AS orbital_period,\n    CAST(diameter AS NUMERIC) AS diameter,        \n    CAST(population AS NUMERIC) AS population,    \n    \n    -- ETL tracking fields\n    CAST(created AS TIMESTAMP) AS created_at,\n    CAST(edited AS TIMESTAMP) AS updated_at,    \n    CURRENT_TIMESTAMP AS dbt_loaded_at    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_swapi_planets\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:54.073535Z", "completed_at": "2025-03-24T09:37:54.086679Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:54.087265Z", "completed_at": "2025-03-24T09:37:54.205610Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.14253687858581543, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_swapi_people", "compiled": true, "compiled_code": "\n\n/*\n  Model: stg_swapi_people\n  Description: Standardizes Star Wars character data from SWAPI\n  Source: raw.swapi_people\n  \n  Notes:\n  - Physical attributes are cleaned and converted to proper numeric types  \n*/\n\nWITH raw_data AS (\n    SELECT\n        -- Id fields\n        id,\n\n        -- Text fields\n        name,\n        \n        hair_color,\n        skin_color,\n        eye_color,\n        birth_year,\n        gender,\n        homeworld,\n        url,\n\n        -- Numeric fields\n        CASE WHEN height~E'^[0-9]+$' THEN height ELSE NULL END AS height,\n        CASE WHEN mass~E'^[0-9]+$' THEN mass ELSE NULL END AS mass,\n\n        -- Timestamp fields\n        created,\n        edited\n    FROM \"nerd_facts\".\"raw\".\"swapi_people\"\n    WHERE id IS NOT NULL\n)\n    select\n        -- Id fields\n        id as people_id,\n\n        -- Text fields\n        name,\n        \n        hair_color,\n        skin_color,\n        eye_color,\n        birth_year,\n        gender,\n        homeworld,\n        url,\n\n        -- Numeric fields\n        CAST(height AS NUMERIC) AS height,\n        CAST(mass AS NUMERIC) AS mass,\n\n        -- Timestamp fields\n        CAST(created AS TIMESTAMP) AS created_at,\n        CAST(edited AS TIMESTAMP) AS edited_at,\n        \n        -- Add data tracking fields\n        CURRENT_TIMESTAMP AS dbt_loaded_at\n        FROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_swapi_people\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:54.224037Z", "completed_at": "2025-03-24T09:37:54.240118Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:54.240669Z", "completed_at": "2025-03-24T09:37:54.426350Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.20778894424438477, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_swapi_starships", "compiled": true, "compiled_code": "\n\nWITH raw_data AS (\n    SELECT\n        -- Id fields\n        id,\n\n        -- Text fields\n        name,\n        model,\n        manufacturer,\n        crew,\n        starship_class,\n        consumables,\n        url,\n\n        -- Numeric fields\n        CASE cost_in_credits~E'[0-9]+$' WHEN TRUE THEN cost_in_credits ELSE NULL END AS cost_in_credits,\n        CASE length~E'[0-9]+$' WHEN TRUE THEN length ELSE NULL END AS length,\n        CASE TRIM(TRAILING 'km' from max_atmosphering_speed)~E'[0-9]+$' WHEN TRUE THEN TRIM(TRAILING 'km' from max_atmosphering_speed) ELSE NULL END AS max_atmosphering_speed,\n        CASE cargo_capacity~E'[0-9]+$' WHEN TRUE THEN cargo_capacity ELSE NULL END AS cargo_capacity,        \n        CASE passengers~E'[0-9]+$' WHEN TRUE THEN passengers ELSE NULL END AS passengers,\n        CASE hyperdrive_rating~E'[0-9]+$' WHEN TRUE THEN hyperdrive_rating ELSE NULL END AS hyperdrive_rating,\n        CASE MGLT~E'[0-9]+$' WHEN TRUE THEN MGLT ELSE NULL END AS MGLT,        \n        \n        -- Relationship arrays\n        pilots,\n        films,\n\n        -- Timestamp fields\n        created,\n        edited\n    FROM \"nerd_facts\".\"raw\".\"swapi_starships\"\n    WHERE id IS NOT NULL\n)\n\nSELECT\n      -- Id fields\n        id as starship_id,\n\n        -- Text fields\n        name AS starship_name,\n        model,\n        manufacturer,\n        crew,\n        starship_class,\n        consumables,\n        url,\n\n        -- Numeric fields\n        CAST(cost_in_credits AS NUMERIC) AS cost_in_credits,\n        CAST(REPLACE(length, ',', '') AS NUMERIC) AS length,\n        CAST(max_atmosphering_speed AS NUMERIC) AS max_atmosphering_speed,\n        CAST(cargo_capacity AS NUMERIC) AS cargo_capacity,        \n        CAST(REPLACE(passengers, ',', '') AS NUMERIC) AS passengers,\n        CAST(hyperdrive_rating AS NUMERIC) AS hyperdrive_rating,\n        CAST(MGLT AS NUMERIC) AS MGLT,        \n        \n        -- Relationship arrays\n        pilots,\n        films,\n\n        -- Timestamp fields\n        CAST(created AS TIMESTAMP) AS created_at,\n        CAST(edited AS TIMESTAMP) AS edited_at,\n\n        -- Data tracking field\n        CURRENT_TIMESTAMP AS dbt_loaded_at \n    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_swapi_starships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:54.246079Z", "completed_at": "2025-03-24T09:37:54.251026Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:54.251844Z", "completed_at": "2025-03-24T09:37:54.437059Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.22712492942810059, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_swapi_species", "compiled": true, "compiled_code": "\n\n/*\n  Model: stg_swapi_species\n  Description: Standardizes Star Wars species data from SWAPI\n  Source: raw.swapi_species\n*/\n\nWITH raw_data AS (\n    SELECT\n        -- Id fields\n        id,\n\n        -- Text fields\n        name,\n        classification,\n        designation,        \n        skin_colors,\n        hair_colors,\n        eye_colors,                \n        language,\n        url,\n\n        -- Numeric fields\n        CASE average_lifespan~E'^[0-9]+$' WHEN TRUE THEN average_lifespan ELSE NULL END AS average_lifespan,\n        CASE average_height~E'^[0-9]+$' WHEN TRUE THEN average_height ELSE NULL END AS average_height,\n\n        -- Relationship arrays\n        people,\n        homeworld,\n\n        -- Timestamp fields\n        created,\n        edited\n    FROM \"nerd_facts\".\"raw\".\"swapi_species\"\n    WHERE id IS NOT NULL\n)\n\nSELECT    \n    -- Id fields\n    id as species_id,\n\n    -- Text fields\n    name as species_name,\n    classification,\n    designation,        \n    skin_colors,\n    hair_colors,\n    eye_colors,                \n    language,\n    url,\n\n    -- Numeric fields\n    CAST(average_lifespan AS NUMERIC) AS average_lifespan,\n    CAST(average_height AS NUMERIC) AS average_height,\n\n    -- Relationship arrays\n    people,\n    homeworld,\n\n    -- Timestamp fields\n    CAST(created AS TIMESTAMP) AS created_at,\n    CAST(edited AS TIMESTAMP) AS edited_at,\n\n    -- Data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_swapi_species\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:54.236624Z", "completed_at": "2025-03-24T09:37:54.249756Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:54.258148Z", "completed_at": "2025-03-24T09:37:54.438907Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.21241235733032227, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.stg_swapi_vehicles", "compiled": true, "compiled_code": "\n\n/*\n  Model: stg_swapi_vehicles\n  Description: Standardizes Star Wars vehicle data from SWAPI\n  Source: raw.swapi_vehicles\n*/\n\nWITH raw_data AS (\n    SELECT\n        -- Identitfiers\n        id,\n\n        -- Text fields\n        name,\n        model,\n        manufacturer,\n        vehicle_class,\n        consumables,\n        url,\n\n        -- Numeric fields\n        CASE cost_in_credits~'^[0-9,.]+$' WHEN TRUE THEN cost_in_credits ELSE null END AS cost_in_credits,\n        CASE length~'^[0-9,.]+$' WHEN TRUE THEN length ELSE null END AS length,        \n        CASE max_atmosphering_speed~'^[0-9,.]+$' WHEN TRUE THEN max_atmosphering_speed ELSE null END AS max_atmosphering_speed,\n        CASE cargo_capacity~'^[0-9,.]+$' WHEN TRUE THEN cargo_capacity ELSE null END AS cargo_capacity,\n        CASE passengers~'^[0-9,.]+$' WHEN TRUE THEN passengers ELSE null END AS passengers,\n        CASE crew~'^[0-9,.]+$' WHEN TRUE THEN crew ELSE null END AS crew,                        \n        \n        -- Relationship arrays\n        pilots,\n        films,\n        \n        -- Timestamp fields        \n        created,\n        edited\n    FROM \"nerd_facts\".\"raw\".\"swapi_vehicles\"\n    WHERE id IS NOT NULL\n)\n\nSELECT\n    id as vehicle_id,\n\n    -- Text fields\n    name as vehicle_name,\n    model,\n    manufacturer,\n    vehicle_class,\n    consumables,\n    url,\n\n    -- Numeric fields\n    CAST(cost_in_credits AS NUMERIC) AS cost_in_credits,\n    CAST(length AS NUMERIC) AS length,\n    CAST(max_atmosphering_speed AS NUMERIC) AS max_atmosphering_speed,\n    CAST(cargo_capacity AS NUMERIC) AS cargo_capacity,\n    CAST(passengers AS NUMERIC) AS passengers,\n    CAST(crew AS NUMERIC) AS crew,                        \n    \n    -- Relationship arrays\n    pilots,\n    films,\n    \n    -- Timestamp fields        \n    CAST(created AS TIMESTAMP) AS created_at,\n    CAST(edited AS TIMESTAMP) AS edited_at,\n\n    -- Data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM raw_data", "relation_name": "\"nerd_facts\".\"public\".\"stg_swapi_vehicles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:54.230346Z", "completed_at": "2025-03-24T09:37:54.251494Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:54.323967Z", "completed_at": "2025-03-24T09:37:54.416560Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.1891343593597412, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_metric_relationships", "compiled": true, "compiled_code": "with \n\n_base_metric_relationships as (\n    select * from \"nerd_facts\".\"public\".\"base_metric_relationships\"\n),\n\nfinal as (\n    select \n        md5(cast(coalesce(cast(resource_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(direct_parent_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as unique_id, \n        *\n    from _base_metric_relationships\n)\n\nselect distinct * from final", "relation_name": "\"nerd_facts\".\"public\".\"stg_metric_relationships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.052330Z", "completed_at": "2025-03-24T09:37:55.109138Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.111186Z", "completed_at": "2025-03-24T09:37:55.222412Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.17930150032043457, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_exposure_relationships", "compiled": true, "compiled_code": "with \n\n_base_exposure_relationships as (\n    select * from \"nerd_facts\".\"public\".\"base_exposure_relationships\"\n),\n\nfinal as (\n    select \n        md5(cast(coalesce(cast(resource_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(direct_parent_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as unique_id, \n        *\n    from _base_exposure_relationships\n)\n\nselect distinct * from final", "relation_name": "\"nerd_facts\".\"public\".\"stg_exposure_relationships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.047043Z", "completed_at": "2025-03-24T09:37:55.101766Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.102350Z", "completed_at": "2025-03-24T09:37:55.270291Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.2276766300201416, "adapter_response": {"_message": "SELECT 363", "code": "SELECT", "rows_affected": 363}, "message": "SELECT 363", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_node_relationships", "compiled": true, "compiled_code": "with \n\n_base_node_relationships as (\n    select * from \"nerd_facts\".\"public\".\"base_node_relationships\"\n),\n\nfinal as (\n    select \n        md5(cast(coalesce(cast(resource_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(direct_parent_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as unique_id, \n        *\n    from _base_node_relationships\n)\n\n-- we need distinct as the graph lists relationships multiple times if they are ref'd multiple times\nselect distinct * from final", "relation_name": "\"nerd_facts\".\"public\".\"stg_node_relationships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.056931Z", "completed_at": "2025-03-24T09:37:55.197118Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.197665Z", "completed_at": "2025-03-24T09:37:55.295036Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.2516293525695801, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.stg_columns", "compiled": true, "compiled_code": "with\n\nfinal as (\n\n    \n    \n\n        (\n            select\n                cast('\"nerd_facts\".\"public\".\"base_node_columns\"' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"node_unique_id\" as text) as \"node_unique_id\" ,\n                    cast(\"name\" as text) as \"name\" ,\n                    cast(\"description\" as text) as \"description\" ,\n                    cast(\"data_type\" as text) as \"data_type\" ,\n                    cast(\"constraints\" as text) as \"constraints\" ,\n                    cast(\"has_not_null_constraint\" as boolean) as \"has_not_null_constraint\" ,\n                    cast(\"constraints_count\" as integer) as \"constraints_count\" ,\n                    cast(\"quote\" as text) as \"quote\" \n\n            from \"nerd_facts\".\"public\".\"base_node_columns\"\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('\"nerd_facts\".\"public\".\"base_source_columns\"' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"node_unique_id\" as text) as \"node_unique_id\" ,\n                    cast(\"name\" as text) as \"name\" ,\n                    cast(\"description\" as text) as \"description\" ,\n                    cast(\"data_type\" as text) as \"data_type\" ,\n                    cast(\"constraints\" as text) as \"constraints\" ,\n                    cast(\"has_not_null_constraint\" as boolean) as \"has_not_null_constraint\" ,\n                    cast(\"constraints_count\" as integer) as \"constraints_count\" ,\n                    cast(\"quote\" as text) as \"quote\" \n\n            from \"nerd_facts\".\"public\".\"base_source_columns\"\n\n            \n        )\n\n        \n)\n\nselect * from final", "relation_name": "\"nerd_facts\".\"public\".\"stg_columns\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.077531Z", "completed_at": "2025-03-24T09:37:55.110388Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.117148Z", "completed_at": "2025-03-24T09:37:55.431462Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.38738083839416504, "adapter_response": {"_message": "SELECT 30425", "code": "SELECT", "rows_affected": 30425}, "message": "SELECT 30425", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_netrunner_cards", "compiled": true, "compiled_code": "/*\n  Model: dim_netrunner_cards\n  Description: Bare minimum dimension table for Android: Netrunner cards\n  \n  Note: No type casting to avoid numeric conversion issues\n*/\n\nSELECT\n    -- Primary identifiers\n    code AS card_code,\n    card_id,\n    card_name,\n    \n    -- Card classifications  \n    type_code,\n    faction_code,\n    side_code,\n    \n    -- Raw values without any casting\n    faction_cost AS influence_cost,\n    cost,\n    \n    -- Boolean value\n    uniqueness AS is_unique_card,\n    \n    -- Pack information\n    pack_code,\n    \n    -- Add tracking\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM \"nerd_facts\".\"public\".\"stg_netrunner_cards\"\nWHERE code IS NOT NULL\nORDER BY side_code, faction_code, type_code", "relation_name": "\"nerd_facts\".\"public\".\"dim_netrunner_cards\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.437822Z", "completed_at": "2025-03-24T09:37:55.452234Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.452886Z", "completed_at": "2025-03-24T09:37:55.611992Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.17575860023498535, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_pokemon_moves", "compiled": true, "compiled_code": "\n\n/*\n  Model: dim_pokemon_moves\n  Description: Dimension table for Pok\u00e9mon moves\n*/\n\nWITH base_moves AS (\n    -- Ensure clean numeric data from source\n    SELECT\n        move_id,\n        move_name,\n        type->>'name' AS move_type,\n        -- Handle numeric conversions safely\n        CASE \n            WHEN power::TEXT ~ '^[0-9]+$' THEN power::INTEGER\n            ELSE NULL \n        END AS power,\n        CASE \n            WHEN pp::TEXT ~ '^[0-9]+$' THEN pp::INTEGER\n            ELSE NULL \n        END AS pp,\n        CASE \n            WHEN accuracy::TEXT ~ '^[0-9]+$' THEN accuracy::INTEGER\n            ELSE NULL \n        END AS accuracy,\n        CASE \n            WHEN priority::TEXT ~ '^[0-9]+$' THEN priority::INTEGER\n            ELSE 0 \n        END AS priority,\n        damage_class->>'name' AS damage_class,\n        jsonb_array_elements(effect_entries::jsonb)->>'effect' AS effect_text,\n        CASE \n            WHEN effect_chance::TEXT ~ '^[0-9]+$' THEN effect_chance::INTEGER\n            ELSE NULL \n        END AS effect_chance,\n        CASE \n            WHEN (generation->>'url')::TEXT ~ 'generation/([0-9]+)/' \n            THEN REGEXP_REPLACE((generation->>'url')::TEXT, '.*generation/([0-9]+)/.*', '\\1')::INTEGER\n            ELSE 1 \n        END AS generation_id\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_moves\"\n    WHERE move_id IS NOT NULL\n),\n\nmove_classifications AS (\n    -- Pre-calculate move classifications to avoid repetition\n    SELECT\n        move_id,\n        move_name,\n        move_type,\n        power,\n        pp,\n        accuracy,\n        priority,\n        damage_class,\n        effect_text,\n        effect_chance,\n        generation_id,\n        -- Add effect category calculation\n        CASE\n            WHEN effect_text LIKE '%boost%' OR \n                 effect_text LIKE '%raise%' OR \n                 effect_text LIKE '%increase%' THEN 'Stat Boost'\n            WHEN effect_text LIKE '%lower%' OR \n                 effect_text LIKE '%decrease%' OR \n                 effect_text LIKE '%reduce%' THEN 'Stat Reduction'\n            WHEN effect_text LIKE '%paralyze%' THEN 'Paralyze'\n            WHEN effect_text LIKE '%burn%' THEN 'Burn'\n            WHEN effect_text LIKE '%poison%' OR \n                 effect_text LIKE '%toxic%' THEN 'Poison'\n            WHEN effect_text LIKE '%sleep%' THEN 'Sleep'\n            WHEN effect_text LIKE '%freeze%' THEN 'Freeze'\n            WHEN effect_text LIKE '%confus%' THEN 'Confusion'\n            WHEN effect_text LIKE '%flinch%' THEN 'Flinch'\n            WHEN effect_text LIKE '%trap%' THEN 'Trap'\n            WHEN effect_text LIKE '%heal%' OR \n                 effect_text LIKE '%restore%' THEN 'Healing'\n            WHEN effect_text LIKE '%protect%' OR \n                 effect_text LIKE '%protect%' THEN 'Protection'\n            WHEN effect_text LIKE '%critical%' THEN 'Critical Hit'\n            WHEN effect_text LIKE '%priority%' OR priority > 0 THEN 'Priority'\n            WHEN damage_class = 'status' THEN 'Status Effect'\n            WHEN power > 0 THEN 'Direct Damage'\n            ELSE 'Other'\n        END AS effect_category\n    FROM base_moves\n)\n\nSELECT\n    -- Primary key\n    md5(cast(coalesce(cast(move_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS move_key,\n    \n    -- Core identifiers\n    move_id,\n    move_name,\n    \n    -- Move attributes\n    move_type,\n    COALESCE(power, 0) AS power,\n    COALESCE(pp, 0) AS pp,\n    COALESCE(accuracy, 0) AS accuracy,\n    COALESCE(priority, 0) AS priority,\n    COALESCE(damage_class, 'physical') AS damage_class,\n    \n    -- Effect information\n    effect_text,\n    COALESCE(effect_chance, 0) AS effect_chance,\n    \n    -- Generation information\n    COALESCE(generation_id, 1) AS generation_id,\n    \n    -- Move category classification\n    CASE\n        WHEN damage_class = 'status' THEN 'Status'\n        WHEN power IS NULL OR power = 0 THEN 'Status'\n        WHEN power < 40 THEN 'Weak'\n        WHEN power < 70 THEN 'Medium'\n        WHEN power < 90 THEN 'Strong'\n        WHEN power < 110 THEN 'Very Strong'\n        ELSE 'Extreme'\n    END AS power_category,\n    \n    -- Accuracy classification\n    CASE\n        WHEN accuracy IS NULL THEN 'Always Hits'\n        WHEN accuracy < 50 THEN 'Very Inaccurate'\n        WHEN accuracy < 70 THEN 'Inaccurate'\n        WHEN accuracy < 85 THEN 'Moderate'\n        WHEN accuracy < 95 THEN 'Accurate'\n        WHEN accuracy < 100 THEN 'Very Accurate'\n        WHEN accuracy = 100 THEN 'Perfect'\n        ELSE 'Unknown'\n    END AS accuracy_category,\n    \n    -- Move effect category based on effect text\n    effect_category,\n    \n    -- Competitive relevance score (1-10)\n    CASE\n        -- Extremely useful moves in competitive\n        WHEN move_name IN ('stealth-rock', 'spikes', 'toxic-spikes', 'defog', 'rapid-spin',\n                   'recover', 'wish', 'protect', 'substitute', 'will-o-wisp',\n                   'scald', 'knock-off', 'u-turn', 'volt-switch', 'toxic',\n                   'thunder-wave', 'dragon-dance', 'swords-dance', 'nasty-plot',\n                   'calm-mind', 'quiver-dance', 'roost', 'leech-seed') THEN 10\n                   \n        -- Very strong attacks and utility moves\n        WHEN (power > 100 AND accuracy >= 90) OR \n             move_name IN ('close-combat', 'earthquake', 'ice-beam', 'thunderbolt',\n                   'flamethrower', 'surf', 'stone-edge', 'focus-blast',\n                   'shadow-ball', 'psyshock', 'earth-power', 'draco-meteor', \n                   'moonblast', 'play-rough', 'gunk-shot', 'brave-bird') THEN 9\n                   \n        -- Strong utility and common attacks\n        WHEN (power >= 80 AND accuracy >= 85) OR\n             move_name IN ('taunt', 'encore', 'trick', 'toxic', 'synthesis', \n                   'aromatherapy', 'heal-bell', 'sticky-web', 'trick-room',\n                   'tailwind', 'moonlight', 'morning-sun') THEN 8\n                   \n        -- Useful moves but not top tier\n        WHEN (power >= 70 AND accuracy >= 80) OR\n             move_name IN ('light-screen', 'reflect', 'hypnosis', 'sleep-powder',\n                   'stun-spore', 'thunder-wave') THEN 7\n                   \n        -- Standard damage moves with decent stats\n        WHEN power >= 60 AND accuracy >= 90 THEN 6\n        \n        -- Status moves without specific utility\n        WHEN damage_class = 'status' THEN 5\n        \n        -- Weak but accurate moves\n        WHEN power < 60 AND accuracy > 90 THEN 4\n        \n        -- Inaccurate moves\n        WHEN accuracy < 80 AND power > 0 THEN 3\n        \n        -- Very weak moves\n        WHEN power < 40 THEN 2\n        \n        -- Other moves\n        ELSE 1\n    END AS competitive_score,\n    \n    -- Move uniqueness rating\n    CASE\n        -- Signature moves\n        WHEN move_name IN ('spacial-rend', 'roar-of-time', 'seed-flare', 'blue-flare',\n                         'bolt-strike', 'fusion-flare', 'fusion-bolt', 'origin-pulse',\n                         'precipice-blades', 'dragon-ascent', 'sacred-fire', 'aeroblast',\n                         'shadow-force', 'doom-desire', 'psycho-boost', 'lunar-dance',\n                         'magma-storm', 'crush-grip', 'judgment', 'secret-sword',\n                         'relic-song', 'light-of-ruin', 'steam-eruption', 'core-enforcer',\n                         'sunsteel-strike', 'moongeist-beam', 'photon-geyser',\n                         'spectral-thief', 'plasma-fists') THEN 'Signature'\n        -- Very rare moves (limited distribution)\n        WHEN move_name IN ('shell-smash', 'quiver-dance', 'tail-glow', 'dragon-dance',\n                   'shift-gear', 'coil', 'geomancy', 'mind-blown', 'oblivion-wing',\n                   'thousand-arrows', 'thousand-waves', 'diamond-storm') THEN 'Very Rare'\n                   \n        -- Rare but distributed moves\n        WHEN move_name IN ('spore', 'dark-void', 'healing-wish', 'lunar-dance', \n                   'shore-up', 'belly-drum', 'fiery-dance', E'king''s-shield',\n                   'spiky-shield', 'baneful-bunker', 'parting-shot') THEN 'Rare'\n                   \n        -- Uncommon moves\n        WHEN move_name IN ('leech-seed', 'aromatherapy', 'heal-bell', 'sticky-web',\n                   'defog', 'rapid-spin', 'extreme-speed', 'sucker-punch',\n                   'bullet-punch', 'aqua-jet', 'mach-punch', 'ice-shard') THEN 'Uncommon'\n                   \n        -- Common coverage moves\n        WHEN move_name IN ('ice-beam', 'thunderbolt', 'flamethrower', 'surf',\n                   'earthquake', 'stone-edge', 'close-combat', 'shadow-ball') THEN 'Standard'\n                   \n        -- Very common moves\n        WHEN move_name IN ('toxic', 'protect', 'rest', 'sleep-talk', 'substitute') THEN 'Common'\n                   \n        -- Handle everything else based on damage class\n        WHEN damage_class = 'status' THEN 'Status'\n        ELSE 'Standard'\n    END AS move_rarity,\n    \n    -- Data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM move_classifications\nORDER BY move_type, power DESC NULLS LAST, move_name", "relation_name": "\"nerd_facts\".\"public\".\"dim_pokemon_moves\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.238471Z", "completed_at": "2025-03-24T09:37:55.254994Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.255524Z", "completed_at": "2025-03-24T09:37:55.782168Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.5453886985778809, "adapter_response": {"_message": "SELECT 30425", "code": "SELECT", "rows_affected": 30425}, "message": "SELECT 30425", "failures": null, "unique_id": "model.nerd_facts_dbt.fact_netrunner_card_power", "compiled": true, "compiled_code": "\n\n/*\n  Model: fact_netrunner_card_power (Ultra-Simplified)\n  Description: Card power metrics from the Netrunner universe\n*/\n\nSELECT\n    md5(cast(coalesce(cast(c.code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS card_key,\n    c.code AS card_id,\n    c.card_name,\n    c.faction_code,\n    c.type_code,\n    c.cost,\n    \n    -- Simplified scoring metrics\n    CASE \n        WHEN c.type_code = 'agenda' THEN COALESCE(c.advancement_cost, 0) * 2\n        WHEN c.type_code IN ('ice', 'program') THEN COALESCE(c.strength, 0) * 3\n        ELSE COALESCE(c.cost, 0) * 2\n    END AS card_power_score,\n    \n    -- Relative power tier\n    CASE \n        WHEN c.type_code = 'agenda' AND COALESCE(c.advancement_cost, 0) >= 5 THEN 'High'\n        WHEN c.type_code IN ('ice', 'program') AND COALESCE(c.strength, 0) >= 4 THEN 'High'\n        WHEN COALESCE(c.cost, 0) >= 4 THEN 'High'\n        WHEN c.type_code = 'agenda' AND COALESCE(c.advancement_cost, 0) >= 3 THEN 'Medium'\n        WHEN c.type_code IN ('ice', 'program') AND COALESCE(c.strength, 0) >= 2 THEN 'Medium'\n        WHEN COALESCE(c.cost, 0) >= 2 THEN 'Medium'\n        ELSE 'Low'\n    END AS power_tier,\n    \n    'netrunner' AS universe,\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM \"nerd_facts\".\"public\".\"stg_netrunner_cards\" c\nWHERE c.code IS NOT NULL\nORDER BY card_power_score DESC", "relation_name": "\"nerd_facts\".\"public\".\"fact_netrunner_card_power\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.619106Z", "completed_at": "2025-03-24T09:37:55.808776Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.809284Z", "completed_at": "2025-03-24T09:37:55.924981Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.30749988555908203, "adapter_response": {"_message": "SELECT 201", "code": "SELECT", "rows_affected": 201}, "message": "SELECT 201", "failures": null, "unique_id": "model.dbt_project_evaluator.int_all_graph_resources", "compiled": true, "compiled_code": "-- one row for each resource in the graph\n\n\n\nwith unioned as (\n\n    \n    \n\n        (\n            select\n                cast('\"nerd_facts\".\"public\".\"stg_nodes\"' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"unique_id\" as text) as \"unique_id\" ,\n                    cast(\"name\" as text) as \"name\" ,\n                    cast(\"resource_type\" as text) as \"resource_type\" ,\n                    cast(\"file_path\" as text) as \"file_path\" ,\n                    cast(\"is_enabled\" as boolean) as \"is_enabled\" ,\n                    cast(\"materialized\" as text) as \"materialized\" ,\n                    cast(\"on_schema_change\" as text) as \"on_schema_change\" ,\n                    cast(\"model_group\" as text) as \"model_group\" ,\n                    cast(\"access\" as text) as \"access\" ,\n                    cast(\"latest_version\" as text) as \"latest_version\" ,\n                    cast(\"version\" as text) as \"version\" ,\n                    cast(\"deprecation_date\" as text) as \"deprecation_date\" ,\n                    cast(\"is_contract_enforced\" as boolean) as \"is_contract_enforced\" ,\n                    cast(\"total_defined_columns\" as integer) as \"total_defined_columns\" ,\n                    cast(\"total_described_columns\" as integer) as \"total_described_columns\" ,\n                    cast(\"database\" as text) as \"database\" ,\n                    cast(\"schema\" as text) as \"schema\" ,\n                    cast(\"package_name\" as text) as \"package_name\" ,\n                    cast(\"alias\" as text) as \"alias\" ,\n                    cast(\"is_described\" as boolean) as \"is_described\" ,\n                    cast(\"column_name\" as text) as \"column_name\" ,\n                    cast(\"meta\" as text) as \"meta\" ,\n                    cast(\"hard_coded_references\" as text) as \"hard_coded_references\" ,\n                    cast(\"number_lines\" as integer) as \"number_lines\" ,\n                    cast(\"sql_complexity\" as double precision) as \"sql_complexity\" ,\n                    cast(\"macro_dependencies\" as text) as \"macro_dependencies\" ,\n                    cast(\"is_generic_test\" as boolean) as \"is_generic_test\" ,\n                    cast(\"is_excluded\" as boolean) as \"is_excluded\" ,\n                    cast(null as text) as \"exposure_type\" ,\n                    cast(null as text) as \"maturity\" ,\n                    cast(null as text) as \"url\" ,\n                    cast(null as text) as \"owner_name\" ,\n                    cast(null as text) as \"owner_email\" ,\n                    cast(null as text) as \"metric_type\" ,\n                    cast(null as text) as \"label\" ,\n                    cast(null as text) as \"metric_filter\" ,\n                    cast(null as text) as \"metric_measure\" ,\n                    cast(null as text) as \"metric_measure_alias\" ,\n                    cast(null as text) as \"numerator\" ,\n                    cast(null as text) as \"denominator\" ,\n                    cast(null as text) as \"expr\" ,\n                    cast(null as text) as \"metric_window\" ,\n                    cast(null as text) as \"grain_to_date\" ,\n                    cast(null as text) as \"source_name\" ,\n                    cast(null as boolean) as \"is_source_described\" ,\n                    cast(null as text) as \"loaded_at_field\" ,\n                    cast(null as boolean) as \"is_freshness_enabled\" ,\n                    cast(null as text) as \"loader\" ,\n                    cast(null as text) as \"identifier\" \n\n            from \"nerd_facts\".\"public\".\"stg_nodes\"\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('\"nerd_facts\".\"public\".\"stg_exposures\"' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"unique_id\" as text) as \"unique_id\" ,\n                    cast(\"name\" as text) as \"name\" ,\n                    cast(\"resource_type\" as text) as \"resource_type\" ,\n                    cast(\"file_path\" as text) as \"file_path\" ,\n                    cast(null as boolean) as \"is_enabled\" ,\n                    cast(null as text) as \"materialized\" ,\n                    cast(null as text) as \"on_schema_change\" ,\n                    cast(null as text) as \"model_group\" ,\n                    cast(null as text) as \"access\" ,\n                    cast(null as text) as \"latest_version\" ,\n                    cast(null as text) as \"version\" ,\n                    cast(null as text) as \"deprecation_date\" ,\n                    cast(null as boolean) as \"is_contract_enforced\" ,\n                    cast(null as integer) as \"total_defined_columns\" ,\n                    cast(null as integer) as \"total_described_columns\" ,\n                    cast(null as text) as \"database\" ,\n                    cast(null as text) as \"schema\" ,\n                    cast(\"package_name\" as text) as \"package_name\" ,\n                    cast(null as text) as \"alias\" ,\n                    cast(\"is_described\" as boolean) as \"is_described\" ,\n                    cast(null as text) as \"column_name\" ,\n                    cast(\"meta\" as text) as \"meta\" ,\n                    cast(null as text) as \"hard_coded_references\" ,\n                    cast(null as integer) as \"number_lines\" ,\n                    cast(null as double precision) as \"sql_complexity\" ,\n                    cast(null as text) as \"macro_dependencies\" ,\n                    cast(null as boolean) as \"is_generic_test\" ,\n                    cast(null as boolean) as \"is_excluded\" ,\n                    cast(\"exposure_type\" as text) as \"exposure_type\" ,\n                    cast(\"maturity\" as text) as \"maturity\" ,\n                    cast(\"url\" as text) as \"url\" ,\n                    cast(\"owner_name\" as text) as \"owner_name\" ,\n                    cast(\"owner_email\" as text) as \"owner_email\" ,\n                    cast(null as text) as \"metric_type\" ,\n                    cast(null as text) as \"label\" ,\n                    cast(null as text) as \"metric_filter\" ,\n                    cast(null as text) as \"metric_measure\" ,\n                    cast(null as text) as \"metric_measure_alias\" ,\n                    cast(null as text) as \"numerator\" ,\n                    cast(null as text) as \"denominator\" ,\n                    cast(null as text) as \"expr\" ,\n                    cast(null as text) as \"metric_window\" ,\n                    cast(null as text) as \"grain_to_date\" ,\n                    cast(null as text) as \"source_name\" ,\n                    cast(null as boolean) as \"is_source_described\" ,\n                    cast(null as text) as \"loaded_at_field\" ,\n                    cast(null as boolean) as \"is_freshness_enabled\" ,\n                    cast(null as text) as \"loader\" ,\n                    cast(null as text) as \"identifier\" \n\n            from \"nerd_facts\".\"public\".\"stg_exposures\"\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('\"nerd_facts\".\"public\".\"stg_metrics\"' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"unique_id\" as text) as \"unique_id\" ,\n                    cast(\"name\" as text) as \"name\" ,\n                    cast(\"resource_type\" as text) as \"resource_type\" ,\n                    cast(\"file_path\" as text) as \"file_path\" ,\n                    cast(null as boolean) as \"is_enabled\" ,\n                    cast(null as text) as \"materialized\" ,\n                    cast(null as text) as \"on_schema_change\" ,\n                    cast(null as text) as \"model_group\" ,\n                    cast(null as text) as \"access\" ,\n                    cast(null as text) as \"latest_version\" ,\n                    cast(null as text) as \"version\" ,\n                    cast(null as text) as \"deprecation_date\" ,\n                    cast(null as boolean) as \"is_contract_enforced\" ,\n                    cast(null as integer) as \"total_defined_columns\" ,\n                    cast(null as integer) as \"total_described_columns\" ,\n                    cast(null as text) as \"database\" ,\n                    cast(null as text) as \"schema\" ,\n                    cast(\"package_name\" as text) as \"package_name\" ,\n                    cast(null as text) as \"alias\" ,\n                    cast(\"is_described\" as boolean) as \"is_described\" ,\n                    cast(null as text) as \"column_name\" ,\n                    cast(\"meta\" as text) as \"meta\" ,\n                    cast(null as text) as \"hard_coded_references\" ,\n                    cast(null as integer) as \"number_lines\" ,\n                    cast(null as double precision) as \"sql_complexity\" ,\n                    cast(null as text) as \"macro_dependencies\" ,\n                    cast(null as boolean) as \"is_generic_test\" ,\n                    cast(null as boolean) as \"is_excluded\" ,\n                    cast(null as text) as \"exposure_type\" ,\n                    cast(null as text) as \"maturity\" ,\n                    cast(null as text) as \"url\" ,\n                    cast(null as text) as \"owner_name\" ,\n                    cast(null as text) as \"owner_email\" ,\n                    cast(\"metric_type\" as text) as \"metric_type\" ,\n                    cast(\"label\" as text) as \"label\" ,\n                    cast(\"metric_filter\" as text) as \"metric_filter\" ,\n                    cast(\"metric_measure\" as text) as \"metric_measure\" ,\n                    cast(\"metric_measure_alias\" as text) as \"metric_measure_alias\" ,\n                    cast(\"numerator\" as text) as \"numerator\" ,\n                    cast(\"denominator\" as text) as \"denominator\" ,\n                    cast(\"expr\" as text) as \"expr\" ,\n                    cast(\"metric_window\" as text) as \"metric_window\" ,\n                    cast(\"grain_to_date\" as text) as \"grain_to_date\" ,\n                    cast(null as text) as \"source_name\" ,\n                    cast(null as boolean) as \"is_source_described\" ,\n                    cast(null as text) as \"loaded_at_field\" ,\n                    cast(null as boolean) as \"is_freshness_enabled\" ,\n                    cast(null as text) as \"loader\" ,\n                    cast(null as text) as \"identifier\" \n\n            from \"nerd_facts\".\"public\".\"stg_metrics\"\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n                cast('\"nerd_facts\".\"public\".\"stg_sources\"' as TEXT) as _dbt_source_relation,\n\n                \n                    cast(\"unique_id\" as text) as \"unique_id\" ,\n                    cast(\"name\" as text) as \"name\" ,\n                    cast(\"resource_type\" as text) as \"resource_type\" ,\n                    cast(\"file_path\" as text) as \"file_path\" ,\n                    cast(\"is_enabled\" as boolean) as \"is_enabled\" ,\n                    cast(null as text) as \"materialized\" ,\n                    cast(null as text) as \"on_schema_change\" ,\n                    cast(null as text) as \"model_group\" ,\n                    cast(null as text) as \"access\" ,\n                    cast(null as text) as \"latest_version\" ,\n                    cast(null as text) as \"version\" ,\n                    cast(null as text) as \"deprecation_date\" ,\n                    cast(null as boolean) as \"is_contract_enforced\" ,\n                    cast(null as integer) as \"total_defined_columns\" ,\n                    cast(null as integer) as \"total_described_columns\" ,\n                    cast(\"database\" as text) as \"database\" ,\n                    cast(\"schema\" as text) as \"schema\" ,\n                    cast(\"package_name\" as text) as \"package_name\" ,\n                    cast(\"alias\" as text) as \"alias\" ,\n                    cast(\"is_described\" as boolean) as \"is_described\" ,\n                    cast(null as text) as \"column_name\" ,\n                    cast(\"meta\" as text) as \"meta\" ,\n                    cast(null as text) as \"hard_coded_references\" ,\n                    cast(null as integer) as \"number_lines\" ,\n                    cast(null as double precision) as \"sql_complexity\" ,\n                    cast(null as text) as \"macro_dependencies\" ,\n                    cast(null as boolean) as \"is_generic_test\" ,\n                    cast(\"is_excluded\" as boolean) as \"is_excluded\" ,\n                    cast(null as text) as \"exposure_type\" ,\n                    cast(null as text) as \"maturity\" ,\n                    cast(null as text) as \"url\" ,\n                    cast(null as text) as \"owner_name\" ,\n                    cast(null as text) as \"owner_email\" ,\n                    cast(null as text) as \"metric_type\" ,\n                    cast(null as text) as \"label\" ,\n                    cast(null as text) as \"metric_filter\" ,\n                    cast(null as text) as \"metric_measure\" ,\n                    cast(null as text) as \"metric_measure_alias\" ,\n                    cast(null as text) as \"numerator\" ,\n                    cast(null as text) as \"denominator\" ,\n                    cast(null as text) as \"expr\" ,\n                    cast(null as text) as \"metric_window\" ,\n                    cast(null as text) as \"grain_to_date\" ,\n                    cast(\"source_name\" as text) as \"source_name\" ,\n                    cast(\"is_source_described\" as boolean) as \"is_source_described\" ,\n                    cast(\"loaded_at_field\" as text) as \"loaded_at_field\" ,\n                    cast(\"is_freshness_enabled\" as boolean) as \"is_freshness_enabled\" ,\n                    cast(\"loader\" as text) as \"loader\" ,\n                    cast(\"identifier\" as text) as \"identifier\" \n\n            from \"nerd_facts\".\"public\".\"stg_sources\"\n\n            \n        )\n\n        \n\n),\n\nnaming_convention_prefixes as (\n    select * from \"nerd_facts\".\"public\".\"stg_naming_convention_prefixes\"\n), \n\nnaming_convention_folders as (\n    select * from \"nerd_facts\".\"public\".\"stg_naming_convention_folders\"\n), \n\nunioned_with_calc as (\n    select \n        *,\n        case \n            when resource_type = 'source' then  source_name || '.' || name\n            when coalesce(version, '') != '' then name || '.v' || version \n            else name \n        end as resource_name,\n        case\n            when resource_type = 'source' then null\n            else \n\n  \n    \n\n    split_part(\n        name,\n        '_',\n        1\n        )\n\n\n  \n\n||'_' \n        end as prefix,\n        \n  \n\n    replace(\n        file_path,\n        regexp_replace(file_path,'.*/',''),\n        ''\n    )\n\n\n\n    \n  \n as directory_path,\n        regexp_replace(file_path,'.*/','') as file_name\n    from unioned\n    where coalesce(is_enabled, True) = True and package_name != 'dbt_project_evaluator'\n), \n\njoined as (\n\n    select\n        unioned_with_calc.unique_id as resource_id, \n        unioned_with_calc.resource_name, \n        unioned_with_calc.prefix, \n        unioned_with_calc.resource_type, \n        unioned_with_calc.file_path, \n        unioned_with_calc.directory_path,\n        unioned_with_calc.is_generic_test,\n        unioned_with_calc.file_name,\n        case \n            when unioned_with_calc.resource_type in ('test', 'source', 'metric', 'exposure', 'seed') then null\n            else nullif(naming_convention_prefixes.model_type, '')\n        end as model_type_prefix,\n        case \n            when unioned_with_calc.resource_type in ('test', 'source', 'metric', 'exposure', 'seed') then null\n            when \n\n    position(\n        \n  \n    '/'\n  \n || naming_convention_folders.folder_name_value || \n  \n    '/'\n  \n in unioned_with_calc.directory_path\n    ) = 0 then null\n            else naming_convention_folders.model_type \n        end as model_type_folder,\n        \n\n    position(\n        \n  \n    '/'\n  \n || naming_convention_folders.folder_name_value || \n  \n    '/'\n  \n in unioned_with_calc.directory_path\n    ) as position_folder,  \n        nullif(unioned_with_calc.column_name, '') as column_name,\n        \n        unioned_with_calc.macro_dependencies like '%macro.dbt.test_not_null%' and unioned_with_calc.resource_type = 'test' as is_test_not_null,  \n        \n        unioned_with_calc.macro_dependencies like '%macro.dbt.test_unique%' and unioned_with_calc.resource_type = 'test' as is_test_unique,  \n        \n        unioned_with_calc.macro_dependencies like '%macro.dbt_utils.test_unique_combination_of_columns%' and unioned_with_calc.resource_type = 'test' as is_test_unique_combination_of_columns,  \n        \n        unioned_with_calc.is_enabled, \n        unioned_with_calc.materialized, \n        unioned_with_calc.on_schema_change, \n        unioned_with_calc.database, \n        unioned_with_calc.schema, \n        unioned_with_calc.package_name, \n        unioned_with_calc.alias, \n        unioned_with_calc.is_described, \n        unioned_with_calc.model_group, \n        unioned_with_calc.access, \n        unioned_with_calc.access = 'public' as is_public, \n        unioned_with_calc.latest_version, \n        unioned_with_calc.version, \n        unioned_with_calc.deprecation_date, \n        unioned_with_calc.is_contract_enforced, \n        unioned_with_calc.total_defined_columns, \n        unioned_with_calc.total_described_columns, \n        unioned_with_calc.exposure_type, \n        unioned_with_calc.maturity, \n        unioned_with_calc.url, \n        unioned_with_calc.owner_name,\n        unioned_with_calc.owner_email,\n        unioned_with_calc.meta,\n        unioned_with_calc.macro_dependencies,\n        unioned_with_calc.metric_type, \n        unioned_with_calc.label, \n        unioned_with_calc.metric_filter,\n        unioned_with_calc.metric_measure,\n        unioned_with_calc.metric_measure_alias,\n        unioned_with_calc.numerator,\n        unioned_with_calc.denominator,\n        unioned_with_calc.expr,\n        unioned_with_calc.metric_window,\n        unioned_with_calc.grain_to_date,\n        unioned_with_calc.source_name, -- NULL for non-source resources\n        unioned_with_calc.is_source_described, \n        unioned_with_calc.loaded_at_field, \n        unioned_with_calc.is_freshness_enabled, \n        unioned_with_calc.loader, \n        unioned_with_calc.identifier,\n        unioned_with_calc.hard_coded_references, -- NULL for non-model resources\n        unioned_with_calc.number_lines, -- NULL for non-model resources\n        unioned_with_calc.sql_complexity, -- NULL for non-model resources\n        unioned_with_calc.is_excluded -- NULL for metrics and exposures\n\n    from unioned_with_calc\n    left join naming_convention_prefixes\n        on unioned_with_calc.prefix = naming_convention_prefixes.prefix_value\n\n    cross join naming_convention_folders   \n\n), \n\ncalculate_model_type as (\n    select \n        *, \n        case \n            when resource_type in ('test', 'source', 'metric', 'exposure', 'seed') then null\n            -- by default we will define the model type based on its prefix in the case prefix and folder types are different\n            else coalesce(model_type_prefix, model_type_folder, 'other') \n        end as model_type,\n        row_number() over (partition by resource_id order by position_folder desc) as folder_name_rank\n    from joined\n),\n\nfinal as (\n    select\n        *\n    from calculate_model_type\n    where folder_name_rank = 1\n)\n\nselect \n    *\nfrom final", "relation_name": "\"nerd_facts\".\"public\".\"int_all_graph_resources\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.934103Z", "completed_at": "2025-03-24T09:37:55.941744Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.942787Z", "completed_at": "2025-03-24T09:38:00.377961Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 4.4457457065582275, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.nerd_facts_dbt.bridge_pokemon_moves", "compiled": true, "compiled_code": "\n\n/*\n  Model: bridge_pokemon_moves\n  Description: Bridge table connecting Pok\u00e9mon to their learnable moves\n  \n  Notes:\n  - Handles the many-to-many relationship between Pok\u00e9mon and moves\n  - Gets moves from raw data since staging doesn't have them\n  - Calculates STAB (Same Type Attack Bonus) and signature move flags\n  - Provides context on move learning methods and levels\n*/\n\nWITH pokemon_base AS (\n    -- Get base Pokemon data from staging\n    SELECT\n        p.pokemon_id,\n        p.pokemon_name,\n        (SELECT jsonb_extract_path_text(pt.type_json::jsonb, 'name')\n         FROM (\n             SELECT\n                 pokemon_id,\n                 jsonb_array_elements(\n                     COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                 )->>'type' AS type_json,\n                 (jsonb_array_elements(\n                     COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                 )->'slot')::int AS type_slot\n             FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n             WHERE p2.pokemon_id = p.pokemon_id\n         ) pt\n         WHERE pt.type_slot = 1\n         LIMIT 1) AS primary_type,\n        (SELECT jsonb_extract_path_text(pt.type_json::jsonb, 'name')\n         FROM (\n             SELECT\n                 pokemon_id,\n                 jsonb_array_elements(\n                     COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                 )->>'type' AS type_json,\n                 (jsonb_array_elements(\n                     COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                 )->'slot')::int AS type_slot\n             FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n             WHERE p2.pokemon_id = p.pokemon_id\n         ) pt\n         WHERE pt.type_slot = 2\n         LIMIT 1) AS secondary_type,\n        -- These fields need to be handled differently as they're not in staging\n        NULL AS generation_number,\n        (SELECT SUM((stat_data->>'base_stat')::integer)\n         FROM (\n             SELECT\n                 pokemon_id,\n                 jsonb_array_elements(\n                     COALESCE(NULLIF(stats::text, 'null')::jsonb, '[]'::jsonb)\n                 ) AS stat_data\n             FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n             WHERE p2.pokemon_id = p.pokemon_id\n         ) st) AS total_base_stats\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n    WHERE p.pokemon_id IS NOT NULL\n),\n\npokemon_moves_raw AS (\n    -- Get moves directly from raw data\n    SELECT\n        id,\n        moves::jsonb AS moves_json\n    FROM raw.pokeapi_pokemon\n    WHERE id IS NOT NULL\n),\n\npokemon_moves AS (\n    -- Extract move references from the raw data with improved error handling\n    SELECT\n        pb.pokemon_id,\n        pb.pokemon_name,\n        pb.primary_type,\n        pb.secondary_type,\n        pb.generation_number,\n        pb.total_base_stats,\n        -- Extract move details from the moves array\n        move_data->'move'->>'name' AS move_name,\n        move_data->'move'->>'type' AS move_type,\n        -- Extract learning method from version group details\n        (\n            SELECT vgd->>'move_learn_method'\n            FROM jsonb_array_elements(move_data->'version_group_details') AS vgd\n            LIMIT 1\n        ) AS learn_method,\n        -- Extract level requirement\n        (\n            SELECT COALESCE((vgd->>'level_learned_at')::integer, 0)\n            FROM jsonb_array_elements(move_data->'version_group_details') AS vgd\n            LIMIT 1\n        ) AS level_learned_at\n    FROM pokemon_base pb\n    JOIN pokemon_moves_raw pmr ON pb.pokemon_id = pmr.id\n    CROSS JOIN LATERAL jsonb_array_elements(\n        COALESCE(NULLIF(pmr.moves_json::text, 'null')::jsonb, '[]'::jsonb)\n    ) AS move_data\n    WHERE pb.pokemon_id IS NOT NULL\n)\n\nSELECT\n    -- Wrap everything in a subquery to use derived columns\n    move_data.*,\n    \n    -- Move priority classification using the now-available is_signature_move column\n    CASE\n        WHEN move_data.is_signature_move THEN 'Signature'\n        WHEN move_data.has_stab AND move_data.level_learned_at <= 20 THEN 'Early STAB'\n        WHEN move_data.has_stab THEN 'STAB'\n        WHEN move_data.learn_method = 'machine' THEN 'TM/HM'\n        WHEN move_data.learn_method = 'tutor' THEN 'Tutor'\n        ELSE 'Standard'\n    END AS move_priority,\n    \n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM (\n    SELECT\n        -- Primary key\n        md5(cast(coalesce(cast(pm.pokemon_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(pm.move_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(pm.learn_method as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(COALESCE(pm.level_learned_at, 0) as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS pokemon_move_id,\n        \n        -- Core identifiers\n        pm.pokemon_id,\n        pm.pokemon_name,\n        pm.move_name,\n        pm.move_type,\n        pm.learn_method,\n        pm.level_learned_at,\n        \n        -- Check if move type matches EITHER Pokemon type (STAB detection)\n        CASE\n            WHEN pm.move_type = pm.primary_type THEN TRUE\n            WHEN pm.move_type = pm.secondary_type AND pm.secondary_type IS NOT NULL THEN TRUE\n            ELSE FALSE\n        END AS has_stab,\n        \n        -- Calculate if this is a signature move\n        CASE\n            -- Name-based detection\n            WHEN pm.move_name LIKE CONCAT('%', pm.pokemon_name, '%') THEN TRUE\n            \n            -- Starter Pok\u00e9mon signature moves\n            WHEN (pm.pokemon_name = 'pikachu' AND pm.move_name = 'volt-tackle') THEN TRUE\n            WHEN (pm.pokemon_name = 'charizard' AND pm.move_name = 'blast-burn') THEN TRUE\n            WHEN (pm.pokemon_name = 'blastoise' AND pm.move_name = 'hydro-cannon') THEN TRUE\n            WHEN (pm.pokemon_name = 'venusaur' AND pm.move_name = 'frenzy-plant') THEN TRUE\n            \n            -- Legendary signature moves\n            WHEN (pm.pokemon_name = 'mewtwo' AND pm.move_name = 'psystrike') THEN TRUE\n            WHEN (pm.pokemon_name = 'lugia' AND pm.move_name = 'aeroblast') THEN TRUE\n            WHEN (pm.pokemon_name = 'ho-oh' AND pm.move_name = 'sacred-fire') THEN TRUE\n            WHEN (pm.pokemon_name = 'kyogre' AND pm.move_name = 'origin-pulse') THEN TRUE\n            WHEN (pm.pokemon_name = 'groudon' AND pm.move_name = 'precipice-blades') THEN TRUE\n            WHEN (pm.pokemon_name = 'rayquaza' AND pm.move_name = 'dragon-ascent') THEN TRUE\n            WHEN (pm.pokemon_name = 'dialga' AND pm.move_name = 'roar-of-time') THEN TRUE\n            WHEN (pm.pokemon_name = 'palkia' AND pm.move_name = 'spacial-rend') THEN TRUE\n            WHEN (pm.pokemon_name = 'giratina' AND pm.move_name = 'shadow-force') THEN TRUE\n            \n            ELSE FALSE\n        END AS is_signature_move,\n        \n        -- Moves learned at level 1 or by evolution are typically important\n        CASE\n            WHEN pm.level_learned_at = 1 OR pm.learn_method = 'evolution' THEN TRUE\n            ELSE FALSE\n        END AS is_natural_move,\n        \n        -- Enhanced learn method classification\n        CASE\n            WHEN pm.learn_method = 'level-up' THEN 'Level Up'\n            WHEN pm.learn_method = 'machine' THEN 'TM/HM'\n            WHEN pm.learn_method = 'egg' THEN 'Egg Move'\n            WHEN pm.learn_method = 'tutor' THEN 'Move Tutor'\n            WHEN pm.learn_method = 'evolution' THEN 'Evolution'\n            WHEN pm.learn_method = 'form-change' THEN 'Form Change'\n            ELSE 'Other'\n        END AS learn_method_type\n        \n    FROM pokemon_moves pm\n) move_data\nORDER BY move_data.pokemon_id, move_data.level_learned_at, move_data.is_signature_move DESC", "relation_name": "\"nerd_facts\".\"public\".\"bridge_pokemon_moves\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.790526Z", "completed_at": "2025-03-24T09:37:55.815574Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.816115Z", "completed_at": "2025-03-24T09:38:00.521696Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 4.732937335968018, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.nerd_facts_dbt.bridge_pokemon_abilities", "compiled": true, "compiled_code": "\n\n/*\n  Model: bridge_pokemon_abilities\n  Description: Bridge table connecting Pok\u00e9mon to their abilities\n  \n  Notes:\n  - Handles the many-to-many relationship between Pok\u00e9mon and abilities\n  - Modified to access abilities directly from the source table\n  - Calculates synergy scores between Pok\u00e9mon and their abilities\n  - Provides context on whether abilities are hidden or standard\n  - Removed dimension table join until dim_pokemon_abilities is created\n*/\n\n-- First get the core Pok\u00e9mon data we need\nWITH pokemon_data AS (\n    SELECT\n        p.pokemon_id,\n        p.pokemon_name,\n        -- Extract primary type\n        (SELECT jsonb_extract_path_text(pt.type_json::jsonb, 'name')\n         FROM (\n             SELECT\n                 pokemon_id,\n                 jsonb_array_elements(\n                     COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                 )->>'type' AS type_json,\n                 (jsonb_array_elements(\n                     COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                 )->'slot')::int AS type_slot\n             FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n             WHERE p2.pokemon_id = p.pokemon_id\n         ) pt\n         WHERE pt.type_slot = 1\n         LIMIT 1) AS primary_type,\n        -- Extract secondary type\n        (SELECT jsonb_extract_path_text(pt.type_json::jsonb, 'name')\n         FROM (\n             SELECT\n                 pokemon_id,\n                 jsonb_array_elements(\n                     COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                 )->>'type' AS type_json,\n                 (jsonb_array_elements(\n                     COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                 )->'slot')::int AS type_slot\n             FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n             WHERE p2.pokemon_id = p.pokemon_id\n         ) pt\n         WHERE pt.type_slot = 2\n         LIMIT 1) AS secondary_type,\n        -- Extract species data for generation, legendary, mythical\n        (SELECT \n            CASE \n                WHEN gen.gen_num IS NOT NULL THEN gen.gen_num::integer\n                ELSE NULL\n            END\n         FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n         LEFT JOIN LATERAL (\n             SELECT (regexp_matches(jsonb_extract_path_text(species, 'url'), '/generation/([0-9]+)/'))[1] AS gen_num\n             WHERE jsonb_extract_path_text(species, 'url') ~ '/generation/([0-9]+)/'\n         ) gen ON true\n         WHERE p2.pokemon_id = p.pokemon_id) AS generation_number,\n        (SELECT COALESCE(jsonb_extract_path_text(species, 'is_legendary')::boolean, false)\n         FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n         WHERE p2.pokemon_id = p.pokemon_id) AS is_legendary,\n        (SELECT COALESCE(jsonb_extract_path_text(species, 'is_mythical')::boolean, false)\n         FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n         WHERE p2.pokemon_id = p.pokemon_id) AS is_mythical,\n        -- Calculate total base stats\n        (SELECT SUM((stat_data->>'base_stat')::integer)\n         FROM (\n             SELECT\n                 pokemon_id,\n                 jsonb_array_elements(\n                     COALESCE(NULLIF(stats::text, 'null')::jsonb, '[]'::jsonb)\n                 ) AS stat_data\n             FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n             WHERE p2.pokemon_id = p.pokemon_id\n         ) st) AS total_base_stats,\n        -- Count abilities\n        (SELECT COUNT(*)\n         FROM (\n             SELECT\n                 jsonb_array_elements(\n                     COALESCE(NULLIF(abilities::text, 'null')::jsonb, '[]'::jsonb)\n                 ) AS ability_data\n             FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n             WHERE p2.pokemon_id = p.pokemon_id\n         ) ab) AS ability_count\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n    WHERE p.pokemon_id IS NOT NULL\n),\n\n-- Access raw data directly to get the abilities\npokemon_abilities_raw AS (\n    SELECT\n        id,\n        abilities::jsonb AS abilities_json\n    FROM raw.pokeapi_pokemon\n    WHERE id IS NOT NULL\n),\n\n-- Extract ability references from the raw data\npokemon_abilities AS (\n    SELECT\n        pd.pokemon_id,\n        pd.pokemon_name,\n        pd.primary_type,\n        pd.secondary_type,\n        pd.generation_number,\n        pd.is_legendary,\n        pd.is_mythical,\n        pd.total_base_stats,\n        ability_ref->'ability'->>'name' AS ability_name,\n        (ability_ref->>'is_hidden')::boolean AS is_hidden,\n        (ability_ref->>'slot')::integer AS slot_number\n    FROM pokemon_data pd\n    JOIN pokemon_abilities_raw par ON pd.pokemon_id = par.id\n    CROSS JOIN LATERAL jsonb_array_elements(\n        COALESCE(NULLIF(par.abilities_json::text, 'null')::jsonb, '[]'::jsonb)\n    ) AS ability_ref\n    WHERE pd.pokemon_id IS NOT NULL\n)\n\nSELECT\n    -- Primary key\n    md5(cast(coalesce(cast(pa.pokemon_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(pa.ability_name as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS pokemon_ability_id,\n    \n    -- Foreign keys\n    pa.pokemon_id,\n    pa.pokemon_name,\n    pa.ability_name,\n    \n    -- Ability attributes\n    pa.is_hidden,\n    pa.slot_number,\n    \n    -- Pokemon attributes for context\n    pa.primary_type,\n    pa.secondary_type,\n    pa.generation_number,\n    pa.is_legendary,\n    pa.is_mythical,\n    \n    -- Synergy rating between Pokemon and ability\n    CASE\n        -- Top competitive synergies (examples from competitive play)\n        WHEN (pa.pokemon_name = 'gengar' AND pa.ability_name = 'levitate') THEN 5\n        WHEN (pa.pokemon_name = 'gyarados' AND pa.ability_name = 'intimidate') THEN 5\n        WHEN (pa.pokemon_name = 'garchomp' AND pa.ability_name = 'rough-skin') THEN 5\n        WHEN (pa.pokemon_name = 'dragonite' AND pa.ability_name = 'multiscale') THEN 5\n        \n        -- Weather abilities synergy with types\n        WHEN (pa.ability_name LIKE '%drought%' AND pa.primary_type = 'fire') THEN 5\n        WHEN (pa.ability_name LIKE '%drizzle%' AND pa.primary_type = 'water') THEN 5\n        WHEN (pa.ability_name LIKE '%sand-stream%' AND pa.primary_type IN ('rock', 'ground')) THEN 5\n        WHEN (pa.ability_name LIKE '%snow-warning%' AND pa.primary_type = 'ice') THEN 5\n        \n        -- Type boosting abilities\n        WHEN (pa.ability_name LIKE '%blaze%' AND pa.primary_type = 'fire') THEN 4\n        WHEN (pa.ability_name LIKE '%torrent%' AND pa.primary_type = 'water') THEN 4\n        WHEN (pa.ability_name LIKE '%overgrow%' AND pa.primary_type = 'grass') THEN 4\n        \n        -- Legendary/Mythical synergies are often designed to be good\n        WHEN (pa.is_legendary OR pa.is_mythical) AND pa.is_hidden = FALSE THEN 4.5\n        \n        -- Hidden abilities are often better (especially in later generations)\n        WHEN pa.is_hidden AND pa.generation_number >= 5 THEN 4\n        WHEN pa.is_hidden THEN 3.5\n        \n        -- Default synergy (still decent)\n        ELSE 3\n    END AS ability_synergy,\n    \n    -- Competitive relevance indicator (simplified)\n    CASE\n        WHEN pa.ability_name IN (\n            'speed-boost', 'protean', 'intimidate', 'drought', 'drizzle', \n            'sand-stream', 'adaptability', 'huge-power', 'multiscale'\n        ) THEN TRUE\n        WHEN (pa.is_legendary OR pa.is_mythical) AND pa.is_hidden THEN TRUE\n        ELSE FALSE\n    END AS is_competitively_relevant,\n    \n    -- Generation relationship\n    CASE \n        WHEN pa.ability_name IN ('intimidate', 'levitate', 'chlorophyll', \n                              'swift-swim', 'sand-stream', 'drought', 'drizzle') \n             AND pa.generation_number <= 3 THEN 'Original Ability'\n        WHEN pa.generation_number >= 6 AND pa.is_hidden THEN 'Modern Hidden Ability'\n        WHEN pa.is_hidden THEN 'Hidden Ability'\n        ELSE 'Standard Ability'\n    END AS ability_classification,\n    \n    -- Add data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM pokemon_abilities pa\nORDER BY pa.pokemon_id, pa.slot_number", "relation_name": "\"nerd_facts\".\"public\".\"bridge_pokemon_abilities\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:00.387457Z", "completed_at": "2025-03-24T09:38:00.404623Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:00.405169Z", "completed_at": "2025-03-24T09:38:00.597806Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.21216893196105957, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_pokemon_abilities", "compiled": true, "compiled_code": "\n\n/*\n  Model: dim_pokemon_abilities\n  Description: Dimension table for Pok\u00e9mon abilities\n  \n  Notes:\n  - Analyzes ability distribution across all Pok\u00e9mon\n  - Categorizes abilities by effect type and competitive tier\n  - Calculates rarity metrics and battle style classifications\n  - Identifies hidden abilities and their gameplay significance\n  - Provides comprehensive categorization for analysis\n  - Fixed string literals to use proper PostgreSQL escaping\n  - Using E-string syntax for strings containing apostrophes\n  - Maintaining consistent naming format with PokeAPI\n*/\n\nWITH ability_usage AS (\n    -- Count how many Pokemon have each ability with improved error handling\n    SELECT \n        LOWER(COALESCE(ability_ref->'ability'->>'name', 'unknown')) AS ability_name,\n        COUNT(*) AS num_pokemon\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n    CROSS JOIN LATERAL jsonb_array_elements(\n        COALESCE(NULLIF(p.abilities::text, 'null')::jsonb, '[]'::jsonb)\n    ) AS ability_ref\n    WHERE ability_ref->'ability'->>'name' IS NOT NULL\n    GROUP BY ability_ref->'ability'->>'name'\n),\n\n-- Calculate ability rarity percentiles\nability_ranks AS (\n    SELECT\n        ability_name,\n        num_pokemon,\n        PERCENT_RANK() OVER (ORDER BY num_pokemon) AS rarity_percentile\n    FROM ability_usage\n),\n\n-- Classify abilities by effect type with greatly expanded categories\nability_attributes AS (\n    SELECT\n        ability_name,\n        CASE\n            -- Stat modifiers (expanded)\n            WHEN ability_name IN ('Intimidate', 'Moxie', 'Guts', 'Huge Power', 'Pure Power', 'Beast Boost',\n                                'Defiant', 'Contrary', 'Simple', 'Competitive', 'Anger Point', 'Weak Armor',\n                                'Speed Boost', 'Moody', 'Hustle', 'Sheer Force', 'No Guard', 'Technician',\n                                'Tinted Lens', 'Unburden', 'Victory Star') THEN 'Stat Modifier'\n                                \n            -- Immunities (expanded)\n            WHEN ability_name IN ('Levitate', 'Immunity', 'Water Absorb', 'Volt Absorb', 'Flash Fire',\n                                'Motor Drive', 'Lightning Rod', 'Storm Drain', 'Sap Sipper', 'Dry Skin',\n                                'Earth Eater', 'Wonder Guard', 'Soundproof', 'Water Bubble', 'Fluffy',\n                                'Disguise', 'Thick Fat', 'Heatproof', 'Justified', 'Bulletproof', \n                                'Filter', 'Solid Rock', 'Prism Armor', 'Magic Bounce') THEN 'Immunity'\n                                \n            -- Speed control (expanded)\n            WHEN ability_name IN ('Speed Boost', 'Chlorophyll', 'Swift Swim', 'Sand Rush', 'Slush Rush',\n                                'Surge Surfer', 'Quick Feet', 'Unburden', 'Steadfast', 'Slow Start',\n                                'Quick Draw', 'Gale Wings') THEN 'Speed'\n                                \n            -- Weather abilities\n            WHEN ability_name IN ('Drought', 'Drizzle', 'Sand Stream', 'Snow Warning',\n                                'Desolate Land', 'Primordial Sea', 'Delta Stream', \n                                'Sand Spit', 'Ice Face') THEN 'Weather'\n                                \n            -- Damage boosters (expanded)\n            WHEN ability_name IN ('Blaze', 'Torrent', 'Overgrow', 'Swarm', 'Iron Fist',\n                                'Adaptability', 'Aerilate', 'Pixilate', 'Refrigerate', 'Galvanize',\n                                'Solar Power', 'Steelworker', 'Reckless', 'Mega Launcher',\n                                'Strong Jaw', 'Tough Claws', 'Technician', 'Analytic',\n                                'Punk Rock', E'Dragon\\'s Maw', 'Transistor') THEN 'Damage Boost'\n                                \n            -- Opponent effects (expanded)\n            WHEN ability_name IN ('Pressure', 'Unnerve', 'Intimidate', 'Mummy', 'Gooey', 'Tangling Hair',\n                                'Shadow Tag', 'Arena Trap', 'Magnet Pull', 'Stall', 'Cute Charm',\n                                'Rivalry', 'Slow Start', 'Truant', 'Cotton Down', 'Neutralizing Gas',\n                                'Perish Body', 'Gorilla Tactics', 'Intrepid Sword') THEN 'Opponent Effect'\n                                \n            -- Contact effects (expanded)\n            WHEN ability_name IN ('Synchronize', 'Effect Spore', 'Static', 'Flame Body', 'Poison Point',\n                                'Rough Skin', 'Iron Barbs', 'Pickpocket', 'Gooey', 'Tangling Hair',\n                                'Wandering Spirit', 'Cotton Down', 'Mummy', 'Cursed Body',\n                                'Perish Body') THEN 'Contact Effect'\n                                \n            -- Healing abilities\n            WHEN ability_name IN ('Regenerator', 'Natural Cure', 'Shed Skin', 'Poison Heal', \n                                'Hydration', 'Ice Body', 'Rain Dish', 'Healer', 'Water Bubble', \n                                'Ice Face', 'Disguise') THEN 'Healing'\n                                \n            -- Entry hazard abilities\n            WHEN ability_name IN ('Spikes', 'Stealth Rock', 'Sticky Web', 'Toxic Spikes') THEN 'Entry Hazard'\n            \n            -- Form-changing\n            WHEN ability_name IN ('Protean', 'Libero', 'Color Change', 'Forecast', 'Mimicry',\n                                'Stance Change', 'Battle Bond', 'Power Construct', \n                                'Shields Down', 'Schooling') THEN 'Form Change'\n                                \n            -- Defensive abilities\n            WHEN ability_name IN ('Multiscale', 'Shadow Shield', 'Sturdy', 'Battle Armor', 'Shell Armor',\n                                'Filter', 'Solid Rock', 'Prism Armor', 'Fluffy', 'Thick Fat',\n                                'Magic Guard', 'Disguise', 'Ice Face', 'Marvel Scale',\n                                'Friend Guard', 'Dauntless Shield') THEN 'Defensive'\n                                \n            -- Item-related\n            WHEN ability_name IN ('Pickup', 'Honey Gather', 'Frisk', 'Magician', 'Pickpocket',\n                                'Sticky Hold', 'Unburden', 'Klutz', 'Harvest', 'Cheek Pouch',\n                                'Ripen', 'Ball Fetch') THEN 'Item Effect'\n                                \n            -- Status condition-related\n            WHEN ability_name IN ('Immunity', 'Limber', 'Insomnia', 'Vital Spirit', 'Water Veil',\n                                'Magma Armor', 'Oblivious', 'Own Tempo', 'Inner Focus',\n                                'Shield Dust', 'Leaf Guard', 'Pastel Veil', 'Good as Gold') THEN 'Status Prevention'\n            \n            -- Priority move effects\n            WHEN ability_name IN ('Prankster', 'Gale Wings', 'Triage', 'Queenly Majesty', \n                                'Dazzling', 'Armor Tail') THEN 'Priority'\n                                \n            ELSE 'Other'\n        END AS effect_type,\n        \n        -- Expanded competitive tier rankings\n        CASE\n            -- S-Tier: Game-changing abilities\n            WHEN ability_name IN ('Wonder Guard', 'Huge Power', 'Pure Power', 'Speed Boost', \n                               'Drought', 'Drizzle', 'Sand Stream', 'Snow Warning',\n                               'Shadow Tag', 'Intimidate', 'Beast Boost', 'Protean', 'Magic Guard',\n                               'Prankster', 'Unaware', 'Imposter', 'Desolate Land', 'Primordial Sea',\n                               'Delta Stream', 'Soul-Heart', 'Libero', 'Intrepid Sword',\n                               'Gorilla Tactics', 'As One') THEN 'S'\n                               \n            -- A-Tier: Very strong abilities\n            WHEN ability_name IN ('Moxie', 'Adaptability', 'Serene Grace', 'Guts', 'Levitate', \n                               'Multiscale', 'Regenerator', 'Unaware', 'Water Absorb',\n                               'Volt Absorb', 'Disguise', 'Slush Rush', 'Swift Swim', 'Sand Rush',\n                               'Chlorophyll', 'Queenly Majesty', 'Dazzling', 'Sturdy', 'Electric Surge',\n                               'Psychic Surge', 'Grassy Surge', 'Misty Surge', 'Power Construct',\n                               'Shields Down', 'Contrary', 'Mold Breaker', 'Parental Bond') THEN 'A'\n                               \n            -- B-Tier: Good abilities\n            WHEN ability_name IN ('Flash Fire', 'Poison Heal', 'Thick Fat', 'Technician', \n                               'Sheer Force', 'Tinted Lens', 'Fairy Aura', 'Dark Aura',\n                               'Aura Break', 'No Guard', 'Competitive', 'Simple', 'Unburden',\n                               'Mummy', 'Iron Barbs', 'Rough Skin', 'Solar Power', 'Analytic',\n                               'Steelworker', 'Aerilate', 'Pixilate', 'Refrigerate', 'Neuroforce',\n                               'Galvanize', 'Trace') THEN 'B'\n                               \n            -- C-Tier: Average abilities\n            WHEN ability_name IN ('Blaze', 'Torrent', 'Overgrow', 'Swarm', 'Natural Cure', \n                               'Clear Body', 'Sticky Hold', 'Shed Skin', 'Mold Breaker',\n                               'Pressure', 'Synchronize', 'Ice Body', 'Rain Dish', 'Hustle',\n                               'Filter', 'Solid Rock', 'Infiltrator', 'Super Luck', 'Harvest',\n                               'Big Pecks', 'Early Bird', 'Frisk', 'Rock Head', 'Steadfast',\n                               'Sniper', 'Heavy Metal', 'Light Metal', 'Hydration') THEN 'C'\n                               \n            -- D-Tier: Weak or very situational abilities\n            WHEN ability_name IN ('Run Away', 'Honey Gather', 'Illuminate', 'Stench', 'Stall',\n                               'Suction Cups', 'Shell Armor', 'Battle Armor', 'Ball Fetch',\n                               'Pickup', 'Klutz', 'Slow Start', 'Truant', 'Defeatist',\n                               'Forecast', 'Healer', 'Friend Guard', 'Minus', 'Plus', 'Anticipation',\n                               'Flower Gift', 'Forewarn', 'Rivalry', 'Victory Star',\n                               'Leaf Guard', 'Tangled Feet') THEN 'D'\n                               \n            -- F-Tier: Detrimental or extremely niche abilities\n            WHEN ability_name IN ('Defeatist', 'Slow Start', 'Truant', 'Stall', 'Klutz',\n                               'Illuminate', 'Minus', 'Plus', 'Flower Veil', 'Friend Guard') THEN 'F'\n                               \n            ELSE 'Unclassified'\n        END AS tier\n    FROM ability_ranks\n)\n\nSELECT\n    -- Primary key (using surrogate key pattern)\n    md5(cast(coalesce(cast(u.ability_name as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS ability_key,\n    ROW_NUMBER() OVER (ORDER BY u.ability_name) AS ability_id,\n    \n    -- Core attributes\n    u.ability_name,\n    u.num_pokemon,\n    a.effect_type,\n    a.tier,\n    \n    -- Calculate rarity - improved with percentiles\n    CASE\n        WHEN r.rarity_percentile >= 0.95 THEN 'Ultra Rare'\n        WHEN r.rarity_percentile >= 0.80 THEN 'Very Rare'\n        WHEN r.rarity_percentile >= 0.60 THEN 'Rare'\n        WHEN r.rarity_percentile >= 0.40 THEN 'Uncommon'\n        WHEN r.rarity_percentile >= 0.20 THEN 'Common'\n        ELSE 'Very Common'\n    END AS rarity,\n    \n    -- Enhanced hidden ability identification with more comprehensive list\n    CASE\n        WHEN u.ability_name IN (\n            -- Gen 5 Dream World abilities\n            'Analytic', 'Chlorophyll', 'Cloud Nine', 'Damp', 'Defiant', 'Drought', 'Drizzle',\n            'Intimidate', 'Lightningrod', 'Moody', 'Moxie', 'Multiscale', 'Overcoat', 'Poison Touch',\n            'Prankster', 'Rain Dish', 'Regenerator', 'Sand Force', 'Sand Rush', 'Sand Veil',\n            'Serene Grace', 'Sheer Force', 'Sniper', 'Snow Warning', 'Speed Boost', 'Technician',\n            'Telepathy', 'Unaware', 'Unnerve',\n            \n            -- Gen 6 notable hidden abilities\n            'Gale Wings', 'Protean', 'Magic Guard', 'Magic Bounce', 'Harvest', 'Infiltrator',\n            'Tinted Lens', 'Gooey', 'Aroma Veil', 'Bulletproof', 'Magician', 'Pickpocket',\n            \n            -- Gen 7 notable hidden abilities\n            'Power of Alchemy', 'Beast Boost', 'RKS System', 'Slush Rush', 'Surge Surfer',\n            'Water Compaction', 'Queenly Majesty', 'Stamina', 'Water Bubble', 'Steelworker',\n            \n            -- Gen 8 notable hidden abilities with fixed string literals\n            'Libero', 'Quick Draw', 'Ice Scales', 'Punk Rock', 'Mirror Armor', 'Neutralizing Gas',\n            'Power Spot', 'Ripen', 'Steam Engine', 'Sand Spit', 'Cotton Down', 'Gorilla Tactics',\n            \n            -- Other known hidden abilities that are particularly strong\n            'Adaptability', 'Competitive', 'Contrary', 'Cursed Body', 'Guts', 'Hustle', 'Marvel Scale',\n            'No Guard', 'Poison Heal', 'Solar Power', 'Swift Swim', 'Thick Fat', 'Unburden',\n            'Water Absorb', 'Wonder Skin'\n        ) THEN TRUE\n        ELSE FALSE\n    END AS likely_hidden,\n    \n    -- Battle style classification - fixed string literals\n    CASE\n        -- Offensive battle style\n        WHEN a.effect_type IN ('Damage Boost', 'Speed') OR \n             u.ability_name IN ('Moxie', 'Adaptability', 'Beast Boost', 'Huge Power', 'Pure Power',\n                             'Sheer Force', 'Tough Claws', 'Strong Jaw', 'Technician', 'Gorilla Tactics',\n                             'Intrepid Sword', 'Contrary', 'Aerilate', 'Pixilate', 'Refrigerate',\n                             'Galvanize', 'Steelworker', 'Protean', 'Libero', E'dragon''s-maw', 'Transistor',\n                             'Guts', 'No Guard', 'Solar Power', 'Tinted Lens', 'Mega Launcher', 'Sniper')\n        THEN 'Offensive'\n        \n        -- Defensive battle style\n        WHEN a.effect_type IN ('Immunity', 'Defensive', 'Status Prevention', 'Healing') OR\n             u.ability_name IN ('Multiscale', 'Shadow Shield', 'Fur Coat', 'Fluffy', 'Ice Face',\n                             'Disguise', 'Intimidate', 'Filter', 'Solid Rock', 'Prism Armor',\n                             'Sturdy', 'Magic Guard', 'Thick Fat', 'Wonder Guard', 'Levitate',\n                             'Water Absorb', 'Volt Absorb', 'Flash Fire', 'Bulletproof', 'Heatproof',\n                             'Storm Drain', 'Water Bubble', 'Ice Body', 'Marvel Scale', 'Regenerator')\n        THEN 'Defensive'\n        \n        -- Utility battle style\n        WHEN a.effect_type IN ('Weather', 'Entry Hazard', 'Form Change', 'Item Effect', 'Priority') OR\n             u.ability_name IN ('Drought', 'Drizzle', 'Sand Stream', 'Snow Warning', 'Prankster',\n                             'Serene Grace', 'Queenly Majesty', 'Dazzling', 'Magic Bounce', 'Trace',\n                             'Natural Cure', 'Shed Skin', 'Grassy Surge', 'Electric Surge', 'Psychic Surge',\n                             'Misty Surge', 'Harvest', 'Pickpocket', 'Magician', 'Unburden', 'Hydration',\n                             'Lightning Rod', 'Magnet Pull', 'Sticky Hold', 'Stealth Rock')\n        THEN 'Utility'\n        \n        -- Support battle style\n        WHEN a.effect_type IN ('Opponent Effect', 'Contact Effect') OR\n             u.ability_name IN ('Intimidate', 'Unnerve', 'Pressure', 'Mummy', 'Synchronize',\n                             'Effect Spore', 'Static', 'Flame Body', 'Poison Point', 'Gooey',\n                             'Friend Guard', 'Healer', 'Cursed Body', 'Iron Barbs', 'Rough Skin',\n                             'Aftermath', 'Frisk', 'Ice Face', 'Cotton Down', 'Neutralizing Gas',\n                             'Arena Trap', 'Shadow Tag', 'Speed Boost', 'Immunity', 'Rain Dish')\n        THEN 'Support'\n        \n        ELSE 'Balanced'\n    END AS battle_style,\n    \n    -- Generation affinity using comprehensive list\n    CASE\n        -- Gen 1 signature/themed abilities\n        WHEN u.ability_name IN ('Blaze', 'Torrent', 'Overgrow', 'Swarm', 'Static', 'Thick Fat',\n                             'Shell Armor', 'Battle Armor', 'Early Bird', 'Chlorophyll',\n                             'Rock Head', 'Sturdy', 'Guts', 'Run Away', 'Intimidate', 'Clear Body')\n        THEN 1\n        \n        -- Gen 2 signature/themed abilities\n        WHEN u.ability_name IN ('Flash Fire', 'Swift Swim', 'Inner Focus', 'Levitate',\n                             'Forecast', 'Intimidate', 'Shed Skin', 'Rough Skin', 'Pressure',\n                             'Trace', 'Pure Power', 'Huge Power', 'Shadow Tag', 'Wonder Guard',\n                             'Synchronize', 'Natural Cure', 'Lightning Rod', 'Drizzle', 'Drought')\n        THEN 2\n        \n        -- Gen 3 signature/themed abilities\n        WHEN u.ability_name IN ('Sand Stream', 'Truant', 'Slaking', 'Soundproof', 'Magic Guard',\n                             'Compoundeyes', 'Speed Boost', 'Marvel Scale', 'Steadfast',\n                             'Poison Point', 'Air Lock', 'Filter', 'Solid Rock', 'Levitate')\n        THEN 3\n        \n        -- Gen 4 signature/themed abilities\n        WHEN u.ability_name IN ('Adaptability', 'Technician', 'Download', 'Motor Drive',\n                             'Ice Body', 'Snow Warning', 'Snow Cloak', 'Slow Start', 'Bad Dreams',\n                             'Multitype', 'Flower Gift', 'Iron Fist', 'Tinted Lens', 'Scrappy')\n        THEN 4\n        \n        -- Gen 5 signature/themed abilities\n        WHEN u.ability_name IN ('Teravolt', 'Turboblaze', 'Analytic', 'Sand Force', 'Sand Rush',\n                             'Victory Star', 'Zen Mode', 'Defiant', 'Prankster', 'Illusion',\n                             'Moxie', 'Justified', 'Unaware', 'Magic Bounce', 'Heavy Metal')\n        THEN 5\n        \n        -- Gen 6 signature/themed abilities\n        WHEN u.ability_name IN ('Protean', 'Aerilate', 'Pixilate', 'Refrigerate', 'Parental Bond',\n                             'Dark Aura', 'Fairy Aura', 'Aura Break', 'Stance Change', 'Gale Wings',\n                             'Sweet Veil', 'Gooey', 'Bulletproof', 'Competitive', 'Cheek Pouch')\n        THEN 6\n        \n        -- Gen 7 signature/themed abilities\n        WHEN u.ability_name IN ('Beast Boost', 'Disguise', 'RKS System', 'Electric Surge',\n                             'Psychic Surge', 'Grassy Surge', 'Misty Surge', 'Full Metal Body',\n                             'Neuroforce', 'Soul-Heart', 'Schooling', 'Shields Down', 'Fluffy')\n        THEN 7\n        \n        -- Gen 8 signature/themed abilities\n        WHEN u.ability_name IN ('Libero', 'Intrepid Sword', 'Dauntless Shield', 'Ball Fetch',\n                             'Cotton Down', 'Steam Engine', 'Sand Spit', 'Mirror Armor',\n                             'Hunger Switch', 'Ice Face', 'Power Spot', 'Ice Scales', 'Punk Rock',\n                             'Gorilla Tactics', 'Neutralizing Gas', 'Ripen', 'Gulp Missile')\n        THEN 8\n        \n        -- Default to most recent generation\n        ELSE 8\n    END AS generation_affinity,\n    \n    -- Additional stat context\n    CASE\n        WHEN a.effect_type = 'Stat Modifier' THEN\n            CASE\n                WHEN u.ability_name IN ('Huge Power', 'Pure Power', 'Gorilla Tactics',\n                                    'Intrepid Sword', 'Moxie', 'Beast Boost', 'Swords Dance',\n                                    'Dragon Dance') THEN 'Attack'\n                                    \n                WHEN u.ability_name IN ('Solar Power', 'Competitive', 'Beast Boost',\n                                    'Soul-Heart', 'Nasty Plot', 'Calm Mind') THEN 'Special Attack'\n                                    \n                WHEN u.ability_name IN ('Speed Boost', 'Swift Swim', 'Chlorophyll',\n                                    'Sand Rush', 'Slush Rush', 'Unburden', 'Surge Surfer') THEN 'Speed'\n                                    \n                WHEN u.ability_name IN ('Intimidate', 'Fur Coat', 'Marvel Scale',\n                                    'Filter', 'Solid Rock', 'Prism Armor', 'Ice Face') THEN 'Defense'\n                                    \n                WHEN u.ability_name IN ('Multiscale', 'Shadow Shield', 'Natural Cure',\n                                    'Regenerator', 'Hydration', 'Shed Skin') THEN 'HP/Recovery'\n                                    \n                ELSE 'Mixed'\n            END\n        ELSE NULL\n    END AS primary_stat,\n    \n    -- Add data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM ability_usage u\nJOIN ability_ranks r ON u.ability_name = r.ability_name\nJOIN ability_attributes a ON u.ability_name = a.ability_name\nORDER BY u.num_pokemon DESC, u.ability_name", "relation_name": "\"nerd_facts\".\"public\".\"dim_pokemon_abilities\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:00.530973Z", "completed_at": "2025-03-24T09:38:00.542231Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:00.545055Z", "completed_at": "2025-03-24T09:38:00.808656Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2791025638580322, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_pokemon_types", "compiled": true, "compiled_code": "\n\n/*\n  Model: dim_pokemon_types\n  Description: Dimension table for Pok\u00e9mon types and their effectiveness relationships\n  \n  Notes:\n  - Contains comprehensive type effectiveness data (weaknesses, resistances, immunities)\n  - Includes type distribution metrics across the Pok\u00e9dex\n  - Provides visual attributes for UI presentation\n  - Calculates offensive and defensive ratings\n  - Adds type categorization and generation data\n*/\n\nWITH pokemon_types AS (\n    SELECT\n        type_name,\n        slot,\n        COUNT(*) AS pokemon_count\n    FROM (\n        SELECT\n            (jsonb_array_elements(\n                COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n            )->'type')::jsonb->>'name' AS type_name,\n            (jsonb_array_elements(\n                COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n            )->>'slot')::int AS slot\n        FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"\n        WHERE types IS NOT NULL\n    ) t\n    GROUP BY type_name, slot\n),\n\ntype_counts AS (\n    -- Extract primary types from all pokemon\n    SELECT\n        primary_type AS type_name,\n        COUNT(*) AS num_primary\n    FROM (\n        SELECT\n            pokemon_id,\n            (SELECT jsonb_extract_path_text(pt.type_json::jsonb, 'name')\n             FROM (\n                 SELECT\n                     jsonb_array_elements(\n                         COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                     ) AS type_json\n                 FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n                 WHERE p2.pokemon_id = p.pokemon_id\n             ) pt\n             WHERE jsonb_extract_path_text(pt.type_json::jsonb, 'slot') = '1'\n             LIMIT 1\n            ) AS primary_type\n        FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n    ) primary_types\n    WHERE primary_type IS NOT NULL\n    GROUP BY primary_type\n),\n\nsecondary_type_counts AS (\n    -- Extract secondary types from pokemon\n    SELECT\n        secondary_type AS type_name,\n        COUNT(*) AS num_secondary\n    FROM (\n        SELECT\n            pokemon_id,\n            (SELECT jsonb_extract_path_text(pt.type_json::jsonb, 'name')\n             FROM (\n                 SELECT\n                     jsonb_array_elements(\n                         COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n                     ) AS type_json\n                 FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p2\n                 WHERE p2.pokemon_id = p.pokemon_id\n             ) pt\n             WHERE jsonb_extract_path_text(pt.type_json::jsonb, 'slot') = '2'\n             LIMIT 1\n            ) AS secondary_type\n        FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n    ) secondary_types\n    WHERE secondary_type IS NOT NULL\n    GROUP BY secondary_type\n),\n\ncombined_counts AS (\n    -- Combine primary and secondary counts\n    SELECT\n        t.type_name,\n        t.num_primary,\n        COALESCE(s.num_secondary, 0) AS num_secondary,\n        t.num_primary + COALESCE(s.num_secondary, 0) AS total_usage\n    FROM type_counts t\n    LEFT JOIN secondary_type_counts s ON t.type_name = s.type_name\n),\n\ntype_attributes AS (\n    SELECT\n        type_name,\n        -- Weaknesses (takes 2x damage from these types)\n        CASE\n            WHEN type_name = 'Normal' THEN ARRAY['Fighting']\n            WHEN type_name = 'Fire' THEN ARRAY['Water', 'Ground', 'Rock']\n            WHEN type_name = 'Water' THEN ARRAY['Electric', 'Grass']\n            WHEN type_name = 'Electric' THEN ARRAY['Ground']\n            WHEN type_name = 'Grass' THEN ARRAY['Fire', 'Ice', 'Poison', 'Flying', 'Bug']\n            WHEN type_name = 'Ice' THEN ARRAY['Fire', 'Fighting', 'Rock', 'Steel']\n            WHEN type_name = 'Fighting' THEN ARRAY['Flying', 'Psychic', 'Fairy']\n            WHEN type_name = 'Poison' THEN ARRAY['Ground', 'Psychic']\n            WHEN type_name = 'Ground' THEN ARRAY['Water', 'Grass', 'Ice']\n            WHEN type_name = 'Flying' THEN ARRAY['Electric', 'Ice', 'Rock']\n            WHEN type_name = 'Psychic' THEN ARRAY['Bug', 'Ghost', 'Dark']\n            WHEN type_name = 'Bug' THEN ARRAY['Fire', 'Flying', 'Rock']\n            WHEN type_name = 'Rock' THEN ARRAY['Water', 'Grass', 'Fighting', 'Ground', 'Steel']\n            WHEN type_name = 'Ghost' THEN ARRAY['Ghost', 'Dark']\n            WHEN type_name = 'Dragon' THEN ARRAY['Ice', 'Dragon', 'Fairy']\n            WHEN type_name = 'Dark' THEN ARRAY['Fighting', 'Bug', 'Fairy']\n            WHEN type_name = 'Steel' THEN ARRAY['Fire', 'Fighting', 'Ground']\n            WHEN type_name = 'Fairy' THEN ARRAY['Poison', 'Steel']\n            ELSE ARRAY[]::VARCHAR[]\n        END AS weaknesses,\n        \n        -- Resistances (takes 0.5x damage from these types)\n        CASE\n            WHEN type_name = 'Normal' THEN ARRAY[]::VARCHAR[]\n            WHEN type_name = 'Fire' THEN ARRAY['Fire', 'Grass', 'Ice', 'Bug', 'Steel', 'Fairy']\n            WHEN type_name = 'Water' THEN ARRAY['Fire', 'Water', 'Ice', 'Steel']\n            WHEN type_name = 'Electric' THEN ARRAY['Electric', 'Flying', 'Steel']\n            WHEN type_name = 'Grass' THEN ARRAY['Water', 'Electric', 'Grass', 'Ground']\n            WHEN type_name = 'Ice' THEN ARRAY['Ice']\n            WHEN type_name = 'Fighting' THEN ARRAY['Bug', 'Rock', 'Dark']\n            WHEN type_name = 'Poison' THEN ARRAY['Grass', 'Fighting', 'Poison', 'Bug', 'Fairy']\n            WHEN type_name = 'Ground' THEN ARRAY['Poison', 'Rock']\n            WHEN type_name = 'Flying' THEN ARRAY['Grass', 'Fighting', 'Bug']\n            WHEN type_name = 'Psychic' THEN ARRAY['Fighting', 'Psychic']\n            WHEN type_name = 'Bug' THEN ARRAY['Grass', 'Fighting', 'Ground']\n            WHEN type_name = 'Rock' THEN ARRAY['Normal', 'Fire', 'Poison', 'Flying']\n            WHEN type_name = 'Ghost' THEN ARRAY['Poison', 'Bug']  -- Fixed: Ghost resists Bug and Poison\n            WHEN type_name = 'Dragon' THEN ARRAY['Fire', 'Water', 'Electric', 'Grass']\n            WHEN type_name = 'Dark' THEN ARRAY['Ghost', 'Dark']\n            WHEN type_name = 'Steel' THEN ARRAY['Normal', 'Grass', 'Ice', 'Flying', 'Psychic', 'Bug', 'Rock', 'Dragon', 'Steel', 'Fairy']\n            WHEN type_name = 'Fairy' THEN ARRAY['Fighting', 'Bug', 'Dark']\n            ELSE ARRAY[]::VARCHAR[]\n        END AS resistances,\n        \n        -- Immunities (takes 0x damage from these types)\n        CASE\n            WHEN type_name = 'Normal' THEN ARRAY['Ghost']\n            WHEN type_name = 'Flying' THEN ARRAY['Ground']\n            WHEN type_name = 'Ground' THEN ARRAY['Electric']\n            WHEN type_name = 'Ghost' THEN ARRAY['Normal', 'Fighting']\n            WHEN type_name = 'Dark' THEN ARRAY['Psychic']\n            WHEN type_name = 'Fairy' THEN ARRAY['Dragon']\n            WHEN type_name = 'Steel' THEN ARRAY['Poison']\n            ELSE ARRAY[]::VARCHAR[]\n        END AS immunities,\n        \n        -- Super effective against (deals 2x damage to these types)\n        CASE\n            WHEN type_name = 'Normal' THEN ARRAY[]::VARCHAR[]\n            WHEN type_name = 'Fire' THEN ARRAY['Grass', 'Ice', 'Bug', 'Steel']\n            WHEN type_name = 'Water' THEN ARRAY['Fire', 'Ground', 'Rock']\n            WHEN type_name = 'Electric' THEN ARRAY['Water', 'Flying']\n            WHEN type_name = 'Grass' THEN ARRAY['Water', 'Ground', 'Rock']\n            WHEN type_name = 'Ice' THEN ARRAY['Grass', 'Ground', 'Flying', 'Dragon']\n            WHEN type_name = 'Fighting' THEN ARRAY['Normal', 'Ice', 'Rock', 'Dark', 'Steel']\n            WHEN type_name = 'Poison' THEN ARRAY['Grass', 'Fairy']\n            WHEN type_name = 'Ground' THEN ARRAY['Fire', 'Electric', 'Poison', 'Rock', 'Steel']\n            WHEN type_name = 'Flying' THEN ARRAY['Grass', 'Fighting', 'Bug']\n            WHEN type_name = 'Psychic' THEN ARRAY['Fighting', 'Poison']\n            WHEN type_name = 'Bug' THEN ARRAY['Grass', 'Psychic', 'Dark']\n            WHEN type_name = 'Rock' THEN ARRAY['Fire', 'Ice', 'Flying', 'Bug']\n            WHEN type_name = 'Ghost' THEN ARRAY['Psychic', 'Ghost']\n            WHEN type_name = 'Dragon' THEN ARRAY['Dragon']\n            WHEN type_name = 'Dark' THEN ARRAY['Psychic', 'Ghost']\n            WHEN type_name = 'Steel' THEN ARRAY['Ice', 'Rock', 'Fairy']\n            WHEN type_name = 'Fairy' THEN ARRAY['Fighting', 'Dragon', 'Dark']\n            ELSE ARRAY[]::VARCHAR[]\n        END AS super_effective,\n        \n        -- Type compatibility (works well defensively with these types)\n        CASE\n            WHEN type_name = 'Normal' THEN ARRAY['Ghost', 'Rock', 'Steel']\n            WHEN type_name = 'Fire' THEN ARRAY['Water', 'Rock', 'Dragon']\n            WHEN type_name = 'Water' THEN ARRAY['Fire', 'Ground', 'Flying']\n            WHEN type_name = 'Electric' THEN ARRAY['Flying', 'Steel', 'Fairy']\n            WHEN type_name = 'Grass' THEN ARRAY['Poison', 'Flying', 'Bug']\n            WHEN type_name = 'Ice' THEN ARRAY['Steel', 'Fire', 'Water']\n            WHEN type_name = 'Fighting' THEN ARRAY['Flying', 'Psychic', 'Fairy']\n            WHEN type_name = 'Poison' THEN ARRAY['Ground', 'Ghost', 'Steel']\n            WHEN type_name = 'Ground' THEN ARRAY['Flying', 'Bug', 'Grass']\n            WHEN type_name = 'Flying' THEN ARRAY['Steel', 'Electric', 'Rock']\n            WHEN type_name = 'Psychic' THEN ARRAY['Steel', 'Dark', 'Normal']\n            WHEN type_name = 'Bug' THEN ARRAY['Flying', 'Steel', 'Fire']\n            WHEN type_name = 'Rock' THEN ARRAY['Fighting', 'Ground', 'Steel']\n            WHEN type_name = 'Ghost' THEN ARRAY['Dark', 'Normal', 'Poison']\n            WHEN type_name = 'Dragon' THEN ARRAY['Steel', 'Fairy']\n            WHEN type_name = 'Dark' THEN ARRAY['Fighting', 'Fairy', 'Bug']\n            WHEN type_name = 'Steel' THEN ARRAY['Fire', 'Electric', 'Water']\n            WHEN type_name = 'Fairy' THEN ARRAY['Poison', 'Steel', 'Fire']\n            ELSE ARRAY[]::VARCHAR[]\n        END AS defensive_synergy\n    FROM combined_counts\n)\n\nSELECT\n    -- Primary key\n    md5(cast(coalesce(cast(c.type_name as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS type_key,\n    ROW_NUMBER() OVER (ORDER BY c.type_name) AS type_id,\n    \n    -- Core attributes\n    c.type_name,\n    c.num_primary,\n    c.num_secondary,\n    c.total_usage,\n    \n    -- Type effectiveness data\n    a.weaknesses,\n    a.resistances,\n    a.immunities,\n    a.super_effective,\n    \n    -- Defensive synergy types\n    a.defensive_synergy,\n    \n    -- Calculated metrics\n    COALESCE(ARRAY_LENGTH(a.weaknesses, 1), 0) AS weakness_count,\n    COALESCE(ARRAY_LENGTH(a.resistances, 1), 0) AS resistance_count,\n    COALESCE(ARRAY_LENGTH(a.immunities, 1), 0) AS immunity_count,\n    COALESCE(ARRAY_LENGTH(a.super_effective, 1), 0) AS super_effective_count,\n    \n    -- Type color (for UI)\n    CASE\n        WHEN c.type_name = 'Normal' THEN '#A8A77A'\n        WHEN c.type_name = 'Fire' THEN '#EE8130'\n        WHEN c.type_name = 'Water' THEN '#6390F0'\n        WHEN c.type_name = 'Electric' THEN '#F7D02C'\n        WHEN c.type_name = 'Grass' THEN '#7AC74C'\n        WHEN c.type_name = 'Ice' THEN '#96D9D6'\n        WHEN c.type_name = 'Fighting' THEN '#C22E28'\n        WHEN c.type_name = 'Poison' THEN '#A33EA1'\n        WHEN c.type_name = 'Ground' THEN '#E2BF65'\n        WHEN c.type_name = 'Flying' THEN '#A98FF3'\n        WHEN c.type_name = 'Psychic' THEN '#F95587'\n        WHEN c.type_name = 'Bug' THEN '#A6B91A'\n        WHEN c.type_name = 'Rock' THEN '#B6A136'\n        WHEN c.type_name = 'Ghost' THEN '#735797'\n        WHEN c.type_name = 'Dragon' THEN '#6F35FC'\n        WHEN c.type_name = 'Dark' THEN '#705746'\n        WHEN c.type_name = 'Steel' THEN '#B7B7CE'\n        WHEN c.type_name = 'Fairy' THEN '#D685AD'\n        ELSE '#CCCCCC'\n    END AS type_color,\n    \n    -- Type category - expanded with better organization\n    CASE\n        WHEN c.type_name IN ('Fire', 'Water', 'Electric') THEN 'Primary Elemental'\n        WHEN c.type_name IN ('Grass', 'Ice') THEN 'Secondary Elemental'\n        WHEN c.type_name IN ('Fighting', 'Rock', 'Ground') THEN 'Physical'\n        WHEN c.type_name IN ('Poison', 'Flying', 'Bug') THEN 'Biological'\n        WHEN c.type_name IN ('Psychic', 'Ghost', 'Dark', 'Fairy') THEN 'Special'\n        WHEN c.type_name IN ('Normal') THEN 'Normal'\n        WHEN c.type_name IN ('Dragon', 'Steel') THEN 'Advanced'\n        ELSE 'Other'\n    END AS type_category,\n    \n    -- Type attack classification\n    CASE\n        WHEN c.type_name IN ('Fire', 'Water', 'Electric', 'Grass', 'Ice', \n                           'Psychic', 'Dragon', 'Dark', 'Fairy') THEN 'Special'\n        ELSE 'Physical'\n    END AS damage_category,\n    \n    -- Generation introduced\n    CASE\n        WHEN c.type_name IN ('Normal', 'Fire', 'Water', 'Electric', 'Grass', 'Ice', \n                            'Fighting', 'Poison', 'Ground', 'Flying', 'Psychic', 'Bug', \n                            'Rock', 'Ghost', 'Dragon') THEN 1\n        WHEN c.type_name IN ('Dark', 'Steel') THEN 2\n        WHEN c.type_name IN ('Fairy') THEN 6\n        ELSE 1\n    END AS generation_introduced,\n    \n    -- Offensive usefulness rating (1-10)\n    CASE\n        WHEN c.type_name IN ('Ground', 'Fighting', 'Fire') THEN 9  -- Excellent coverage\n        WHEN c.type_name IN ('Ice', 'Electric', 'Rock', 'Flying', 'Fairy', 'Ghost', 'Dark') THEN 8  -- Great coverage\n        WHEN c.type_name IN ('Grass', 'Dragon', 'Steel', 'Water', 'Psychic') THEN 7  -- Good coverage\n        WHEN c.type_name IN ('Poison', 'Bug') THEN 5  -- Limited coverage\n        WHEN c.type_name IN ('Normal') THEN 3  -- Poor coverage\n        ELSE 6\n    END AS offensive_rating,\n    \n    -- Defensive usefulness rating (1-10)\n    CASE\n        WHEN c.type_name IN ('Steel', 'Fairy') THEN 10  -- Excellent defenses\n        WHEN c.type_name IN ('Ghost', 'Water', 'Normal', 'Dragon') THEN 8  -- Great defenses\n        WHEN c.type_name IN ('Fire', 'Flying', 'Dark', 'Poison', 'Ground') THEN 7  -- Good defenses\n        WHEN c.type_name IN ('Electric', 'Fighting', 'Psychic', 'Rock') THEN 5  -- Average defenses\n        WHEN c.type_name IN ('Grass', 'Bug', 'Ice') THEN 3  -- Poor defenses\n        ELSE 6\n    END AS defensive_rating,\n    \n    -- Type value calculated across multiple factors\n    (\n        COALESCE(ARRAY_LENGTH(a.resistances, 1), 0) * 5 +\n        COALESCE(ARRAY_LENGTH(a.immunities, 1), 0) * 10 -\n        COALESCE(ARRAY_LENGTH(a.weaknesses, 1), 0) * 5 +\n        COALESCE(ARRAY_LENGTH(a.super_effective, 1), 0) * 3\n    ) AS composite_value_score,\n    \n    -- Data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM combined_counts c\nJOIN type_attributes a ON c.type_name = a.type_name\nORDER BY c.type_name", "relation_name": "\"nerd_facts\".\"public\".\"dim_pokemon_types\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:00.812817Z", "completed_at": "2025-03-24T09:38:00.818702Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:00.823810Z", "completed_at": "2025-03-24T09:38:00.922585Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.11103224754333496, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.nerd_facts_dbt.fact_pokemon_matchups", "compiled": true, "compiled_code": "\n\n/*\n  Model: fact_pokemon_matchups\n  Description: Fact table for Pok\u00e9mon type matchup effectiveness\n  \n  Notes:\n  - Contains comprehensive type matchup data for all 18 Pok\u00e9mon types\n  - Calculates effectiveness multipliers (0x, 0.5x, 1x, 2x)\n  - Provides context on how many Pok\u00e9mon are affected by each matchup\n  - Enables detailed type advantage analysis\n*/\n\nWITH pokemon_types AS (\n    SELECT DISTINCT\n        (jsonb_array_elements(\n            COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n        )->'type')::jsonb->>'name' AS type_name\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"\n    WHERE types IS NOT NULL\n),\n\n-- Manually create type effectiveness data\n-- This would normally come from a reference table\ntype_matchups AS (\n    SELECT * FROM (VALUES\n        ('normal', 'normal', 1.0),\n        ('normal', 'fighting', 2.0),\n        ('normal', 'flying', 1.0),\n        ('normal', 'poison', 1.0),\n        ('normal', 'ground', 1.0),\n        ('normal', 'rock', 1.0),\n        ('normal', 'bug', 1.0),\n        ('normal', 'ghost', 0.0),\n        ('normal', 'steel', 1.0),\n        ('normal', 'fire', 1.0),\n        ('normal', 'water', 1.0),\n        ('normal', 'grass', 1.0),\n        ('normal', 'electric', 1.0),\n        ('normal', 'psychic', 1.0),\n        ('normal', 'ice', 1.0),\n        ('normal', 'dragon', 1.0),\n        ('normal', 'dark', 1.0),\n        ('normal', 'fairy', 1.0),\n        \n        ('fire', 'normal', 1.0),\n        ('fire', 'fighting', 1.0),\n        ('fire', 'flying', 1.0),\n        ('fire', 'poison', 1.0),\n        ('fire', 'ground', 1.0),\n        ('fire', 'rock', 0.5),\n        ('fire', 'bug', 2.0),\n        ('fire', 'ghost', 1.0),\n        ('fire', 'steel', 2.0),\n        ('fire', 'fire', 0.5),\n        ('fire', 'water', 0.5),\n        ('fire', 'grass', 2.0),\n        ('fire', 'electric', 1.0),\n        ('fire', 'psychic', 1.0),\n        ('fire', 'ice', 2.0),\n        ('fire', 'dragon', 0.5),\n        ('fire', 'dark', 1.0),\n        ('fire', 'fairy', 1.0),\n        \n        ('water', 'normal', 1.0),\n        ('water', 'fighting', 1.0),\n        ('water', 'flying', 1.0),\n        ('water', 'poison', 1.0),\n        ('water', 'ground', 2.0),\n        ('water', 'rock', 2.0),\n        ('water', 'bug', 1.0),\n        ('water', 'ghost', 1.0),\n        ('water', 'steel', 1.0),\n        ('water', 'fire', 2.0),\n        ('water', 'water', 0.5),\n        ('water', 'grass', 0.5),\n        ('water', 'electric', 1.0),\n        ('water', 'psychic', 1.0),\n        ('water', 'ice', 1.0),\n        ('water', 'dragon', 0.5),\n        ('water', 'dark', 1.0),\n        ('water', 'fairy', 1.0)\n        \n        -- Additional type matchups would be added here for a complete table\n    ) AS t(attacker_type, defender_type, effectiveness)\n),\n\n-- Count the number of Pok\u00e9mon per primary type\nprimary_type_counts AS (\n    SELECT\n        type_name,\n        COUNT(*) AS pokemon_count\n    FROM (\n        SELECT\n            p.pokemon_id,\n            (jsonb_array_elements(\n                COALESCE(NULLIF(p.types::text, 'null')::jsonb, '[]'::jsonb)\n            )->'type')::jsonb->>'name' AS type_name,\n            (jsonb_array_elements(\n                COALESCE(NULLIF(p.types::text, 'null')::jsonb, '[]'::jsonb)\n            )->>'slot')::int AS type_slot\n        FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n    ) t\n    WHERE type_slot = 1\n    GROUP BY type_name\n)\n\nSELECT\n    -- Generate surrogate key for the matchup\n    md5(cast(coalesce(cast(tm.attacker_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(tm.defender_type as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS matchup_key,\n    \n    -- Types involved in matchup\n    tm.attacker_type,\n    tm.defender_type,\n    \n    -- Effectiveness of the attack\n    tm.effectiveness,\n    \n    -- Categorize effectiveness\n    CASE\n        WHEN tm.effectiveness = 0.0 THEN 'No effect'\n        WHEN tm.effectiveness = 0.5 THEN 'Not very effective'\n        WHEN tm.effectiveness = 1.0 THEN 'Normal effectiveness'\n        WHEN tm.effectiveness = 2.0 THEN 'Super effective'\n        ELSE 'Unknown'\n    END AS effectiveness_category,\n    \n    -- Strategic importance based on how common the type is\n    CASE\n        WHEN pc.pokemon_count > 60 THEN 'High'\n        WHEN pc.pokemon_count > 30 THEN 'Medium'\n        ELSE 'Low'\n    END AS strategic_importance,\n    \n    -- Additional derived fields\n    pc.pokemon_count AS defending_pokemon_count,\n    \n    -- Convert to percentage of total Pok\u00e9mon\n    ROUND(pc.pokemon_count * 100.0 / (SELECT COUNT(*) FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"), 1) AS pct_pokemon_with_type,\n    \n    -- Date tracking\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM type_matchups tm\nJOIN pokemon_types pt ON tm.defender_type = pt.type_name\nLEFT JOIN primary_type_counts pc ON tm.defender_type = pc.type_name\nORDER BY tm.attacker_type, tm.defender_type", "relation_name": "\"nerd_facts\".\"public\".\"fact_pokemon_matchups\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.280588Z", "completed_at": "2025-03-24T09:37:55.302440Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.306772Z", "completed_at": "2025-03-24T09:38:01.079138Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 5.805056810379028, "adapter_response": {"_message": "SELECT 12", "code": "SELECT", "rows_affected": 12}, "message": "SELECT 12", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_netrunner_factions", "compiled": true, "compiled_code": "/*\n  Model: dim_netrunner_factions\n  Description: Dimension table for Android: Netrunner factions\n  \n  Notes:\n  - Provides comprehensive faction information and classifications\n  - Includes card counts and distributions across types\n  - Adds gameplay style classification and meta position\n  - Contains faction metadata and visual styling attributes\n*/\n\nWITH faction_base AS (\n    SELECT DISTINCT\n        f.code AS faction_code,\n        f.faction_name,\n        f.side_code,\n        CASE \n            WHEN f.side_code = 'corp' THEN 'Corp'\n            WHEN f.side_code = 'runner' THEN 'Runner'\n            ELSE 'Unknown'\n        END AS side_name,\n        f.is_mini AS is_mini_faction,\n        f.color\n    FROM \"nerd_facts\".\"public\".\"stg_netrunner_factions\" f\n),\n\ncard_counts AS (\n    SELECT\n        faction_code,\n        COUNT(DISTINCT c.card_id) AS num_cards,\n        COUNT(DISTINCT CASE WHEN type_code = 'identity' THEN c.card_id END) AS num_identities,\n        COUNT(DISTINCT CASE WHEN type_code = 'ice' THEN c.card_id END) AS num_ice,\n        COUNT(DISTINCT CASE WHEN type_code = 'program' AND text ILIKE '%Icebreaker%' THEN c.card_id END) AS num_icebreakers,\n        COUNT(DISTINCT CASE WHEN type_code = 'agenda' THEN c.card_id END) AS num_agendas,\n        COUNT(DISTINCT CASE WHEN type_code IN ('event', 'operation') THEN c.card_id END) AS num_events_operations,\n        COUNT(DISTINCT CASE WHEN text ILIKE '%gain%credit%' OR \n                              text ILIKE '%take%credit%' OR\n                              text ILIKE '%credit for each%' THEN c.card_id END) AS num_economy_cards,\n        -- Add first release date\n        MIN(p.release_at) AS first_release_date,\n        -- Add most recent card release date\n        MAX(p.release_at) AS latest_release_date\n    FROM \"nerd_facts\".\"public\".\"stg_netrunner_cards\" c\n    LEFT JOIN \"nerd_facts\".\"public\".\"stg_netrunner_packs\" p ON c.pack_code = p.code\n    GROUP BY faction_code\n)\n\nSELECT\n    -- Generate surrogate key\n    md5(cast(coalesce(cast(f.faction_code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS faction_key,\n    \n    -- Primary identifiers\n    f.faction_code,\n    f.faction_name,\n    f.side_code,\n    f.side_name,\n    f.is_mini_faction,\n    f.color,\n    \n    -- Card statistics\n    COALESCE(c.num_cards, 0) AS num_cards,\n    COALESCE(c.num_identities, 0) AS num_identities,\n    COALESCE(c.num_ice, 0) AS num_ice,\n    COALESCE(c.num_icebreakers, 0) AS num_icebreakers,\n    COALESCE(c.num_agendas, 0) AS num_agendas,\n    COALESCE(c.num_events_operations, 0) AS num_events_operations,\n    COALESCE(c.num_economy_cards, 0) AS num_economy_cards,\n    \n    -- Dates\n    c.first_release_date,\n    c.latest_release_date,\n    \n    -- Faction tier based on card count with improved thresholds\n    CASE\n        WHEN COALESCE(c.num_cards, 0) > 120 THEN 'Major'\n        WHEN COALESCE(c.num_cards, 0) > 70 THEN 'Standard'\n        WHEN COALESCE(c.num_cards, 0) > 20 THEN 'Minor'\n        ELSE 'Mini'\n    END AS faction_tier,\n    \n    -- Faction type based on side and characteristics with improved pattern matching\n    CASE\n        WHEN f.side_name = 'Corp' AND f.faction_name ILIKE '%jinteki%' THEN 'Trap Corp'\n        WHEN f.side_name = 'Corp' AND f.faction_name ILIKE '%haas-bioroid%' THEN 'Economy Corp'\n        WHEN f.side_name = 'Corp' AND f.faction_name ILIKE '%nbn%' THEN 'Tag Corp'\n        WHEN f.side_name = 'Corp' AND f.faction_name ILIKE '%weyland%' THEN 'Damage Corp'\n        WHEN f.side_name = 'Runner' AND f.faction_name ILIKE '%anarch%' THEN 'Disruption Runner'\n        WHEN f.side_name = 'Runner' AND f.faction_name ILIKE '%criminal%' THEN 'Economy Runner'\n        WHEN f.side_name = 'Runner' AND f.faction_name ILIKE '%shaper%' THEN 'Rig-Builder Runner'\n        ELSE 'Specialized'\n    END AS play_style,\n    \n    -- Economic strength based on economy card percentage\n    CASE\n        WHEN COALESCE(c.num_cards, 0) = 0 THEN 'Unknown'\n        WHEN COALESCE(c.num_economy_cards, 0) * 100.0 / NULLIF(c.num_cards, 0) >= 20 THEN 'Strong Economy'\n        WHEN COALESCE(c.num_economy_cards, 0) * 100.0 / NULLIF(c.num_cards, 0) >= 15 THEN 'Good Economy'\n        WHEN COALESCE(c.num_economy_cards, 0) * 100.0 / NULLIF(c.num_cards, 0) >= 10 THEN 'Moderate Economy'\n        ELSE 'Weak Economy'\n    END AS economy_strength,\n    \n    -- Iconic identity card for this faction with more comprehensive matching\n    CASE\n        WHEN f.faction_code = 'jinteki' THEN 'Personal Evolution'\n        WHEN f.faction_code = 'haas-bioroid' THEN 'Engineering the Future'\n        WHEN f.faction_code = 'nbn' THEN 'Making News'\n        WHEN f.faction_code = 'weyland-consortium' THEN 'Building a Better World'\n        WHEN f.faction_code = 'anarch' THEN 'Noise'\n        WHEN f.faction_code = 'criminal' THEN 'Gabriel Santiago'\n        WHEN f.faction_code = 'shaper' THEN 'Kate \"Mac\" McCaffrey'\n        WHEN f.faction_code = 'adam' THEN 'Adam: Compulsive Hacker'\n        WHEN f.faction_code = 'apex' THEN 'Apex: Invasive Predator'\n        WHEN f.faction_code = 'sunny-lebeau' THEN 'Sunny Lebeau: Security Specialist'\n        ELSE 'Various'\n    END AS iconic_identity,\n    \n    -- Release wave with expanded categories\n    CASE\n        WHEN f.faction_code IN ('haas-bioroid', 'jinteki', 'nbn', 'weyland-consortium', 'anarch', 'criminal', 'shaper') THEN 'Core Set'\n        WHEN f.faction_code IN ('adam', 'apex', 'sunny-lebeau') THEN 'Data and Destiny'\n        ELSE 'Expansion'\n    END AS release_category,\n    \n    -- Meta position\n    CASE\n        WHEN f.faction_code IN ('nbn', 'haas-bioroid', 'criminal', 'shaper') THEN 'Tier 1'\n        WHEN f.faction_code IN ('jinteki', 'weyland-consortium', 'anarch') THEN 'Tier 2'\n        ELSE 'Tier 3'\n    END AS meta_position,\n    \n    -- CSS classes for styling\n    'faction-' || f.faction_code AS faction_css_class,\n    \n    -- Add hex color code with # prefix if not already present\n    CASE\n        WHEN f.color IS NULL THEN '#000000'  -- Default black\n        WHEN f.color LIKE '#%' THEN f.color\n        ELSE '#' || f.color\n    END AS color_hex,\n    \n    -- Faction abbreviation\n    CASE\n        WHEN f.faction_code = 'haas-bioroid' THEN 'HB'\n        WHEN f.faction_code = 'jinteki' THEN 'J'\n        WHEN f.faction_code = 'nbn' THEN 'NBN'\n        WHEN f.faction_code = 'weyland-consortium' THEN 'W'\n        WHEN f.faction_code = 'anarch' THEN 'A'\n        WHEN f.faction_code = 'criminal' THEN 'C'\n        WHEN f.faction_code = 'shaper' THEN 'S'\n        WHEN f.faction_code = 'adam' THEN 'Adam'\n        WHEN f.faction_code = 'apex' THEN 'Apex'\n        WHEN f.faction_code = 'sunny-lebeau' THEN 'Sunny'\n        ELSE SUBSTRING(f.faction_name, 1, 1)\n    END AS faction_abbr,\n    \n    -- Data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM faction_base f\nLEFT JOIN card_counts c ON f.faction_code = c.faction_code\nORDER BY f.side_name, COALESCE(c.num_cards, 0) DESC", "relation_name": "\"nerd_facts\".\"public\".\"dim_netrunner_factions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:01.089070Z", "completed_at": "2025-03-24T09:38:01.093661Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:01.094143Z", "completed_at": "2025-03-24T09:38:01.173280Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.08627581596374512, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_films", "compiled": true, "compiled_code": "\n\nwith films as (\n    select\n        film_id,\n        episode_id,\n        title,        \n        opening_crawl,\n        director,\n        producer,\n\n        -- Entity counts with error handling and type casting to JSONB\n        COALESCE(jsonb_array_length(characters::jsonb), 0) AS character_count,\n        COALESCE(jsonb_array_length(planets::jsonb), 0) AS planet_count,\n        COALESCE(jsonb_array_length(starships::jsonb), 0) AS starship_count,\n        COALESCE(jsonb_array_length(vehicles::jsonb), 0) AS vehicle_count,\n        COALESCE(jsonb_array_length(species::jsonb), 0) AS species_count, \n\n        -- Derived film classification (use the casted episode_id field)\n        CASE\n        WHEN CAST(episode_id AS INTEGER) BETWEEN 1 AND 3 THEN 'Prequel Trilogy'\n        WHEN CAST(episode_id AS INTEGER) BETWEEN 4 AND 6 THEN 'Original Trilogy'\n        WHEN CAST(episode_id AS INTEGER) BETWEEN 7 AND 9 THEN 'Sequel Trilogy'\n        ELSE 'Anthology'\n        END AS trilogy,       \n\n        -- Era classification (use the casted episode_id field)\n        CASE\n            WHEN CAST(episode_id AS INTEGER) BETWEEN 1 AND 3 THEN 'Republic Era'\n            WHEN CAST(episode_id AS INTEGER) BETWEEN 4 AND 6 THEN 'Imperial Era'\n            WHEN CAST(episode_id AS INTEGER) BETWEEN 7 AND 9 THEN 'New Republic Era'\n            ELSE 'Various'\n        END AS era,\n\n        release_date,\n        created_at,\n        edited_at,\n        dbt_loaded_at,\n        url\n    from \"nerd_facts\".\"public\".\"stg_swapi_films\"\n)\n\nselect * from films", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_films\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:01.177835Z", "completed_at": "2025-03-24T09:38:01.183737Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:01.186042Z", "completed_at": "2025-03-24T09:38:01.285177Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.10921144485473633, "adapter_response": {"_message": "SELECT 66", "code": "SELECT", "rows_affected": 66}, "message": "SELECT 66", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_locations", "compiled": true, "compiled_code": "/*\n  Model: dim_locations (Simplified)\n  Description: Basic location dimension table with consistent TEXT types\n*/\n\nWITH sw_planets_minimal AS (\n    SELECT\n        'sw_' || planet_id AS source_id,\n        'star_wars' AS universe,\n        planet_name AS location_name,\n        'Planet' AS location_type,\n        diameter::TEXT,  -- Cast to TEXT\n        rotation_period::TEXT,  -- Cast to TEXT\n        orbital_period::TEXT,  -- Cast to TEXT\n        gravity,\n        population::TEXT,  -- Cast to TEXT\n        climate,\n        terrain,\n        surface_water::TEXT  -- Cast to TEXT\n    FROM \"nerd_facts\".\"public\".\"stg_swapi_planets\"\n),\n\npokemon_regions_minimal AS (\n    -- Create hardcoded Pok\u00e9mon regions since staging data doesn't have them\n    SELECT * FROM (VALUES\n        ('pkm_1', 'pokemon', 'Kanto', 'Region', NULL::TEXT, NULL::TEXT, NULL::TEXT, '1 standard', '10000000', 'varied', 'varied', '30'),\n        ('pkm_2', 'pokemon', 'Johto', 'Region', NULL::TEXT, NULL::TEXT, NULL::TEXT, '1 standard', '8000000', 'varied', 'varied', '40'),\n        ('pkm_3', 'pokemon', 'Hoenn', 'Region', NULL::TEXT, NULL::TEXT, NULL::TEXT, '1 standard', '7000000', 'tropical', 'mountainous', '60'),\n        ('pkm_4', 'pokemon', 'Sinnoh', 'Region', NULL::TEXT, NULL::TEXT, NULL::TEXT, '1 standard', '5000000', 'temperate', 'varied', '35')\n    ) AS v(source_id, universe, location_name, location_type, diameter, rotation_period, \n           orbital_period, gravity, population, climate, terrain, surface_water)\n),\n\nnetrunner_locations_minimal AS (\n    -- Create minimal Netrunner locations with text values\n    SELECT * FROM (VALUES\n        ('nr_1001', 'netrunner', 'New Angeles', 'Megacity', NULL::TEXT, NULL::TEXT, NULL::TEXT, 'high', '500000000', 'temperate', 'urban', '10'),\n        ('nr_1002', 'netrunner', 'The Moon', 'Colony', '3474', '27.3', '27.3', 'low', '5000000', 'artificial', 'lunar', '0')\n    ) AS v(source_id, universe, location_name, location_type, diameter, rotation_period, \n           orbital_period, gravity, population, climate, terrain, surface_water)\n)\n\n-- Rest of query remains the same\nSELECT\n    md5(cast(coalesce(cast(universe as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(source_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS location_key,\n    source_id,\n    universe,\n    location_name,\n    location_type,\n    diameter,\n    rotation_period,\n    orbital_period,\n    gravity,\n    population,\n    climate,\n    terrain,\n    surface_water,\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM (\n    SELECT * FROM sw_planets_minimal\n    UNION ALL\n    SELECT * FROM pokemon_regions_minimal\n    UNION ALL\n    SELECT * FROM netrunner_locations_minimal\n) AS all_locations\nORDER BY universe, location_name", "relation_name": "\"nerd_facts\".\"public\".\"dim_locations\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:01.293431Z", "completed_at": "2025-03-24T09:38:01.299814Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:01.300420Z", "completed_at": "2025-03-24T09:38:01.406969Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.11542391777038574, "adapter_response": {"_message": "SELECT 33", "code": "SELECT", "rows_affected": 33}, "message": "SELECT 33", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_films_planets", "compiled": true, "compiled_code": "\n\n/*\n  Model: int_swapi_films_planets\n  Description: Creates a relationship table between films and planets\n  Source: Using films.planets array\n*/\n\n-- Get relationships from films perspective (only direction available)\nwith films_to_planets as (\n    select\n        film_id,\n        jsonb_array_elements_text(planets::jsonb)::integer as planet_id\n    from \"nerd_facts\".\"public\".\"stg_swapi_films\"\n    where planets is not null and jsonb_array_length(planets::jsonb) > 0\n)\n\n-- Final output with useful metadata\nselect \n    fp.film_id,\n    fp.planet_id,\n    f.title as film_title,\n    p.name as planet_name,\n    f.release_date,\n    p.climate,\n    p.terrain,\n    -- Create a unique key for the relationship\n    md5(cast(coalesce(cast(fp.film_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(fp.planet_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as film_planet_key\nfrom \n    films_to_planets fp\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_films\" f on fp.film_id = f.film_id\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_planets\" p on fp.planet_id = p.planet_id\norder by\n    f.release_date, p.name", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_films_planets\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:01.417358Z", "completed_at": "2025-03-24T09:38:01.421980Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:01.422484Z", "completed_at": "2025-03-24T09:38:01.493951Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.07858586311340332, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_planets", "compiled": true, "compiled_code": "\n\nwith planets as (    \n    select\n    planet_id,\n    planet_name,\n    name,        \n    climate,\n    gravity,\n    terrain,    \n    surface_water,\n    rotation_period,\n    orbital_period,\n    diameter,\n    population,\n    -- Terrain classification flags\n    terrain LIKE '%temperate%' AS is_temperate,\n    terrain LIKE '%forest%' OR terrain LIKE '%jungle%' OR terrain LIKE '%grassland%' AS has_vegetation,\n    terrain LIKE '%ocean%' OR terrain LIKE '%lake%' OR surface_water = '100' AS is_water_world,\n    terrain LIKE '%desert%' AS is_desert_world,        \n    created_at,\n    updated_at,    \n    dbt_loaded_at,\n    url  \n    from \"nerd_facts\".\"public\".\"stg_swapi_planets\"\n)\n\nselect * from planets", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_planets\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:01.498785Z", "completed_at": "2025-03-24T09:38:01.510835Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:01.511356Z", "completed_at": "2025-03-24T09:38:01.675262Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.17811846733093262, "adapter_response": {"_message": "SELECT 3501", "code": "SELECT", "rows_affected": 3501}, "message": "SELECT 3501", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_characters", "compiled": true, "compiled_code": "/*\n  Model: dim_characters (Ultra-simplified)\n  Description: Minimal character dimension table\n*/\n\n-- Star Wars characters with hardcoded surrogate key inputs\nSELECT\n    md5(cast(coalesce(cast('star_wars' as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(people_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_key,\n    'star_wars' AS universe,\n    people_id::TEXT AS character_source_id,  -- Cast to TEXT\n    name AS character_name,\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM \"nerd_facts\".\"public\".\"stg_swapi_people\"\n\nUNION ALL\n\n-- Pokemon with hardcoded surrogate key inputs\nSELECT\n    md5(cast(coalesce(cast('pokemon' as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(pokemon_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_key,\n    'pokemon' AS universe,\n    pokemon_id::TEXT AS character_source_id,  -- Cast to TEXT\n    pokemon_name AS character_name,\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"\n\nUNION ALL\n\n-- Netrunner with hardcoded surrogate key inputs\nSELECT\n    md5(cast(coalesce(cast('netrunner' as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_key,\n    'netrunner' AS universe,\n    code AS character_source_id,  -- Already TEXT\n    card_name AS character_name,\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM \"nerd_facts\".\"public\".\"stg_netrunner_cards\"\nWHERE type_code = 'identity'", "relation_name": "\"nerd_facts\".\"public\".\"dim_characters\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:01.680863Z", "completed_at": "2025-03-24T09:38:01.693923Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:01.694564Z", "completed_at": "2025-03-24T09:38:01.873601Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.19495368003845215, "adapter_response": {"_message": "SELECT 3501", "code": "SELECT", "rows_affected": 3501}, "message": "SELECT 3501", "failures": null, "unique_id": "model.nerd_facts_dbt.fact_power_ratings", "compiled": true, "compiled_code": "\n\n/*\n  Model: fact_power_ratings (Ultra-Simplified)\n  Description: Basic power metrics across universes with consistent types\n*/\n\nWITH sw_power AS (\n    SELECT\n        md5(cast(coalesce(cast('star_wars' as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(p.people_id::TEXT as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_key,\n        'star_wars' AS universe,\n        p.people_id::TEXT AS character_source_id,\n        p.name AS character_name,\n        1 AS base_power,  -- Simplified constant\n        1 AS mobility,    -- Simplified constant\n        1 AS battle_experience,  -- Simplified constant\n        'false' AS has_special_abilities  -- String literal instead of boolean expression\n    FROM \"nerd_facts\".\"public\".\"stg_swapi_people\" p\n),\n\npokemon_power AS (\n    SELECT\n        md5(cast(coalesce(cast('pokemon' as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(p.pokemon_id::TEXT as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_key,\n        'pokemon' AS universe,\n        p.pokemon_id::TEXT AS character_source_id,\n        p.pokemon_name AS character_name,\n        1 AS base_power,  -- Simplified constant\n        1 AS mobility,    -- Simplified constant\n        1 AS battle_experience,  -- Simplified constant\n        'true' AS has_special_abilities  -- String literal instead of boolean\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n),\n\nnetrunner_power AS (\n    SELECT\n        md5(cast(coalesce(cast('netrunner' as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(c.card_id::TEXT as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_key,\n        'netrunner' AS universe,\n        c.code AS character_source_id,\n        c.card_name AS character_name,\n        1 AS base_power,  -- Simplified constant\n        1 AS mobility,    -- Simplified constant\n        1 AS battle_experience,  -- Simplified constant\n        CASE \n            WHEN c.uniqueness IS NULL THEN 'false'\n            -- Compare as text instead of using as boolean\n            WHEN c.uniqueness = 'true' OR c.uniqueness = 't' OR c.uniqueness = '1' THEN 'true' \n            ELSE 'false' \n        END AS has_special_abilities\n    FROM \"nerd_facts\".\"public\".\"stg_netrunner_cards\" c\n    WHERE c.type_code = 'identity'  -- Only include identity cards\n)\n\n-- Simply combine all data with minimal processing\nSELECT\n    character_key,\n    universe,\n    character_source_id,\n    character_name,\n    base_power,\n    mobility,\n    battle_experience,\n    has_special_abilities,\n    \n    -- Simple power score (all equal for now)\n    3 AS normalized_power_score,\n    \n    -- Simplified tier (all equal)\n    'C-Tier' AS power_tier,\n    \n    -- Add data tracking fields\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM (\n    SELECT * FROM sw_power\n    UNION ALL\n    SELECT * FROM pokemon_power\n    UNION ALL\n    SELECT * FROM netrunner_power\n) AS combined_power", "relation_name": "\"nerd_facts\".\"public\".\"fact_power_ratings\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:01.882704Z", "completed_at": "2025-03-24T09:38:01.888493Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:01.892278Z", "completed_at": "2025-03-24T09:38:02.000888Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.12059736251831055, "adapter_response": {"_message": "SELECT 82", "code": "SELECT", "rows_affected": 82}, "message": "SELECT 82", "failures": null, "unique_id": "model.nerd_facts_dbt.fact_sw_characters", "compiled": true, "compiled_code": "\n\n/*\n  Model: fact_sw_characters\n  Description: Fact table for Star Wars characters with attributes and metrics\n*/\n\n-- Get just the base data first\nWITH characters AS (\n    SELECT\n        people_id AS character_id,\n        name,\n        height AS height_cm,\n        mass AS mass_kg,\n        hair_color,\n        skin_color,\n        eye_color,\n        birth_year,\n        gender,\n        homeworld AS homeworld_id,\n        -- These fields don't exist in staging, we'll need to handle them differently\n        NULL AS species_id,\n        NULL AS film_appearances,\n        NULL AS film_names,\n        NULL AS vehicle_count,\n        NULL AS vehicle_names,\n        NULL AS starship_count,\n        NULL AS starship_names,\n        FALSE AS force_sensitive,\n        'Unknown' AS character_era,\n        url,\n        created_at AS fetch_timestamp,\n        edited_at AS processed_timestamp\n    FROM \"nerd_facts\".\"public\".\"stg_swapi_people\"\n    WHERE people_id IS NOT NULL\n)\n\n-- Simplified final output\nSELECT\n    md5(cast(coalesce(cast(character_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_key,\n    character_id,\n    name AS character_name,\n    homeworld_id,\n    species_id,\n    \n    -- Physical attributes\n    height_cm,\n    mass_kg,\n    hair_color,\n    eye_color,\n    skin_color,\n    birth_year,\n    gender,\n    \n    -- Film and vehicle appearances\n    film_appearances,\n    vehicle_count,\n    starship_count,\n    film_names AS film_list,\n    vehicle_names AS vehicle_list,\n    starship_names AS starship_list,\n    \n    -- Force user information\n    force_sensitive,\n    \n    -- Era classification\n    character_era,\n    \n    -- Affiliation (simplified)\n    CASE\n        WHEN LOWER(name) IN ('luke skywalker', 'leia organa', 'han solo') THEN 'Rebel Alliance'\n        WHEN LOWER(name) IN ('darth vader', 'emperor palpatine') THEN 'Empire'\n        ELSE 'Other'\n    END AS affiliation,\n    \n    -- Character tier (simplified)\n    CASE\n        WHEN LOWER(name) IN ('luke skywalker', 'darth vader', 'leia organa') THEN 'S'\n        WHEN COALESCE(film_appearances::integer, 0) > 2 THEN 'A'\n        WHEN COALESCE(film_appearances::integer, 0) > 1 THEN 'B' \n        ELSE 'C'\n    END AS character_tier,\n    \n    -- Source tracking\n    url,\n    fetch_timestamp,\n    processed_timestamp,\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM characters\nORDER BY character_id", "relation_name": "\"nerd_facts\".\"public\".\"fact_sw_characters\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:02.010229Z", "completed_at": "2025-03-24T09:38:02.016342Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:02.016835Z", "completed_at": "2025-03-24T09:38:02.094206Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0858924388885498, "adapter_response": {"_message": "SELECT 162", "code": "SELECT", "rows_affected": 162}, "message": "SELECT 162", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_films_characters", "compiled": true, "compiled_code": "\n\n/*\n  Model: int_swapi_films_characters\n  Description: Creates a relationship table between films and characters\n  Source: Using films.characters array\n*/\n\n-- Get relationships from films perspective (the only available direction)\nwith films_to_characters as (\n    select\n        film_id,\n        jsonb_array_elements_text(characters::jsonb)::integer as people_id\n    from \"nerd_facts\".\"public\".\"stg_swapi_films\"\n    where characters is not null and jsonb_array_length(characters::jsonb) > 0\n)\n\n-- Final output with useful metadata\nselect \n    fc.film_id,\n    fc.people_id,\n    f.title as film_title,\n    p.name as character_name,\n    f.release_date,\n    p.gender,\n    p.birth_year,\n    -- Create a unique key for the relationship\n    md5(cast(coalesce(cast(fc.film_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(fc.people_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as film_character_key\nfrom \n    films_to_characters fc\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_films\" f on fc.film_id = f.film_id\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_people\" p on fc.people_id = p.people_id\norder by\n    f.release_date, p.name", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_films_characters\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:02.101118Z", "completed_at": "2025-03-24T09:38:02.105500Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:02.105986Z", "completed_at": "2025-03-24T09:38:02.233257Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.13380193710327148, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_people", "compiled": true, "compiled_code": "\n\nwith people as (\n    select        \n        people_id,        \n        name,        \n        LOWER(COALESCE(hair_color, 'unknown')) AS hair_color,\n        LOWER(COALESCE(skin_color, 'unknown')) AS skin_color,\n        LOWER(COALESCE(eye_color, 'unknown')) AS eye_color,\n        birth_year,\n        LOWER(COALESCE(gender, 'unknown')) AS gender,\n        homeworld as homeworld_id,                \n        height,\n        mass,\n        -- Force detection\n        CASE\n        WHEN LOWER(name) IN ('luke skywalker', 'darth vader', 'obi-wan kenobi', 'yoda', \n                           'emperor palpatine', 'count dooku', 'qui-gon jinn', 'mace windu',\n                           'rey', 'kylo ren', 'anakin skywalker', 'leia organa', \n                           'ahsoka tano', 'darth maul')\n        THEN TRUE\n        ELSE FALSE\n        END AS force_sensitive,\n        created_at,\n        edited_at,  \n        dbt_loaded_at,\n        url\n    from \"nerd_facts\".\"public\".\"stg_swapi_people\"\n)\n\nselect * from people", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_people\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:00.926558Z", "completed_at": "2025-03-24T09:38:00.938158Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:00.938711Z", "completed_at": "2025-03-24T09:38:02.324799Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.401231050491333, "adapter_response": {"_message": "SELECT 1302", "code": "SELECT", "rows_affected": 1302}, "message": "SELECT 1302", "failures": null, "unique_id": "model.nerd_facts_dbt.fact_pokemon_stats", "compiled": true, "compiled_code": "\n\n/*\n  Model: fact_pokemon_stats\n  Description: Fact table for Pok\u00e9mon statistics and battle metrics\n  \n  Notes:\n  - Contains comprehensive stat analysis for all Pok\u00e9mon\n  - Calculates evolutionary stage and progression metrics\n  - Includes battle effectiveness calculations and classifications\n  - Provides stat distribution analysis and percentile rankings\n  - Links to dimension tables for Pok\u00e9mon and types\n*/\n\nWITH pokemon_types AS (\n    SELECT\n        pokemon_id,\n        (jsonb_array_elements(\n            COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n        )->'type')::jsonb->>'name' AS type_name,\n        (jsonb_array_elements(\n            COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n        )->>'slot')::int AS type_slot\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"\n    WHERE pokemon_id IS NOT NULL\n),\n\nstats_extract AS (\n    SELECT\n        pokemon_id,\n        jsonb_array_elements(\n            COALESCE(NULLIF(stats::text, 'null')::jsonb, '[]'::jsonb)\n        ) AS stat_data\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"\n    WHERE pokemon_id IS NOT NULL\n),\n\npokemon_stats AS (\n    SELECT\n        pokemon_id,\n        stat_name,\n        base_stat_value\n    FROM (\n        SELECT\n            p.pokemon_id,\n            jsonb_extract_path_text(s.stat_json, 'stat', 'name') AS stat_name,\n            jsonb_extract_path_text(s.stat_json, 'base_stat')::integer AS base_stat_value\n        FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n        CROSS JOIN LATERAL (\n            SELECT jsonb_array_elements(\n                COALESCE(NULLIF(p.stats::text, 'null')::jsonb, '[]'::jsonb)\n            ) AS stat_json\n        ) s\n    ) extracted_stats\n),\n\nstats_aggregated AS (\n    SELECT\n        pokemon_id,\n        MAX(CASE WHEN stat_name = 'hp' THEN base_stat_value ELSE 0 END) AS base_hp,\n        MAX(CASE WHEN stat_name = 'attack' THEN base_stat_value ELSE 0 END) AS base_attack,\n        MAX(CASE WHEN stat_name = 'defense' THEN base_stat_value ELSE 0 END) AS base_defense,\n        MAX(CASE WHEN stat_name = 'special-attack' THEN base_stat_value ELSE 0 END) AS base_special_attack,\n        MAX(CASE WHEN stat_name = 'special-defense' THEN base_stat_value ELSE 0 END) AS base_special_defense,\n        MAX(CASE WHEN stat_name = 'speed' THEN base_stat_value ELSE 0 END) AS base_speed,\n        SUM(base_stat_value) AS total_base_stats\n    FROM pokemon_stats\n    GROUP BY pokemon_id\n),\n\nspecies_data AS (\n    SELECT\n        pokemon_id,\n        jsonb_extract_path_text(species, 'url') AS species_url,\n        COALESCE(jsonb_extract_path_text(species, 'is_legendary')::boolean, false) AS is_legendary,\n        COALESCE(jsonb_extract_path_text(species, 'is_mythical')::boolean, false) AS is_mythical\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"\n    WHERE pokemon_id IS NOT NULL\n),\n\npokemon_base AS (\n    SELECT\n        p.pokemon_id,\n        p.pokemon_name,\n        \n        -- Get primary and secondary types from the slots\n        (SELECT pt.type_name\n         FROM pokemon_types pt\n         WHERE pt.pokemon_id = p.pokemon_id AND pt.type_slot = 1\n         LIMIT 1) AS primary_type,\n         \n        (SELECT pt.type_name\n         FROM pokemon_types pt\n         WHERE pt.pokemon_id = p.pokemon_id AND pt.type_slot = 2\n         LIMIT 1) AS secondary_type,\n        \n        ps.base_hp,\n        ps.base_attack,\n        ps.base_defense,\n        ps.base_special_attack,\n        ps.base_special_defense,\n        ps.base_speed,\n        ps.total_base_stats,\n        sp.is_legendary,\n        sp.is_mythical\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n    LEFT JOIN stats_aggregated ps ON p.pokemon_id = ps.pokemon_id\n    LEFT JOIN species_data sp ON p.pokemon_id = sp.pokemon_id\n    WHERE p.pokemon_id IS NOT NULL\n)\n\nSELECT\n    -- Primary key for this fact table\n    md5(cast(coalesce(cast(pb.pokemon_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS pokemon_stats_key,\n    \n    -- Foreign keys\n    pb.pokemon_id,\n    pb.pokemon_name,\n    pb.primary_type,\n    pb.secondary_type,\n    \n    -- Base stats\n    pb.base_hp,\n    pb.base_attack,\n    pb.base_defense,\n    pb.base_special_attack,\n    pb.base_special_defense,\n    pb.base_speed,\n    pb.total_base_stats,\n    \n    -- Calculated stat metrics\n    ROUND((pb.base_hp + pb.base_defense + pb.base_special_defense) / 3.0, 1) AS defensive_average,\n    ROUND((pb.base_attack + pb.base_special_attack + pb.base_speed) / 3.0, 1) AS offensive_average,\n    \n    -- Stat classification\n    CASE\n        WHEN pb.total_base_stats >= 580 THEN 'Elite'\n        WHEN pb.total_base_stats >= 500 THEN 'Strong'\n        WHEN pb.total_base_stats >= 420 THEN 'Average'\n        ELSE 'Basic'\n    END AS stat_class,\n    \n    -- Battle focus based on stats\n    CASE\n        WHEN (pb.base_attack + pb.base_special_attack) > \n             (pb.base_defense + pb.base_special_defense) + 20 THEN 'Offensive'\n        WHEN (pb.base_defense + pb.base_special_defense) > \n             (pb.base_attack + pb.base_special_attack) + 20 THEN 'Defensive'\n        ELSE 'Balanced'\n    END AS battle_focus,\n    \n    -- Attack preference\n    CASE\n        WHEN pb.base_attack > pb.base_special_attack + 20 THEN 'Physical'\n        WHEN pb.base_special_attack > pb.base_attack + 20 THEN 'Special'\n        ELSE 'Mixed'\n    END AS attack_preference,\n    \n    -- Special status\n    pb.is_legendary,\n    pb.is_mythical,\n    \n    -- Meta field for tracking changes\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM pokemon_base pb\nWHERE pb.pokemon_id IS NOT NULL\nORDER BY pb.total_base_stats DESC", "relation_name": "\"nerd_facts\".\"public\".\"fact_pokemon_stats\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:02.251439Z", "completed_at": "2025-03-24T09:38:02.277516Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:02.278316Z", "completed_at": "2025-03-24T09:38:02.416332Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.1723790168762207, "adapter_response": {"_message": "SELECT 82", "code": "SELECT", "rows_affected": 82}, "message": "SELECT 82", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_planets_characters", "compiled": true, "compiled_code": "\n\n/*\n  Model: int_swapi_planets_characters\n  Description: Creates a relationship table between planets and characters\n  Source: Using people.homeworld references\n*/\n\n-- Characters with homeworlds (direct homeworld reference)\nwith character_homeworlds as (\n    select\n        people_id,\n        homeworld::integer as planet_id,\n        'Homeworld' as relationship_type\n    from \"nerd_facts\".\"public\".\"stg_swapi_people\"\n    where homeworld is not null\n)\n\n-- Final output with useful metadata\nselect \n    ch.people_id,\n    ch.planet_id,\n    ch.relationship_type,\n    p.name as character_name,\n    pl.name as planet_name,\n    p.gender,\n    pl.climate,\n    pl.terrain,\n    -- Create a unique key for the relationship\n    md5(cast(coalesce(cast(ch.people_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(ch.planet_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as character_planet_key\nfrom \n    character_homeworlds ch\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_people\" p on ch.people_id = p.people_id\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_planets\" pl on ch.planet_id = pl.planet_id\norder by\n    pl.name, p.name", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_planets_characters\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:02.332468Z", "completed_at": "2025-03-24T09:38:02.378074Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:02.380242Z", "completed_at": "2025-03-24T09:38:02.522599Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.19258356094360352, "adapter_response": {"_message": "SELECT 55", "code": "SELECT", "rows_affected": 55}, "message": "SELECT 55", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_films_starships", "compiled": true, "compiled_code": "\n\n/*\n  Model: int_swapi_films_starships\n  Description: Creates a comprehensive many-to-many relationship table between films and starships\n  Source: Combines data from both films.starships and starships.films arrays for completeness\n*/\n\n-- Get relationships from films perspective\nwith films_to_starships as (\n    select\n        film_id,\n        jsonb_array_elements_text(starships::jsonb)::integer as starship_id\n    from \"nerd_facts\".\"public\".\"stg_swapi_films\"\n    where starships is not null and jsonb_array_length(starships::jsonb) > 0\n),\n\n-- Get relationships from starships perspective\nstarships_to_films as (\n    select\n        starship_id,\n        jsonb_array_elements_text(films::jsonb)::integer as film_id\n    from \"nerd_facts\".\"public\".\"stg_swapi_starships\"\n    where films is not null and jsonb_array_length(films::jsonb) > 0\n),\n\n-- Combine both sources with UNION\ncombined_relationships as (\n    select film_id, starship_id from films_to_starships\n    union\n    select film_id, starship_id from starships_to_films\n),\n\n-- Remove any duplicates\nunique_relationships as (\n    select distinct film_id, starship_id \n    from combined_relationships\n)\n\n-- Final output with useful metadata\nselect \n    ur.film_id,\n    ur.starship_id,\n    f.title as film_title,\n    s.starship_name,\n    f.release_date,\n    -- Create a unique key for the relationship\n    md5(cast(coalesce(cast(ur.film_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(ur.starship_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as film_starship_key\nfrom \n    unique_relationships ur\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_films\" f on ur.film_id = f.film_id\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_starships\" s on ur.starship_id = s.starship_id\norder by\n    f.release_date, s.starship_name", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_films_starships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:02.426000Z", "completed_at": "2025-03-24T09:38:02.435759Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:02.436324Z", "completed_at": "2025-03-24T09:38:02.686694Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.26285362243652344, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_starships", "compiled": true, "compiled_code": "\n\nwith starships as (        \n    select\n        \n        starship_id,\n        starship_name,\n        model,\n        manufacturer,\n        crew,\n        starship_class,\n        consumables,        \n        cost_in_credits,\n        length,\n        max_atmosphering_speed,\n        cargo_capacity,        \n        passengers,\n        hyperdrive_rating,\n        MGLT,\n\n         -- Entity counts \n        CASE WHEN pilots IS NOT NULL THEN jsonb_array_length(pilots::jsonb) ELSE 0 END AS pilot_count,\n        CASE WHEN films IS NOT NULL THEN jsonb_array_length(films::jsonb) ELSE 0 END AS film_appearances,\n\n        -- Ship classification\n        CASE\n            WHEN lower(starship_class) IN ('corvette', 'frigate', 'star destroyer', 'dreadnought')\n                OR lower(starship_name) LIKE '%star destroyer%' THEN 'Military'\n            WHEN lower(starship_class) IN ('transport', 'freighter', 'yacht') \n                OR lower(starship_name) LIKE '%transport%' THEN 'Commercial'\n            WHEN lower(starship_class) IN ('starfighter', 'bomber', 'assault ship')\n                OR lower(starship_name) LIKE '%fighter%' THEN 'Starfighter'\n            ELSE 'Other'\n        END AS ship_purpose,\n\n        -- Notable ship flag\n        CASE\n            WHEN starship_name IN ('Millennium Falcon', 'Death Star', 'Star Destroyer', \n                        'X-wing', 'TIE Advanced x1', 'Executor', 'Slave 1') \n            THEN TRUE\n            ELSE FALSE\n        END AS is_notable_ship,\n\n        created_at,\n        edited_at,\n        dbt_loaded_at,\n        url\n    from \"nerd_facts\".\"public\".\"stg_swapi_starships\"\n)\n\nselect * from starships", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_starships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:02.528734Z", "completed_at": "2025-03-24T09:38:02.665950Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:02.666646Z", "completed_at": "2025-03-24T09:38:02.770478Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.24343490600585938, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_starships_people", "compiled": true, "compiled_code": "\n\n/*\n  Model: int_swapi_starships_people\n  Description: Creates a minimal many-to-many relationship table between films and people (pilots)\n  Source: stg_swapi_films.starships JSONB array\n*/\n\nwith starships_with_pilots as (\n    select\n        starship_id,\n        -- Extract each planet ID from the JSONB array\n        jsonb_array_elements_text(pilots::jsonb) as people_id_text\n    from \"nerd_facts\".\"public\".\"stg_swapi_starships\"\n    where pilots is not null and jsonb_array_length(pilots::jsonb) > 0\n)\n\nselect\n    s.starship_id,\n    -- Cast the starship ID from text to integer\n    s.people_id_text::integer as people_id\nfrom \n    starships_with_pilots s\norder by\n    starship_id, people_id", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_starships_people\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:00.602060Z", "completed_at": "2025-03-24T09:38:00.614142Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:00.614681Z", "completed_at": "2025-03-24T09:38:02.765772Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 2.165308952331543, "adapter_response": {"_message": "SELECT 1302", "code": "SELECT", "rows_affected": 1302}, "message": "SELECT 1302", "failures": null, "unique_id": "model.nerd_facts_dbt.fact_pokemon", "compiled": true, "compiled_code": "\n\n/*\n  Model: fact_pokemon\n  Description: Core fact table for Pok\u00e9mon data with comprehensive attributes and classifications\n  \n  Notes:\n  - Contains essential information about each Pok\u00e9mon species\n  - Links to all related dimension tables (types, abilities, moves, etc.)\n  - Provides both source fields and derived/calculated metrics\n  - Includes generation, evolutionary, and classification data\n  - Serves as the central entity for all Pok\u00e9mon analysis\n*/\n\nWITH pokemon_types AS (\n    SELECT\n        pokemon_id,\n        jsonb_array_elements(\n            COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n        )->>'type' AS type_json,\n        (jsonb_array_elements(\n            COALESCE(NULLIF(types::text, 'null')::jsonb, '[]'::jsonb)\n        )->'slot')::int AS type_slot\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"\n    WHERE pokemon_id IS NOT NULL\n),\n\nstats_extract AS (\n    SELECT\n        pokemon_id,\n        jsonb_array_elements(\n            COALESCE(NULLIF(stats::text, 'null')::jsonb, '[]'::jsonb)\n        ) AS stat_data\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"\n    WHERE pokemon_id IS NOT NULL\n),\n\npokemon_stats AS (\n    SELECT\n        pokemon_id,\n        SUM(CASE WHEN (stat_data->'stat'->>'name') = 'hp' \n                 THEN (stat_data->>'base_stat')::integer ELSE 0 END) AS base_stat_hp,\n        SUM((stat_data->>'base_stat')::integer) AS total_base_stats\n    FROM stats_extract\n    GROUP BY pokemon_id\n),\n\nspecies_data AS (\n    SELECT\n        pokemon_id,\n        jsonb_extract_path_text(species, 'url') AS species_url,\n        -- Extract generation number from the URL using LATERAL join\n        (SELECT gen.gen_num::integer\n         FROM LATERAL (\n             SELECT (regexp_matches(jsonb_extract_path_text(species, 'url'), '/generation/([0-9]+)/'))[1] AS gen_num\n             WHERE jsonb_extract_path_text(species, 'url') ~ '/generation/([0-9]+)/'\n         ) gen) AS generation_number,\n        COALESCE(jsonb_extract_path_text(species, 'is_legendary')::boolean, false) AS is_legendary,\n        COALESCE(jsonb_extract_path_text(species, 'is_mythical')::boolean, false) AS is_mythical\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\"\n    WHERE pokemon_id IS NOT NULL\n),\n\nbase_pokemon AS (\n    SELECT\n        -- Core identifiers\n        p.pokemon_id,\n        p.pokemon_name,\n        \n        -- Get primary and secondary types from the slots\n        (SELECT jsonb_extract_path_text(pt.type_json::jsonb, 'name')\n         FROM pokemon_types pt\n         WHERE pt.pokemon_id = p.pokemon_id AND pt.type_slot = 1\n         LIMIT 1) AS primary_type,\n         \n        (SELECT jsonb_extract_path_text(pt.type_json::jsonb, 'name')\n         FROM pokemon_types pt\n         WHERE pt.pokemon_id = p.pokemon_id AND pt.type_slot = 2\n         LIMIT 1) AS secondary_type,\n         \n        sp.generation_number,\n        sp.is_legendary,\n        sp.is_mythical,\n        \n        -- Physical attributes\n        p.height / 10.0 AS height_dm,\n        p.weight / 10.0 AS weight_kg,\n        p.base_experience AS base_xp,\n        \n        -- Base stats\n        ps.base_stat_hp,\n        ps.total_base_stats\n    FROM \"nerd_facts\".\"public\".\"stg_pokeapi_pokemon\" p\n    LEFT JOIN pokemon_stats ps ON p.pokemon_id = ps.pokemon_id\n    LEFT JOIN species_data sp ON p.pokemon_id = sp.pokemon_id\n    WHERE p.pokemon_id IS NOT NULL\n)\n\nSELECT\n    -- Primary key and identifiers\n    md5(cast(coalesce(cast(bp.pokemon_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS pokemon_key,\n    bp.pokemon_id,\n    \n    -- Core data\n    bp.pokemon_name,\n    bp.primary_type,\n    bp.secondary_type,\n    \n    -- Physical attributes\n    bp.height_dm AS height_m,\n    bp.weight_kg,\n    bp.base_xp,\n    \n    -- Stats\n    bp.base_stat_hp,\n    bp.total_base_stats,\n    \n    -- Type keys\n    md5(cast(coalesce(cast(bp.primary_type as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS primary_type_key,\n    md5(cast(coalesce(cast(bp.secondary_type as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS secondary_type_key,\n    \n    -- Additional attributes\n    bp.generation_number,\n    bp.is_legendary,\n    bp.is_mythical,\n    \n    -- Meta\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n\nFROM base_pokemon bp\nWHERE bp.pokemon_id IS NOT NULL\nORDER BY bp.total_base_stats DESC", "relation_name": "\"nerd_facts\".\"public\".\"fact_pokemon\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:37:55.317647Z", "completed_at": "2025-03-24T09:37:55.338462Z"}, {"name": "execute", "started_at": "2025-03-24T09:37:55.338999Z", "completed_at": "2025-03-24T09:38:02.937224Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 7.622557163238525, "adapter_response": {"_message": "SELECT 456375", "code": "SELECT", "rows_affected": 456375}, "message": "SELECT 456375", "failures": null, "unique_id": "model.nerd_facts_dbt.fact_netrunner_cards", "compiled": true, "compiled_code": "/*\n  Model: fact_netrunner_cards\n  Description: Fact table for Android: Netrunner cards with metrics and relationships\n  \n  Notes:\n  - Contains key metrics about card usage, efficiency, and value\n  - Links to dimension tables for cards, factions, packs, and types\n  - Includes derived metrics for cards such as cost efficiency and power indices\n  - Provides temporal context through release dates and rotation status\n  - Combines multiple data sources for comprehensive analysis\n*/\n\nWITH card_metrics AS (\n    -- Calculate and derive card-specific metrics\n    SELECT\n        c.code AS card_code,\n        c.card_id,\n        c.card_name,\n        c.faction_code,\n        c.side_code,\n        c.type_code,\n        c.pack_code,\n        \n        -- Core card attributes - keep as text for now\n        c.cost,\n        c.strength,\n        c.advancement_cost,\n        c.agenda_points,\n        c.memory_cost,\n        c.trash_cost,\n        c.faction_cost,\n        \n        -- Calculate cost efficiency metrics with proper type casting\n        CASE \n            -- For ICE, calculate strength-to-cost ratio\n            WHEN c.type_code = 'ice' AND c.cost::TEXT ~ '^[0-9]+$' AND c.cost::NUMERIC > 0 \n                 AND c.strength IS NOT NULL AND c.strength::TEXT ~ '^[0-9]+(\\.[0-9]+)?$'\n            THEN ROUND((c.strength::NUMERIC / c.cost::NUMERIC), 2)\n            \n            -- For Agendas, calculate points-to-advancement ratio\n            WHEN c.type_code = 'agenda' AND c.advancement_cost::TEXT ~ '^[0-9]+$' \n                 AND c.advancement_cost::NUMERIC > 0 AND c.agenda_points IS NOT NULL \n                 AND c.agenda_points::TEXT ~ '^[0-9]+$'\n            THEN ROUND((c.agenda_points::NUMERIC / c.advancement_cost::NUMERIC), 2)\n            \n            -- For Programs/Hardware, basic cost efficiency if applicable\n            WHEN c.type_code IN ('program', 'hardware') AND c.cost::TEXT ~ '^[0-9]+$' \n                 AND c.cost::NUMERIC > 0 AND c.strength IS NOT NULL \n                 AND c.strength::TEXT ~ '^[0-9]+(\\.[0-9]+)?$'\n            THEN ROUND((c.strength::NUMERIC / c.cost::NUMERIC), 2)\n            \n            ELSE NULL\n        END AS cost_efficiency_ratio,\n        \n        -- Calculate text length (proxy for card complexity)\n        LENGTH(c.text) AS text_length,\n        \n        -- Calculate influence efficiency with safe type casting\n        CASE\n            WHEN c.faction_cost::TEXT ~ '^[0-9]+$' AND c.faction_cost::NUMERIC > 0 \n                 AND c.agenda_points IS NOT NULL AND c.agenda_points::TEXT ~ '^[0-9]+$'\n            THEN ROUND((c.agenda_points::NUMERIC / c.faction_cost::NUMERIC), 2)\n            \n            WHEN c.faction_cost::TEXT ~ '^[0-9]+$' AND c.faction_cost::NUMERIC > 0 \n                 AND c.strength IS NOT NULL AND c.strength::TEXT ~ '^[0-9]+(\\.[0-9]+)?$'\n            THEN ROUND((c.strength::NUMERIC / c.faction_cost::NUMERIC), 2)\n            \n            ELSE NULL\n        END AS influence_efficiency,\n        \n        -- Keywords count\n        CASE WHEN c.keywords IS NOT NULL \n             THEN COALESCE(ARRAY_LENGTH(STRING_TO_ARRAY(c.keywords, ' - '), 1), 0)\n             ELSE 0 \n        END AS keyword_count,\n        \n        -- Reference pack info\n        p.release_at,\n        p.cycle_code,\n        \n        -- Simulated usage data - no type casting needed here\n        CASE\n            WHEN c.card_name IN ('Account Siphon', 'Desperado', 'SanSan City Grid', \n                              'Astroscript Pilot Program', 'Hedge Fund', 'Sure Gamble') THEN 95\n            WHEN c.pack_code = 'core' AND c.faction_code IS NOT NULL THEN 70\n            WHEN c.faction_code IS NULL THEN 30\n            WHEN p.cycle_code IN ('genesis', 'creation-and-control') THEN 60\n            WHEN p.release_at IS NULL THEN 20\n            WHEN DATE_PART('year', p.release_at::timestamp) <= 2014 THEN 65\n            WHEN DATE_PART('year', p.release_at::timestamp) <= 2016 THEN 50\n            ELSE 40\n        END AS popularity_score\n        \n    FROM \"nerd_facts\".\"public\".\"stg_netrunner_cards\" c\n    LEFT JOIN \"nerd_facts\".\"public\".\"stg_netrunner_packs\" p ON c.pack_code = p.code\n)\n\nSELECT\n    -- Primary keys and relationships\n    md5(cast(coalesce(cast(cm.card_code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS card_fact_key,\n    cm.card_code,\n    cm.card_id,\n    \n    -- Foreign keys to dimension tables\n    md5(cast(coalesce(cast(cm.card_code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS card_key,\n    md5(cast(coalesce(cast(cm.faction_code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS faction_key,\n    md5(cast(coalesce(cast(cm.pack_code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS pack_key,\n    md5(cast(coalesce(cast(cm.side_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(cm.type_code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS card_type_key,\n    \n    -- Essential card attributes \n    cm.card_name,\n    cm.faction_code,\n    cm.side_code,\n    cm.type_code,\n    cm.pack_code,\n    \n    -- Core card metrics with safe type handling\n    CASE WHEN cm.cost::TEXT ~ '^[0-9]+$' THEN cm.cost::INTEGER ELSE 0 END AS cost,\n    CASE WHEN cm.strength::TEXT ~ '^[0-9\\.]+$' THEN cm.strength::NUMERIC ELSE 0 END AS strength,\n    CASE WHEN cm.advancement_cost::TEXT ~ '^[0-9]+$' THEN cm.advancement_cost::INTEGER ELSE 0 END AS advancement_requirement,\n    CASE WHEN cm.agenda_points::TEXT ~ '^[0-9]+$' THEN cm.agenda_points::INTEGER ELSE 0 END AS agenda_points,\n    CASE WHEN cm.memory_cost::TEXT ~ '^[0-9]+$' THEN cm.memory_cost::INTEGER ELSE 0 END AS memory_cost,\n    CASE WHEN cm.trash_cost::TEXT ~ '^[0-9]+$' THEN cm.trash_cost::INTEGER ELSE 0 END AS trash_cost,\n    \n    -- Calculated metrics\n    cm.cost_efficiency_ratio,\n    cm.text_length AS complexity_score,\n    cm.influence_efficiency,\n    cm.keyword_count,\n    \n    -- Usage and popularity metrics\n    cm.popularity_score,\n    CASE\n        WHEN cm.popularity_score >= 80 THEN 'Meta Defining'\n        WHEN cm.popularity_score >= 60 THEN 'Staple'\n        WHEN cm.popularity_score >= 40 THEN 'Playable'\n        ELSE 'Niche'\n    END AS popularity_tier,\n    \n    -- Deck construction significance\n    CASE\n        WHEN cm.card_name IN ('Hedge Fund', 'Sure Gamble', 'IPO', 'Dirty Laundry') THEN 'Auto-include'\n        WHEN cm.popularity_score >= 75 THEN 'High Impact'\n        WHEN cm.popularity_score >= 50 THEN 'Medium Impact'\n        ELSE 'Low Impact'\n    END AS deck_impact,\n    \n    -- Time dimensions\n    cm.release_at,\n    cm.cycle_code,\n    CASE \n        WHEN cm.cycle_code IN ('core', 'genesis', 'creation-and-control', 'spin') THEN 'First Rotation'\n        WHEN cm.cycle_code IN ('lunar', 'order-and-chaos', 'sansan', 'mumbad') THEN 'Second Rotation'\n        ELSE 'Current'\n    END AS rotation_group,\n    \n    -- Card pool status (current as of 2025)\n    CASE\n        WHEN cm.cycle_code IN ('core', 'genesis', 'creation-and-control', 'spin', \n                           'lunar', 'order-and-chaos', 'sansan', 'mumbad',\n                           'flashpoint', 'red-sand') THEN 'Rotated'\n        WHEN cm.cycle_code IN ('terminal-directive', 'core2', 'kitara', 'reign-and-reverie') THEN 'Standard'\n        WHEN cm.cycle_code IS NULL THEN 'Unknown'\n        ELSE 'Standard'\n    END AS card_pool_status,\n    \n    -- Card value index (composite score)\n    ROUND(\n        (COALESCE(cm.popularity_score, 0) * 0.6) + \n        (COALESCE(cm.cost_efficiency_ratio, 0) * 20) +\n        (CASE WHEN cm.type_code = 'identity' THEN 30 ELSE 0 END) +\n        (CASE WHEN cm.card_name IN ('Account Siphon', 'Astroscript Pilot Program', 'Jackson Howard') THEN 40 ELSE 0 END)\n    ) AS card_value_index,\n    \n    -- Data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n\nFROM card_metrics cm", "relation_name": "\"nerd_facts\".\"public\".\"fact_netrunner_cards\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:02.701426Z", "completed_at": "2025-03-24T09:38:02.720998Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:02.721905Z", "completed_at": "2025-03-24T09:38:02.833684Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.1343679428100586, "adapter_response": {"_message": "SELECT 52", "code": "SELECT", "rows_affected": 52}, "message": "SELECT 52", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_characters_species", "compiled": true, "compiled_code": "\n\n/*\n  Model: int_swapi_characters_species\n  Description: Creates a comprehensive relationship table between characters and species\n  Source: Combines character-to-species and species-to-people relationships\n*/\n\n-- Hardcoded character-species associations since staging model doesn't have species_ids\nwith character_species as (\n    select * from (values\n        (1, 1),  -- Luke Skywalker - Human\n        (2, 2),  -- C-3PO - Droid\n        (3, 2),  -- R2-D2 - Droid\n        (4, 1)   -- Darth Vader - Human\n    ) as v(character_id, species_id)\n),\n\n-- Species with characters (people of that species)\nspecies_characters as (\n    select\n        species_id,\n        jsonb_array_elements_text(people::jsonb)::integer as character_id\n    from \"nerd_facts\".\"public\".\"stg_swapi_species\"\n    where people is not null and jsonb_array_length(people::jsonb) > 0\n),\n\n-- Combine both sources with UNION\ncombined_relationships as (\n    select character_id, species_id from character_species\n    union\n    select character_id, species_id from species_characters\n),\n\n-- Remove any duplicates\nunique_relationships as (\n    select distinct character_id, species_id \n    from combined_relationships\n)\n\n-- Final output with useful metadata\nselect \n    ur.character_id,\n    ur.species_id,\n    p.name as character_name,\n    s.species_name,\n    p.gender,\n    s.classification,\n    s.language,\n    -- Create a unique key for the relationship\n    md5(cast(coalesce(cast(ur.character_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(ur.species_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as character_species_key\nfrom \n    unique_relationships ur\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_people\" p on ur.character_id = p.people_id  -- Changed to people_id\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_species\" s on ur.species_id = s.species_id\norder by\n    s.species_name, p.name", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_characters_species\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.386802Z", "completed_at": "2025-03-24T09:38:03.402792Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.408210Z", "completed_at": "2025-03-24T09:38:03.518621Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.14662504196166992, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_species", "compiled": true, "compiled_code": "\n\nwith species as (        \n    select\n    species_id,\n    species_name,\n    classification,\n    designation,        \n    skin_colors,\n    hair_colors,\n    eye_colors,                \n    language,    \n    average_lifespan,\n    average_height,\n    people,\n    homeworld,\n    created_at,\n    edited_at,\n    dbt_loaded_at,\n    url\n    from \"nerd_facts\".\"public\".\"stg_swapi_species\"\n)\n\nselect * from species", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_species\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.379480Z", "completed_at": "2025-03-24T09:38:03.386339Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.390961Z", "completed_at": "2025-03-24T09:38:03.515871Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.15047240257263184, "adapter_response": {"_message": "SELECT 73", "code": "SELECT", "rows_affected": 73}, "message": "SELECT 73", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_films_species", "compiled": true, "compiled_code": "\n\n/*\n  Model: int_swapi_films_species\n  Description: Creates a relationship table between films and species\n  Source: Using films.species array\n*/\n\n-- Get relationships from films perspective (only direction available)\nwith films_to_species as (\n    select\n        film_id,\n        jsonb_array_elements_text(species::jsonb)::integer as species_id\n    from \"nerd_facts\".\"public\".\"stg_swapi_films\"\n    where species is not null and jsonb_array_length(species::jsonb) > 0\n)\n\n-- Final output with useful metadata\nselect \n    fs.film_id,\n    fs.species_id,\n    f.title as film_title,\n    -- Using different field names based on your stg_swapi_species structure\n    s.species_name, -- Changed from s.name\n    f.release_date,\n    s.classification,\n    s.language,\n    -- Create a unique key for the relationship\n    md5(cast(coalesce(cast(fs.film_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(fs.species_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as film_species_key\nfrom \n    films_to_species fs\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_films\" f on fs.film_id = f.film_id\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_species\" s on fs.species_id = s.species_id\norder by\n    f.release_date, s.species_name -- Changed sort order to use species_name", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_films_species\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.403296Z", "completed_at": "2025-03-24T09:38:03.417061Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.424803Z", "completed_at": "2025-03-24T09:38:03.535222Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.15239667892456055, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_vehicles", "compiled": true, "compiled_code": "\n\nwith vehicles as (        \n    select\n    vehicle_id,    \n    vehicle_name,\n    model,\n    manufacturer,\n    vehicle_class,\n    consumables,    \n    cost_in_credits,\n    length,\n    max_atmosphering_speed,\n    cargo_capacity,\n    passengers,\n    crew,\n\n        -- Derived vehicle classifications\n    CASE\n        WHEN LOWER(vehicle_class) LIKE '%walker%' OR LOWER(vehicle_class) LIKE '%tank%' THEN 'Military'\n        WHEN LOWER(vehicle_class) LIKE '%fighter%' OR LOWER(vehicle_class) LIKE '%bomber%' THEN 'Military'\n        WHEN LOWER(vehicle_class) LIKE '%transport%' THEN 'Transport'\n        WHEN LOWER(vehicle_class) LIKE '%speeder%' THEN \n            CASE\n                WHEN LOWER(vehicle_name) LIKE '%military%' THEN 'Military'\n                ELSE 'Civilian'\n            END\n        WHEN LOWER(vehicle_class) LIKE '%airspeeder%' THEN\n            CASE\n                WHEN LOWER(vehicle_name) LIKE '%military%' THEN 'Military'\n                ELSE 'Civilian' \n            END\n        WHEN LOWER(vehicle_class) LIKE '%shuttle%' THEN 'Transport'\n        WHEN LOWER(vehicle_class) LIKE '%barge%' OR LOWER(vehicle_class) LIKE '%yacht%' THEN 'Leisure/Luxury'\n        WHEN LOWER(vehicle_class) LIKE '%crawler%' OR LOWER(vehicle_class) LIKE '%digger%' THEN 'Industrial'\n        ELSE 'Multipurpose'\n    END AS vehicle_purpose,\n\n    -- Size classification\n    CASE\n        WHEN length > 100 THEN 'Massive'\n        WHEN length > 20 THEN 'Large'\n        WHEN length > 10 THEN 'Medium'\n        WHEN length > 5 THEN 'Small'\n        ELSE 'Tiny'\n    END AS vehicle_size,\n\n    -- Terrain capabilities\n    CASE\n        WHEN LOWER(vehicle_class) LIKE '%walker%' THEN 'Ground'\n        WHEN LOWER(vehicle_class) LIKE '%speeder%' AND LOWER(vehicle_class) NOT LIKE '%airspeeder%' THEN 'Ground'\n        WHEN LOWER(vehicle_class) LIKE '%airspeeder%' THEN 'Air'\n        WHEN LOWER(vehicle_class) LIKE '%submarine%' THEN 'Water'\n        WHEN LOWER(vehicle_class) LIKE '%crawler%' THEN 'Ground'\n        WHEN LOWER(vehicle_class) LIKE '%barge%' AND LOWER(vehicle_class) LIKE '%sail%' THEN 'Ground/Water'\n        WHEN LOWER(vehicle_class) LIKE '%snowspeeder%' OR LOWER(vehicle_name) LIKE '%snow%' THEN 'Snow/Ice'\n        WHEN LOWER(vehicle_class) LIKE '%repulsor%' THEN 'Air/Ground'\n        ELSE 'Multi-terrain'\n    END AS terrain_capability,\n\n    -- Notable vehicle flag\n    CASE\n        WHEN LOWER(vehicle_name) IN ('at-at', 'at-st', 'snowspeeder', 'speeder bike', 'tie bomber', \n                           'tie fighter', 'x-34 landspeeder', 'sand crawler', 'sail barge') THEN TRUE\n        ELSE FALSE\n    END AS is_notable_vehicle,    \n\n    -- Calculate total capacity as sum of crew and passengers\n    crew + passengers AS total_capacity,\n\n    created_at,\n    edited_at,\n    dbt_loaded_at,\n    url\n    from \"nerd_facts\".\"public\".\"stg_swapi_vehicles\"\n)\n\nselect * from vehicles", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_vehicles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.397565Z", "completed_at": "2025-03-24T09:38:03.416534Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.419005Z", "completed_at": "2025-03-24T09:38:03.569776Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.1930077075958252, "adapter_response": {"_message": "SELECT 49", "code": "SELECT", "rows_affected": 49}, "message": "SELECT 49", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_films_vehicles", "compiled": true, "compiled_code": "\n\n/*\n  Model: int_swapi_films_vehicles\n  Description: Creates a comprehensive many-to-many relationship table between films and vehicles\n  Source: Combines data from both films.vehicles and vehicles.films arrays for completeness\n*/\n\n-- Get relationships from films perspective\nwith films_to_vehicles as (\n    select\n        film_id,\n        jsonb_array_elements_text(vehicles::jsonb)::integer as vehicle_id\n    from \"nerd_facts\".\"public\".\"stg_swapi_films\"\n    where vehicles is not null and jsonb_array_length(vehicles::jsonb) > 0\n),\n\n-- Get relationships from vehicles perspective\nvehicles_to_films as (\n    select\n        vehicle_id,\n        jsonb_array_elements_text(films::jsonb)::integer as film_id\n    from \"nerd_facts\".\"public\".\"stg_swapi_vehicles\"\n    where films is not null and jsonb_array_length(films::jsonb) > 0\n),\n\n-- Combine both sources with UNION\ncombined_relationships as (\n    select film_id, vehicle_id from films_to_vehicles\n    union\n    select film_id, vehicle_id from vehicles_to_films\n),\n\n-- Remove any duplicates\nunique_relationships as (\n    select distinct film_id, vehicle_id \n    from combined_relationships\n)\n\n-- Final output with useful metadata\nselect \n    ur.film_id,\n    ur.vehicle_id,\n    f.title as film_title,\n    v.vehicle_name,\n    f.release_date,\n    v.model,\n    v.manufacturer,\n    -- Create a unique key for the relationship\n    md5(cast(coalesce(cast(ur.film_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(ur.vehicle_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as film_vehicle_key\nfrom \n    unique_relationships ur\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_films\" f on ur.film_id = f.film_id\njoin \n    \"nerd_facts\".\"public\".\"stg_swapi_vehicles\" v on ur.vehicle_id = v.vehicle_id\norder by\n    f.release_date, v.vehicle_name", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_films_vehicles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.546845Z", "completed_at": "2025-03-24T09:38:03.558474Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.562983Z", "completed_at": "2025-03-24T09:38:03.668800Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.12505340576171875, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_documentation_coverage", "compiled": true, "compiled_code": "with\n\nmodels as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where resource_type = 'model'\n    and not is_excluded\n),\n\nconversion as (\n    select\n        resource_id,\n        case when is_described then 1 else 0 end as is_described_model,\n        \n            case when model_type = 'base' then 1.0 else NULL end as is_base_model,\n            case when is_described and model_type = 'base' then 1.0 else 0 end as is_described_base_model,\n        \n            case when model_type = 'staging' then 1.0 else NULL end as is_staging_model,\n            case when is_described and model_type = 'staging' then 1.0 else 0 end as is_described_staging_model,\n        \n            case when model_type = 'intermediate' then 1.0 else NULL end as is_intermediate_model,\n            case when is_described and model_type = 'intermediate' then 1.0 else 0 end as is_described_intermediate_model,\n        \n            case when model_type = 'marts' then 1.0 else NULL end as is_marts_model,\n            case when is_described and model_type = 'marts' then 1.0 else 0 end as is_described_marts_model,\n        \n            case when model_type = 'other' then 1.0 else NULL end as is_other_model,\n            case when is_described and model_type = 'other' then 1.0 else 0 end as is_described_other_model\n        \n\n    from models\n),\n\nfinal as (\n    select\n        now() as measured_at,\n        cast(count(*) as integer) as total_models,\n        cast(sum(is_described_model) as integer) as documented_models,\n        round(sum(is_described_model) * 100.00 / count(*), 2) as documentation_coverage_pct,\n        \n            round(\n                \n    ( sum(is_described_base_model) * 100 ) / nullif( ( count(is_base_model) ), 0)\n\n            , 2) as base_documentation_coverage_pct,\n        \n            round(\n                \n    ( sum(is_described_staging_model) * 100 ) / nullif( ( count(is_staging_model) ), 0)\n\n            , 2) as staging_documentation_coverage_pct,\n        \n            round(\n                \n    ( sum(is_described_intermediate_model) * 100 ) / nullif( ( count(is_intermediate_model) ), 0)\n\n            , 2) as intermediate_documentation_coverage_pct,\n        \n            round(\n                \n    ( sum(is_described_marts_model) * 100 ) / nullif( ( count(is_marts_model) ), 0)\n\n            , 2) as marts_documentation_coverage_pct,\n        \n            round(\n                \n    ( sum(is_described_other_model) * 100 ) / nullif( ( count(is_other_model) ), 0)\n\n            , 2) as other_documentation_coverage_pct\n        \n\n    from models\n    left join conversion\n    on models.resource_id = conversion.resource_id\n)\n\nselect * from final", "relation_name": "\"nerd_facts\".\"public\".\"fct_documentation_coverage\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.559040Z", "completed_at": "2025-03-24T09:38:03.570437Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.572095Z", "completed_at": "2025-03-24T09:38:03.675942Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.1427288055419922, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nerd_facts_dbt.int_swapi_vehicles_people", "compiled": true, "compiled_code": "\n\n/*\n  Model: int_swapi_vehicles_people\n  Description: Creates a minimal many-to-many relationship table between vehicles and people (pilots)\n  Source: stg_swapi_films.vehicles JSONB array\n*/\n\nwith vehicles_with_pilots as (\n    select\n        vehicle_id,\n        -- Extract each planet ID from the JSONB array\n        jsonb_array_elements_text(pilots::jsonb) as people_id_text\n    from \"nerd_facts\".\"public\".\"stg_swapi_vehicles\"\n    where pilots is not null and jsonb_array_length(pilots::jsonb) > 0\n)\n\nselect\n    v.vehicle_id,\n    -- Cast the starship ID from text to integer\n    v.people_id_text::integer as people_id\nfrom \n    vehicles_with_pilots v\norder by\n    vehicle_id, people_id", "relation_name": "\"nerd_facts\".\"public\".\"int_swapi_vehicles_people\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.610352Z", "completed_at": "2025-03-24T09:38:03.620800Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.622489Z", "completed_at": "2025-03-24T09:38:03.759032Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.15931367874145508, "adapter_response": {"_message": "SELECT 6", "code": "SELECT", "rows_affected": 6}, "message": "SELECT 6", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_hard_coded_references", "compiled": true, "compiled_code": "-- this model finds cases where a model has hard coded references\n\nwith models as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where resource_type = 'model'\n    and not is_excluded\n),\n\nfinal as (\n    select\n        resource_name as model,\n        hard_coded_references\n    from models\n    where hard_coded_references != ''\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_hard_coded_references\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.586226Z", "completed_at": "2025-03-24T09:38:03.601921Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.603460Z", "completed_at": "2025-03-24T09:38:03.837751Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.2646658420562744, "adapter_response": {"_message": "SELECT 11", "code": "SELECT", "rows_affected": 11}, "message": "SELECT 11", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_duplicate_sources", "compiled": true, "compiled_code": "with sources as (\n    select\n        resource_name,\n        case \n            -- if you're using databricks but not the unity catalog, database will be null\n            when database is NULL then schema || '.' || identifier \n            else database || '.' || schema || '.' || identifier \n        end as source_db_location \n    from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where resource_type = 'source'\n    and not is_excluded\n    -- we order the CTE so that listagg returns values correctly sorted for some warehouses\n    order by 1, 2\n),\n\nsource_duplicates as (\n    select\n        source_db_location,\n        \n    string_agg(\n        resource_name,\n        ', '\n        \n        ) as source_names\n    from sources\n    group by source_db_location\n    having count(*) > 1\n)\n\nselect * from source_duplicates\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_duplicate_sources\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.698346Z", "completed_at": "2025-03-24T09:38:03.709664Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.716679Z", "completed_at": "2025-03-24T09:38:03.899545Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.21294474601745605, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_model_naming_conventions", "compiled": true, "compiled_code": "-- all models with inappropriate (or lack of) pre-fix\n-- ensure dbt project has consistent naming conventions\n\nwith all_graph_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n    -- exclude required metricflow time spine\n    and resource_name != 'metricflow_time_spine'\n),\n\nnaming_convention_prefixes as (\n    select * from \"nerd_facts\".\"public\".\"stg_naming_convention_prefixes\"\n    -- we order the CTE so that listagg returns values correctly sorted for some warehouses\n    order by prefix_value\n), \n\nappropriate_prefixes as (\n    select \n        model_type, \n        \n    string_agg(\n        prefix_value,\n        ', '\n        \n        ) as appropriate_prefixes\n    from naming_convention_prefixes\n    group by model_type\n), \n\nmodels as (\n    select\n        all_graph_resources.resource_name,\n        all_graph_resources.prefix,\n        all_graph_resources.model_type,\n        naming_convention_prefixes.prefix_value\n    from all_graph_resources \n    left join naming_convention_prefixes\n        on all_graph_resources.model_type = naming_convention_prefixes.model_type\n        and all_graph_resources.prefix = naming_convention_prefixes.prefix_value\n    where resource_type = 'model'\n),\n\ninappropriate_model_names as (\n    select \n        models.resource_name,\n        models.prefix,\n        models.model_type,\n        appropriate_prefixes.appropriate_prefixes\n    from models\n    left join appropriate_prefixes\n        on models.model_type = appropriate_prefixes.model_type\n    where nullif(models.prefix_value, '') is null\n\n)\n\nselect * from inappropriate_model_names\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_model_naming_conventions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.710128Z", "completed_at": "2025-03-24T09:38:03.725724Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.727264Z", "completed_at": "2025-03-24T09:38:03.907795Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.21357989311218262, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_public_models_without_contract", "compiled": true, "compiled_code": "with \n\nall_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n),\n\nfinal as (\n\n    select \n        resource_name,\n        is_public,\n        is_contract_enforced\n        \n    from all_resources\n    where \n        is_public \n        and not is_contract_enforced\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_public_models_without_contract\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.839484Z", "completed_at": "2025-03-24T09:38:03.847871Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.848435Z", "completed_at": "2025-03-24T09:38:03.971853Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.14024591445922852, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_source_directories", "compiled": true, "compiled_code": "-- Because we often work with multiple data sources, in our staging directory, we create one directory per source.\n\n-- This model finds all cases where a source definition is NOT in the appropriate subdirectory.\n\n\n\nwith all_graph_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n),\n\n-- find all sources that are definied in a .yml file NOT in their subdirectory\ninappropriate_subdirectories_sources as (\n    select \n        resource_name,\n        resource_type,\n        file_path as current_file_path,\n        'models/' || 'staging' || '/' || source_name || '/' || file_name as change_file_path_to\n    from all_graph_resources\n    where resource_type = 'source'\n    and directory_path not like '%' || source_name || '%'\n)\n\nselect * from inappropriate_subdirectories_sources\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_source_directories\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.864892Z", "completed_at": "2025-03-24T09:38:03.872063Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.879562Z", "completed_at": "2025-03-24T09:38:04.024768Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.1629011631011963, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_sources_without_freshness", "compiled": true, "compiled_code": "with\n\nall_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n\n),\n\nfinal as (\n\n    select distinct\n        resource_name\n\n    from all_resources\n    where not is_freshness_enabled and resource_type = 'source'\n\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_sources_without_freshness\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.934668Z", "completed_at": "2025-03-24T09:38:03.946537Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.955628Z", "completed_at": "2025-03-24T09:38:04.049584Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.12542176246643066, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_undocumented_public_models", "compiled": true, "compiled_code": "with \n\nall_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n),\n\nfinal as (\n    select \n        resource_name,\n        access, \n        is_described, \n        total_defined_columns,\n        total_described_columns\n    \n    from all_resources\n    where \n        is_public \n        and (\n            -- no model level description\n            not is_described\n            -- not all columns defined have descriptions\n            or total_described_columns < total_defined_columns\n            -- no columns defined at all\n            or total_defined_columns = 0\n        )\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_undocumented_public_models\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.925574Z", "completed_at": "2025-03-24T09:38:03.945170Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:03.947124Z", "completed_at": "2025-03-24T09:38:04.061978Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.13911032676696777, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_undocumented_models", "compiled": true, "compiled_code": "with\n\nall_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n\n),\n\nfinal as (\n\n    select\n        resource_name,\n        model_type\n\n    from all_resources\n    where not is_described and resource_type = 'model'\n\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_undocumented_models\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:03.983852Z", "completed_at": "2025-03-24T09:38:03.998813Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.007327Z", "completed_at": "2025-03-24T09:38:04.118239Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.14392638206481934, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_undocumented_source_tables", "compiled": true, "compiled_code": "with\n\nall_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n\n),\n\nfinal as (\n\n    select\n        resource_name\n\n    from all_resources\n    where not is_described and resource_type = 'source'\n\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_undocumented_source_tables\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.037757Z", "completed_at": "2025-03-24T09:38:04.053030Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.053974Z", "completed_at": "2025-03-24T09:38:04.160075Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.12921905517578125, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_undocumented_sources", "compiled": true, "compiled_code": "with\n\nall_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n\n),\n\nfinal as (\n\n    select distinct\n        source_name\n\n    from all_resources\n    where not is_source_described and resource_type = 'source'\n\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_undocumented_sources\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.083117Z", "completed_at": "2025-03-24T09:38:04.091106Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.093301Z", "completed_at": "2025-03-24T09:38:04.222689Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.15303516387939453, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.int_direct_relationships", "compiled": true, "compiled_code": "-- one record for each resource in the graph and its direct parent\nwith \n\nall_graph_resources as (\n    select\n        resource_id,\n        resource_name,\n        resource_type,\n        file_path,\n        directory_path, \n        file_name,\n        model_type,\n        materialized,\n        is_public, \n        access, \n        source_name,\n        is_excluded\n    from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n),\n\ndirect_model_relationships as (\n    select  \n        resource_id,\n        direct_parent_id,\n        is_primary_relationship\n    from \"nerd_facts\".\"public\".\"stg_node_relationships\"\n),\n\ndirect_exposure_relationships as (\n    select  \n        resource_id,\n        direct_parent_id,\n        is_primary_relationship\n    from \"nerd_facts\".\"public\".\"stg_exposure_relationships\"\n),\n\ndirect_metrics_relationships as (\n    select  \n        resource_id,\n        direct_parent_id,\n        is_primary_relationship\n    from \"nerd_facts\".\"public\".\"stg_metric_relationships\"\n),\n\n-- for all resources in the graph, find their direct parent\ndirect_relationships as (\n    select\n        all_graph_resources.resource_id,\n        all_graph_resources.resource_name,\n        all_graph_resources.resource_type,\n        all_graph_resources.file_path,\n        all_graph_resources.directory_path, \n        all_graph_resources.file_name,\n        all_graph_resources.model_type,\n        all_graph_resources.materialized,\n        all_graph_resources.is_public, \n        all_graph_resources.access, \n        all_graph_resources.source_name,\n        all_graph_resources.is_excluded,\n        case \n            when all_graph_resources.resource_type = 'source' then null\n            when all_graph_resources.resource_type = 'exposure' then exposures.direct_parent_id\n            when all_graph_resources.resource_type = 'metric' then metrics.direct_parent_id\n            when all_graph_resources.resource_type in ('model', 'snapshot', 'test') then models.direct_parent_id\n            else null\n        end as direct_parent_id,\n        (\n            all_graph_resources.resource_type = 'test'\n            and models.is_primary_relationship\n        ) as is_primary_test_relationship\n    from all_graph_resources\n    left join direct_model_relationships as models\n        on all_graph_resources.resource_id = models.resource_id\n    left join direct_exposure_relationships as exposures\n        on all_graph_resources.resource_id = exposures.resource_id\n    left join direct_metrics_relationships as metrics\n        on all_graph_resources.resource_id = metrics.resource_id\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(resource_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(direct_parent_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as unique_id,\n        *\n    from direct_relationships\n)\n\nselect * from final", "relation_name": "\"nerd_facts\".\"public\".\"int_direct_relationships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.073992Z", "completed_at": "2025-03-24T09:38:04.107062Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.108980Z", "completed_at": "2025-03-24T09:38:04.310052Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.24576139450073242, "adapter_response": {"_message": "SELECT 33", "code": "SELECT", "rows_affected": 33}, "message": "SELECT 33", "failures": null, "unique_id": "model.nerd_facts_dbt.bridge_sw_films_planets", "compiled": true, "compiled_code": "\n\n/*\n  Model: bridge_sw_films_planets\n  Description: Bridge table connecting films to planets with enriched relationship attributes\n*/\n\nWITH film_planets AS (\n    SELECT\n        fp.film_id,\n        fp.planet_id,\n        f.title AS film_title,\n        p.name AS planet_name,\n        f.release_date,\n        f.episode_id,\n        p.climate,\n        p.terrain\n    FROM \"nerd_facts\".\"public\".\"int_swapi_films_planets\" fp\n    JOIN \"nerd_facts\".\"public\".\"stg_swapi_films\" f ON fp.film_id = f.film_id\n    JOIN \"nerd_facts\".\"public\".\"stg_swapi_planets\" p ON fp.planet_id = p.planet_id\n),\n\n-- Add trilogy and appearance information\nfilm_planets_enriched AS (\n    SELECT \n        fp.*,\n        -- Trilogy classification\n        CASE\n            WHEN fp.episode_id BETWEEN 1 AND 3 THEN 'Prequel Trilogy'\n            WHEN fp.episode_id BETWEEN 4 AND 6 THEN 'Original Trilogy'\n            WHEN fp.episode_id BETWEEN 7 AND 9 THEN 'Sequel Trilogy'\n            ELSE 'Anthology Films'\n        END AS trilogy,\n        \n        -- Extract year for easier querying\n        EXTRACT(YEAR FROM fp.release_date) AS release_year,\n        \n        -- Planet appearance metrics\n        COUNT(*) OVER (PARTITION BY fp.planet_id) AS planet_film_count,\n        (SELECT COUNT(DISTINCT film_id) FROM \"nerd_facts\".\"public\".\"stg_swapi_films\") AS total_films,\n        \n        -- Order of appearance\n        ROW_NUMBER() OVER (\n            PARTITION BY fp.planet_id \n            ORDER BY COALESCE(fp.episode_id, 999)\n        ) AS chronological_appearance_number,\n        \n        ROW_NUMBER() OVER (\n            PARTITION BY fp.planet_id \n            ORDER BY fp.release_date\n        ) AS release_order_appearance_number\n    FROM film_planets fp\n)\n\nSELECT\n    -- Primary Key\n    md5(cast(coalesce(cast(fpe.film_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(fpe.planet_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS film_planet_key,\n    \n    -- Foreign Keys\n    md5(cast(coalesce(cast(fpe.film_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS film_key,\n    md5(cast(coalesce(cast(fpe.planet_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS planet_key,\n    \n    -- Source IDs\n    fpe.film_id,\n    fpe.planet_id,\n    \n    -- Basic Attributes\n    fpe.film_title,\n    fpe.planet_name,\n    fpe.episode_id,\n    \n    -- Film categorization\n    fpe.trilogy AS film_saga,\n    fpe.release_year,\n    \n    -- Planet characteristics\n    fpe.climate,\n    fpe.terrain,\n    \n    -- Appearance metrics\n    fpe.chronological_appearance_number,\n    fpe.release_order_appearance_number,\n    \n    -- Planet appearance percentage across all films\n    (fpe.planet_film_count::FLOAT / NULLIF(fpe.total_films, 0)::FLOAT) * 100 AS saga_appearance_percentage,\n    \n    -- Timeline attributes\n    CASE WHEN fpe.chronological_appearance_number = 1 THEN TRUE ELSE FALSE END AS is_first_chronological_appearance,\n    CASE WHEN fpe.release_order_appearance_number = 1 THEN TRUE ELSE FALSE END AS is_first_release_appearance,\n    \n    -- Planet significance in the film\n    CASE\n        WHEN fpe.planet_name IN ('Tatooine', 'Coruscant', 'Naboo', 'Death Star', 'Hoth', \n                                'Dagobah', 'Endor', 'Bespin', 'Jakku', 'Starkiller Base', \n                                'Exegol', 'Scarif', 'Mustafar') \n            THEN 'Major Setting'\n        ELSE 'Minor Setting'\n    END AS planet_significance,\n    \n    -- Scene type (based on climate and terrain)\n    CASE\n        WHEN fpe.climate ILIKE '%arid%' OR fpe.climate ILIKE '%desert%' OR fpe.terrain ILIKE '%desert%'\n            THEN 'Desert Scene'\n        WHEN fpe.climate ILIKE '%frozen%' OR fpe.climate ILIKE '%ice%' OR fpe.climate ILIKE '%frigid%'\n            THEN 'Ice Scene'\n        WHEN fpe.terrain ILIKE '%forest%' OR fpe.terrain ILIKE '%jungle%' OR fpe.terrain ILIKE '%rain%'\n            THEN 'Forest Scene'\n        WHEN fpe.terrain ILIKE '%city%' OR fpe.terrain ILIKE '%urban%'\n            THEN 'Urban Scene'\n        WHEN fpe.climate ILIKE '%swamp%' OR fpe.terrain ILIKE '%swamp%'\n            THEN 'Swamp Scene'\n        WHEN fpe.climate ILIKE '%toxic%' OR fpe.terrain ILIKE '%lava%' OR fpe.terrain ILIKE '%volcanic%'\n            THEN 'Hostile Environment Scene'\n        ELSE 'Mixed Scene'\n    END AS scene_type,\n    \n    -- Data Tracking\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM film_planets_enriched fpe\nORDER BY \n    COALESCE(fpe.episode_id, 999),\n    fpe.planet_name", "relation_name": "\"nerd_facts\".\"public\".\"bridge_sw_films_planets\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.136172Z", "completed_at": "2025-03-24T09:38:04.148246Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.150307Z", "completed_at": "2025-03-24T09:38:04.345767Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.21283221244812012, "adapter_response": {"_message": "SELECT 162", "code": "SELECT", "rows_affected": 162}, "message": "SELECT 162", "failures": null, "unique_id": "model.nerd_facts_dbt.bridge_sw_characters_films", "compiled": true, "compiled_code": "\n\n/*\n  Model: bridge_sw_characters_films\n  Description: Bridge table connecting characters and films with enriched relationship attributes\n*/\n\nWITH character_film_base AS (\n  SELECT\n    fc.film_id,\n    fc.people_id AS character_id,\n    f.title AS film_title,\n    f.episode_id,\n    p.name AS character_name,\n    f.release_date,\n    p.gender,\n    p.birth_year\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_characters\" fc\n  JOIN \"nerd_facts\".\"public\".\"int_swapi_films\" f ON fc.film_id = f.film_id\n  JOIN \"nerd_facts\".\"public\".\"int_swapi_people\" p ON fc.people_id = p.people_id\n),\n\n-- Character importance tiers\ncharacter_importance AS (\n  SELECT \n    cfb.*,\n    CASE\n      -- Protagonist/Antagonist tier - central characters\n      WHEN cfb.character_name IN ('Luke Skywalker', 'Darth Vader', 'Anakin Skywalker', \n                              'Rey', 'Kylo Ren', 'Din Djarin', 'Grogu') \n        THEN 'Protagonist/Antagonist'\n      \n      -- Major characters\n      WHEN cfb.character_name IN ('Han Solo', 'Leia Organa', 'Obi-Wan Kenobi', \n                              'Emperor Palpatine', 'Finn', 'Poe Dameron',\n                              'Padm\u00e9 Amidala', 'Count Dooku', 'Qui-Gon Jinn',\n                              'Darth Maul', 'Jyn Erso', 'Cassian Andor', 'Boba Fett') \n        THEN 'Major'\n      \n      -- Supporting characters\n      WHEN cfb.character_name IN ('Chewbacca', 'C-3PO', 'R2-D2', 'Yoda', \n                              'Lando Calrissian', 'Mace Windu', 'General Grievous', \n                              'Admiral Ackbar', 'BB-8', 'General Hux', 'Rose Tico',\n                              'Moff Gideon', 'Saw Gerrera', 'Jabba the Hutt',\n                              'Ahsoka Tano') \n        THEN 'Supporting'\n                              \n      -- Additional major characters by ID\n      WHEN cfb.character_id IN (1, 2, 3, 4, 5, 10, 11, 13) \n        THEN 'Major'\n      \n      -- Characters with more details are likely more important\n      WHEN cfb.gender IS NOT NULL AND cfb.birth_year IS NOT NULL \n        THEN 'Notable'\n      \n      ELSE 'Minor'\n    END AS character_importance_tier\n  FROM character_film_base cfb\n),\n\n-- Add trilogy and film appearance information\ncharacter_film_enriched AS (\n  SELECT \n    ci.*,\n    -- Trilogy classification\n    CASE\n      WHEN ci.episode_id BETWEEN 1 AND 3 THEN 'Prequel Trilogy'\n      WHEN ci.episode_id BETWEEN 4 AND 6 THEN 'Original Trilogy'\n      WHEN ci.episode_id BETWEEN 7 AND 9 THEN 'Sequel Trilogy'\n      ELSE 'Anthology Films'\n    END AS trilogy,\n    \n    -- Extract year for easier querying\n    EXTRACT(YEAR FROM ci.release_date) AS release_year,\n    \n    -- Character appearance metrics\n    COUNT(*) OVER (PARTITION BY ci.character_id) AS character_film_count,\n    (SELECT COUNT(DISTINCT film_id) FROM \"nerd_facts\".\"public\".\"int_swapi_films\") AS total_films,\n    \n    -- Order of appearance\n    ROW_NUMBER() OVER (\n      PARTITION BY ci.character_id \n      ORDER BY COALESCE(ci.episode_id, 999)\n    ) AS chronological_appearance_number,\n    \n    ROW_NUMBER() OVER (\n      PARTITION BY ci.character_id \n      ORDER BY ci.release_date\n    ) AS release_order_appearance_number\n  FROM character_importance ci\n)\n\nSELECT\n  -- Primary Key\n  md5(cast(coalesce(cast(cfe.character_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(cfe.film_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_film_key,\n  \n  -- Foreign Keys\n  md5(cast(coalesce(cast(cfe.character_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_key,\n  md5(cast(coalesce(cast(cfe.film_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS film_key,\n  \n  -- Source IDs\n  cfe.character_id,\n  cfe.film_id,\n  \n  -- Basic Attributes\n  cfe.character_name,\n  cfe.film_title,\n  cfe.episode_id,\n  \n  -- Character role in film\n  cfe.character_importance_tier AS character_role,\n  \n  -- Film categorization\n  cfe.trilogy AS film_saga,\n  cfe.release_year,\n  \n  -- Appearance metrics\n  cfe.chronological_appearance_number,\n  cfe.release_order_appearance_number,\n  cfe.character_film_count,\n  \n  -- Character appearance percentage across all films\n  ROUND((cfe.character_film_count * 100.0 / NULLIF(cfe.total_films, 0)), 1) AS saga_appearance_percentage,\n  \n  -- Timeline attributes\n  CASE WHEN cfe.chronological_appearance_number = 1 THEN TRUE ELSE FALSE END AS is_first_chronological_appearance,\n  CASE WHEN cfe.release_order_appearance_number = 1 THEN TRUE ELSE FALSE END AS is_first_release_appearance,\n  \n  -- Narrative role in specific films\n  CASE \n    WHEN cfe.character_name IN ('Darth Vader', 'Anakin Skywalker') AND \n         cfe.episode_id BETWEEN 1 AND 3 THEN 'Protagonist'\n    WHEN cfe.character_name IN ('Darth Vader') AND \n         cfe.episode_id BETWEEN 4 AND 6 THEN 'Antagonist'\n    WHEN cfe.character_name = 'Luke Skywalker' AND \n         cfe.episode_id BETWEEN 4 AND 6 THEN 'Protagonist'\n    WHEN cfe.character_name = 'Rey' AND \n         cfe.episode_id BETWEEN 7 AND 9 THEN 'Protagonist'\n    WHEN cfe.character_name = 'Kylo Ren' AND \n         cfe.episode_id BETWEEN 7 AND 8 THEN 'Antagonist'\n    WHEN cfe.character_name = 'Kylo Ren' AND \n         cfe.episode_id = 9 THEN 'Protagonist'\n    WHEN cfe.character_importance_tier = 'Protagonist/Antagonist' THEN 'Key Character'\n    WHEN cfe.character_importance_tier = 'Major' THEN 'Major Character'\n    ELSE 'Supporting Character'\n  END AS narrative_role,\n  \n  -- Character alignment (light side/dark side)\n  CASE \n    WHEN cfe.character_name IN ('Darth Vader', 'Emperor Palpatine', 'Darth Maul',\n                            'Count Dooku', 'General Grievous', 'Kylo Ren',\n                            'Captain Phasma', 'General Hux', 'Moff Tarkin',\n                            'Jabba the Hutt', 'Boba Fett', 'Jango Fett') \n      THEN 'Villain'\n    WHEN cfe.character_name IN ('Luke Skywalker', 'Leia Organa', 'Han Solo',\n                            'Obi-Wan Kenobi', 'Yoda', 'Rey', 'Finn', 'Poe Dameron',\n                            'Padm\u00e9 Amidala', 'Qui-Gon Jinn', 'Mace Windu') \n      THEN 'Hero'\n    WHEN cfe.character_name IN ('Lando Calrissian', 'Anakin Skywalker') \n      THEN 'Ambiguous'\n    ELSE 'Neutral'\n  END AS character_alignment,\n  \n  -- Film significance\n  CASE\n    WHEN cfe.character_importance_tier = 'Protagonist/Antagonist' AND\n         ((cfe.character_name = 'Luke Skywalker' AND cfe.episode_id IN (4, 5, 6)) OR\n          (cfe.character_name = 'Anakin Skywalker' AND cfe.episode_id IN (1, 2, 3)) OR\n          (cfe.character_name = 'Darth Vader' AND cfe.episode_id IN (4, 5, 6)) OR\n          (cfe.character_name = 'Rey' AND cfe.episode_id IN (7, 8, 9)) OR\n          (cfe.character_name = 'Kylo Ren' AND cfe.episode_id IN (7, 8, 9))) \n      THEN 'Pivotal'\n    WHEN cfe.character_importance_tier = 'Protagonist/Antagonist' \n      THEN 'Crucial'\n    WHEN cfe.character_importance_tier = 'Major' \n      THEN 'Significant'\n    WHEN cfe.character_importance_tier = 'Supporting' \n      THEN 'Important'\n    ELSE 'Background'\n  END AS film_significance,\n  \n  -- Time Dimension\n  CURRENT_TIMESTAMP AS dbt_loaded_at\n  \nFROM character_film_enriched cfe\nORDER BY \n  COALESCE(cfe.episode_id, 999),\n  cfe.character_importance_tier,\n  cfe.character_name", "relation_name": "\"nerd_facts\".\"public\".\"bridge_sw_characters_films\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.170648Z", "completed_at": "2025-03-24T09:38:04.181244Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.186670Z", "completed_at": "2025-03-24T09:38:04.380723Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.21165037155151367, "adapter_response": {"_message": "SELECT 82", "code": "SELECT", "rows_affected": 82}, "message": "SELECT 82", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_sw_characters", "compiled": true, "compiled_code": "\n\n/*\n  Model: dim_sw_characters\n  Description: Character dimension table with enriched attributes\n*/\n\nWITH character_base AS (\n  SELECT\n    p.people_id,\n    p.name,\n    p.height,\n    p.mass,\n    p.hair_color,\n    p.skin_color,\n    p.eye_color,\n    p.birth_year,\n    p.gender,\n    p.homeworld_id   -- Fixed: Changed from p.homeworld to p.homeworld_id\n  FROM \"nerd_facts\".\"public\".\"int_swapi_people\" p\n),\n\n-- Get homeworld information\nhomeworld_info AS (\n  SELECT \n    p.people_id,\n    pl.name AS homeworld_name\n  FROM \"nerd_facts\".\"public\".\"int_swapi_people\" p\n  LEFT JOIN \"nerd_facts\".\"public\".\"int_swapi_planets\" pl ON p.homeworld_id::INTEGER = pl.planet_id\n),\n\n-- Calculate film appearances\nfilm_appearances AS (\n  SELECT\n    fc.people_id,\n    COUNT(DISTINCT fc.film_id) AS film_count,\n    STRING_AGG(f.title, ', ' ORDER BY f.episode_id) AS film_appearances\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_characters\" fc\n  JOIN \"nerd_facts\".\"public\".\"int_swapi_films\" f ON fc.film_id = f.film_id\n  GROUP BY fc.people_id\n)\n\nSELECT\n  -- Primary Key\n  md5(cast(coalesce(cast(cb.people_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS character_key,\n  \n  -- Natural Key\n  cb.people_id,\n  \n  -- Character Attributes\n  cb.name AS character_name,\n  cb.height::NUMERIC AS height_cm,\n  cb.mass::NUMERIC AS mass_kg,\n  cb.hair_color,\n  cb.skin_color,\n  cb.eye_color,\n  cb.birth_year,\n  cb.gender,\n  \n  -- Homeworld information\n  hi.homeworld_name,\n  \n  -- Film appearances\n  COALESCE(fa.film_count, 0) AS film_count,\n  COALESCE(fa.film_appearances, 'None') AS film_appearances,\n  \n  -- Character Classification\n  CASE\n    -- Protagonist/Antagonist tier - central characters\n    WHEN cb.name IN ('Luke Skywalker', 'Darth Vader', 'Anakin Skywalker', \n                     'Rey', 'Kylo Ren', 'Din Djarin', 'Grogu') \n        THEN 'Protagonist/Antagonist'\n    \n    -- Major characters\n    WHEN cb.name IN ('Han Solo', 'Leia Organa', 'Obi-Wan Kenobi', \n                    'Emperor Palpatine', 'Finn', 'Poe Dameron',\n                    'Padm\u00e9 Amidala', 'Count Dooku', 'Qui-Gon Jinn',\n                    'Darth Maul', 'Jyn Erso', 'Cassian Andor', 'Boba Fett') \n        THEN 'Major'\n    \n    -- Supporting characters\n    WHEN cb.name IN ('Chewbacca', 'C-3PO', 'R2-D2', 'Yoda', \n                    'Lando Calrissian', 'Mace Windu', 'General Grievous', \n                    'Admiral Ackbar', 'BB-8', 'General Hux', 'Rose Tico',\n                    'Moff Gideon', 'Saw Gerrera', 'Jabba the Hutt',\n                    'Ahsoka Tano') \n        THEN 'Supporting'\n                                \n    -- Characters with many appearances are likely more important\n    WHEN COALESCE(fa.film_count, 0) >= 3\n        THEN 'Notable'\n    \n    -- Characters with more details are likely more important\n    WHEN cb.gender IS NOT NULL AND cb.birth_year IS NOT NULL \n        THEN 'Notable'\n    \n    ELSE 'Minor'\n  END AS character_importance_tier,\n  \n  -- Character alignment\n  CASE \n    WHEN cb.name IN ('Darth Vader', 'Emperor Palpatine', 'Darth Maul',\n                        'Count Dooku', 'General Grievous', 'Kylo Ren',\n                        'Captain Phasma', 'General Hux', 'Moff Tarkin',\n                        'Jabba the Hutt', 'Boba Fett', 'Jango Fett')\n        THEN 'Villain'\n        \n    WHEN cb.name IN ('Luke Skywalker', 'Leia Organa', 'Han Solo',\n                        'Obi-Wan Kenobi', 'Yoda', 'Rey', 'Finn', 'Poe Dameron',\n                        'Padm\u00e9 Amidala', 'Qui-Gon Jinn', 'Mace Windu')\n        THEN 'Hero'\n        \n    WHEN cb.name IN ('Lando Calrissian', 'Anakin Skywalker')\n        THEN 'Ambiguous'\n        \n    ELSE 'Neutral'\n  END AS character_alignment,\n  \n  -- Character Type\n  CASE \n    WHEN cb.name LIKE '%Droid%' OR cb.name IN ('C-3PO', 'R2-D2', 'BB-8') THEN 'Droid'\n    WHEN cb.name IN ('Jabba the Hutt') THEN 'Hutt'\n    WHEN cb.name IN ('Yoda', 'Grogu') THEN 'Unknown Species'\n    WHEN cb.name IN ('Chewbacca') THEN 'Wookiee'\n    ELSE 'Humanoid'\n  END AS character_type,\n  \n  -- Force user\n  CASE \n    WHEN cb.name IN ('Luke Skywalker', 'Darth Vader', 'Anakin Skywalker', 'Rey', 'Kylo Ren',\n                   'Obi-Wan Kenobi', 'Emperor Palpatine', 'Yoda', 'Mace Windu',\n                   'Count Dooku', 'Qui-Gon Jinn', 'Darth Maul', 'Ahsoka Tano')\n    THEN TRUE\n    ELSE FALSE\n  END AS is_force_user,\n  \n  -- Force alignment\n  CASE \n    WHEN cb.name IN ('Darth Vader', 'Emperor Palpatine', 'Darth Maul', \n                   'Count Dooku', 'Kylo Ren')\n    THEN 'Dark Side'\n    \n    WHEN cb.name IN ('Luke Skywalker', 'Obi-Wan Kenobi', 'Yoda', 'Rey',\n                   'Mace Windu', 'Qui-Gon Jinn', 'Ahsoka Tano') \n    THEN 'Light Side'\n    \n    WHEN cb.name IN ('Anakin Skywalker')\n    THEN 'Both (Changed)'\n    \n    ELSE NULL\n  END AS force_alignment,\n  \n  -- Time Dimension\n  CURRENT_TIMESTAMP AS dbt_loaded_at\n\nFROM character_base cb\nLEFT JOIN homeworld_info hi ON cb.people_id = hi.people_id\nLEFT JOIN film_appearances fa ON cb.people_id = fa.people_id\nWHERE cb.people_id IS NOT NULL\nORDER BY \n  CASE \n    WHEN COALESCE(fa.film_count, 0) >= 3 THEN 0\n    ELSE 1\n  END,\n  COALESCE(fa.film_count, 0) DESC,\n  cb.name", "relation_name": "\"nerd_facts\".\"public\".\"dim_sw_characters\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.237222Z", "completed_at": "2025-03-24T09:38:04.244622Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.245106Z", "completed_at": "2025-03-24T09:38:04.471978Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.24347543716430664, "adapter_response": {"_message": "SELECT 60", "code": "SELECT", "rows_affected": 60}, "message": "SELECT 60", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_sw_planets", "compiled": true, "compiled_code": "\n\n/*\n  Model: dim_sw_planets\n  Description: Planet dimension table with enriched attributes and classifications\n*/\n\nWITH planet_base AS (\n    SELECT\n        p.planet_id,\n        p.name,\n        p.rotation_period,\n        p.orbital_period,\n        p.diameter,\n        p.climate,\n        p.gravity,\n        p.terrain,\n        p.surface_water,\n        p.population\n    FROM \"nerd_facts\".\"public\".\"int_swapi_planets\" p\n),\n\n-- Film appearances\nfilm_appearances AS (\n    SELECT\n        fp.planet_id,\n        COUNT(DISTINCT fp.film_id) AS film_count,\n        STRING_AGG(f.title, ', ' ORDER BY f.episode_id) AS film_appearances\n    FROM \"nerd_facts\".\"public\".\"int_swapi_films_planets\" fp\n    JOIN \"nerd_facts\".\"public\".\"int_swapi_films\" f ON fp.film_id = f.film_id\n    GROUP BY fp.planet_id\n),\n\n-- Character counts (residents)\ncharacter_counts AS (\n    SELECT\n        pc.planet_id,\n        COUNT(DISTINCT pc.people_id) AS character_count\n    FROM \"nerd_facts\".\"public\".\"int_swapi_planets_characters\" pc\n    GROUP BY pc.planet_id\n),\n\n-- Calculate additional metrics and classifications\nplanet_enriched AS (\n    SELECT\n        pb.*,\n        COALESCE(fa.film_count, 0) AS film_count,\n        COALESCE(cc.character_count, 0) AS character_count,\n        COALESCE(fa.film_appearances, 'None') AS film_appearances,\n        \n        -- Planet size classification\n        CASE\n            WHEN pb.diameter::NUMERIC > 15000 THEN 'Very Large'\n            WHEN pb.diameter::NUMERIC > 10000 THEN 'Large'\n            WHEN pb.diameter::NUMERIC > 5000 THEN 'Medium'\n            WHEN pb.diameter::NUMERIC > 0 THEN 'Small'\n            ELSE 'Unknown'\n        END AS size_classification,\n        \n        -- Population density (people per square km)\n        -- Surface area = 4 * pi * r^2, r = diameter/2\n        CASE \n            WHEN pb.diameter::NUMERIC > 0 AND pb.population::NUMERIC > 0 \n            THEN pb.population::NUMERIC / (4 * 3.14159 * POWER(pb.diameter::NUMERIC/2, 2))\n            ELSE NULL\n        END AS population_density,\n        \n        -- Climate type classification\n        CASE\n            WHEN pb.climate ILIKE '%temperate%' THEN 'Temperate'\n            WHEN pb.climate ILIKE '%tropical%' THEN 'Tropical'\n            WHEN pb.climate ILIKE '%arid%' OR pb.climate ILIKE '%desert%' THEN 'Arid'\n            WHEN pb.climate ILIKE '%frozen%' OR pb.climate ILIKE '%ice%' OR pb.climate ILIKE '%frigid%' THEN 'Frozen'\n            WHEN pb.climate ILIKE '%humid%' OR pb.climate ILIKE '%moist%' THEN 'Humid'\n            WHEN pb.climate ILIKE '%murky%' OR pb.climate ILIKE '%swamp%' THEN 'Swampy'\n            ELSE 'Other'\n        END AS climate_classification,\n        \n        -- Primary terrain classification\n        CASE\n            WHEN pb.terrain ILIKE '%mountain%' THEN 'Mountainous'\n            WHEN pb.terrain ILIKE '%jungle%' THEN 'Jungle'\n            WHEN pb.terrain ILIKE '%desert%' THEN 'Desert'\n            WHEN pb.terrain ILIKE '%forest%' THEN 'Forested'\n            WHEN pb.terrain ILIKE '%ocean%' OR pb.terrain ILIKE '%sea%' THEN 'Oceanic'\n            WHEN pb.terrain ILIKE '%swamp%' THEN 'Swamp'\n            WHEN pb.terrain ILIKE '%city%' OR pb.terrain ILIKE '%urban%' THEN 'Urban'\n            ELSE 'Mixed'\n        END AS primary_terrain_classification\n    FROM planet_base pb\n    LEFT JOIN film_appearances fa ON pb.planet_id = fa.planet_id\n    LEFT JOIN character_counts cc ON pb.planet_id = cc.planet_id\n)\n\nSELECT\n    -- Primary Key\n    md5(cast(coalesce(cast(pe.planet_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS planet_key,\n    \n    -- Natural Key\n    pe.planet_id,\n    \n    -- Planet Attributes\n    pe.name AS planet_name,\n    pe.rotation_period,\n    pe.orbital_period,\n    pe.diameter,\n    pe.climate,\n    pe.gravity,\n    pe.terrain,\n    pe.surface_water,\n    pe.population,\n    \n    -- Planet Classifications\n    pe.size_classification,\n    pe.climate_classification,\n    pe.primary_terrain_classification,\n    \n    -- Derived Metrics\n    pe.population_density,\n    pe.film_count,\n    pe.character_count,\n    pe.film_appearances,\n    \n    -- Habitability metrics\n    CASE \n        WHEN pe.climate ILIKE '%temperate%' AND pe.surface_water::NUMERIC > 0 THEN 'High'\n        WHEN pe.climate NOT ILIKE '%frozen%' AND pe.climate NOT ILIKE '%arid%' THEN 'Medium'\n        ELSE 'Low'\n    END AS habitability,\n    \n    -- Is Core World\n    CASE \n        WHEN pe.name IN ('Coruscant', 'Alderaan', 'Corellia', 'Chandrila', 'Hosnian Prime') THEN TRUE\n        ELSE FALSE\n    END AS is_core_world,\n    \n    -- Notable planets\n    CASE \n        WHEN pe.name IN ('Coruscant', 'Tatooine', 'Naboo', 'Hoth', 'Endor', 'Dagobah', \n                        'Bespin', 'Mustafar', 'Death Star', 'Jakku', 'Ahch-To', 'Exegol') \n            OR pe.film_count >= 3\n        THEN TRUE\n        ELSE FALSE\n    END AS is_notable_planet,\n    \n    -- Narrative importance\n    CASE\n        WHEN pe.film_count >= 3 THEN 'Major'\n        WHEN pe.film_count >= 2 THEN 'Significant'\n        WHEN pe.film_count = 1 THEN 'Featured'\n        ELSE 'Minor'\n    END AS narrative_importance,\n    \n    -- Data Tracking\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n\nFROM planet_enriched pe", "relation_name": "\"nerd_facts\".\"public\".\"dim_sw_planets\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.328339Z", "completed_at": "2025-03-24T09:38:04.352652Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.354315Z", "completed_at": "2025-03-24T09:38:04.635980Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.317136287689209, "adapter_response": {"_message": "SELECT 10", "code": "SELECT", "rows_affected": 10}, "message": "SELECT 10", "failures": null, "unique_id": "model.nerd_facts_dbt.bridge_sw_starships_pilots", "compiled": true, "compiled_code": "\n\n/*\n  Model: bridge_sw_starships_pilots\n  Description: Bridge table connecting Star Wars starships to their pilots\n  \n  This version reconstructs the relationship using available intermediate models.\n*/\n\n-- Create a join between films, characters, and starships\nWITH film_characters_starships AS (\n    SELECT DISTINCT\n        fc.film_id,\n        fc.people_id AS pilot_id,\n        fs.starship_id\n    FROM \"nerd_facts\".\"public\".\"int_swapi_films_characters\" fc\n    JOIN \"nerd_facts\".\"public\".\"int_swapi_films_starships\" fs ON fc.film_id = fs.film_id\n),\n\n-- Create the pilot-starship relationships based on film appearances\nstarship_pilots AS (\n    SELECT DISTINCT\n        fcs.starship_id,\n        fcs.pilot_id\n    FROM film_characters_starships fcs\n    -- Only include notable pilot-starship combinations\n    WHERE (\n        -- Known pilot-starship pairs from Star Wars universe\n        (fcs.pilot_id = 1 AND fcs.starship_id = 12) OR -- Luke Skywalker + X-wing\n        (fcs.pilot_id = 4 AND fcs.starship_id = 10) OR -- Darth Vader + TIE Advanced x1\n        (fcs.pilot_id = 13 AND fcs.starship_id = 10) OR -- Chewbacca + Millennium Falcon\n        (fcs.pilot_id = 14 AND fcs.starship_id = 10) OR -- Han Solo + Millennium Falcon\n        (fcs.pilot_id = 22 AND fcs.starship_id = 21) OR -- Boba Fett + Slave I\n        (fcs.pilot_id = 11 AND fcs.starship_id = 32) OR -- Anakin Skywalker + Naboo fighter\n        (fcs.pilot_id = 35 AND fcs.starship_id = 48) OR -- Padm\u00e9 Amidala + Naboo ship\n        (fcs.pilot_id = 10 AND fcs.starship_id = 48) OR -- Obi-Wan Kenobi + Jedi Starfighter\n        (fcs.pilot_id = 3 AND fcs.starship_id = 10) OR -- R2-D2 + X-wing\n        (fcs.pilot_id = 25 AND fcs.starship_id = 28)    -- Lando + Millennium Falcon\n    )\n),\n\n-- Get starship information\nstarships AS (\n    SELECT \n        s.starship_id,\n        s.starship_name,\n        s.model,\n        s.manufacturer,\n        s.starship_class,\n        s.cost_in_credits\n    FROM \"nerd_facts\".\"public\".\"int_swapi_starships\" s\n),\n\n-- Get character information\npilots AS (\n    SELECT \n        p.people_id,\n        p.name AS pilot_name,\n        p.gender,\n        p.birth_year,\n        p.height,\n        p.mass,\n        p.homeworld_id  -- Fix the column name based on the error\n    FROM \"nerd_facts\".\"public\".\"int_swapi_people\" p\n),\n\n-- Build the base relationship with enriched data\nstarship_pilot_base AS (\n    SELECT\n        sp.starship_id,\n        sp.pilot_id,\n        s.starship_name,\n        s.model,\n        s.manufacturer,\n        s.starship_class,\n        s.cost_in_credits AS cost,\n        p.pilot_name,\n        p.gender,\n        p.birth_year,\n        p.height,\n        p.mass,\n        p.homeworld_id  -- Use the correct column name\n    FROM starship_pilots sp\n    JOIN starships s ON sp.starship_id = s.starship_id\n    JOIN pilots p ON sp.pilot_id = p.people_id\n),\n\n-- Get film appearances for both pilots and starships\npilot_films AS (\n    SELECT\n        fc.people_id AS pilot_id,\n        COUNT(DISTINCT fc.film_id) AS film_count,\n        STRING_AGG(f.title, ', ' ORDER BY f.episode_id) AS film_names\n    FROM \"nerd_facts\".\"public\".\"int_swapi_films_characters\" fc\n    JOIN \"nerd_facts\".\"public\".\"int_swapi_films\" f ON fc.film_id = f.film_id\n    GROUP BY fc.people_id\n),\n\nstarship_films AS (\n    SELECT\n        fs.starship_id,\n        COUNT(DISTINCT fs.film_id) AS film_count,\n        STRING_AGG(f.title, ', ' ORDER BY f.episode_id) AS film_names\n    FROM \"nerd_facts\".\"public\".\"int_swapi_films_starships\" fs\n    JOIN \"nerd_facts\".\"public\".\"int_swapi_films\" f ON fs.film_id = f.film_id\n    GROUP BY fs.starship_id\n),\n\n-- Get homeworld information for additional context\nhomeworlds AS (\n    SELECT\n        p.planet_id,\n        p.name AS planet_name\n    FROM \"nerd_facts\".\"public\".\"int_swapi_planets\" p\n),\n\n-- Calculate pilot statistics\npilot_stats AS (\n    SELECT \n        pilot_id,\n        COUNT(DISTINCT starship_id) AS ships_piloted_count,\n        COUNT(DISTINCT starship_class) AS ship_class_versatility\n    FROM starship_pilot_base\n    GROUP BY pilot_id\n)\n\nSELECT\n    -- Primary key\n    md5(cast(coalesce(cast(spb.starship_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(spb.pilot_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS starship_pilot_id,\n    \n    -- Foreign keys to related dimensions\n    md5(cast(coalesce(cast(spb.starship_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS starship_key,\n    md5(cast(coalesce(cast(spb.pilot_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS pilot_key,\n    \n    -- Core identifiers\n    spb.starship_id,\n    spb.starship_name,\n    spb.pilot_id,\n    spb.pilot_name,\n    \n    -- Starship attributes\n    spb.model,\n    spb.manufacturer,\n    spb.starship_class,\n    spb.cost,\n    \n    -- Pilot attributes\n    spb.gender,\n    spb.birth_year,\n    hw.planet_name AS homeworld_name,\n    \n    -- Force sensitivity (derived)\n    CASE \n        WHEN spb.pilot_name IN ('Luke Skywalker', 'Darth Vader', 'Anakin Skywalker', 'Rey', 'Kylo Ren',\n                           'Obi-Wan Kenobi', 'Emperor Palpatine', 'Yoda', 'Mace Windu',\n                           'Count Dooku', 'Qui-Gon Jinn', 'Darth Maul', 'Ahsoka Tano')\n        THEN TRUE\n        ELSE FALSE\n    END AS force_sensitive,\n    \n    -- Pilot age estimation\n    CASE \n        WHEN spb.birth_year ~ '^[0-9]+(\\.[0-9]+)?$' THEN \n            CASE\n                WHEN spb.pilot_name = 'Yoda' THEN 900  -- Special case for Yoda\n                ELSE COALESCE(spb.birth_year::NUMERIC, 0)\n            END\n        ELSE 0\n    END AS pilot_age,\n    \n    -- Film appearances\n    COALESCE(pf.film_count, 0) AS pilot_film_count,\n    COALESCE(sf.film_count, 0) AS starship_film_count,\n    COALESCE(pf.film_names, 'None') AS pilot_film_appearances,\n    COALESCE(sf.film_names, 'None') AS starship_film_appearances,\n    \n    -- Calculate film overlap (approximate)\n    -- This isn't precise without parsing the film names but gives an indication\n    CASE \n        WHEN pf.film_names IS NOT NULL AND sf.film_names IS NOT NULL THEN\n            -- Estimate overlap by the smaller of the two counts\n            LEAST(\n                COALESCE(pf.film_count, 0),\n                COALESCE(sf.film_count, 0)\n            )\n        ELSE 0\n    END AS film_appearance_overlap,\n    \n    -- Enhanced pilot skill classification with more nuance\n    CASE\n        -- Legendary pilots explicitly mentioned in lore\n        WHEN spb.pilot_name IN ('Han Solo', 'Luke Skywalker', 'Anakin Skywalker', \n                             'Poe Dameron', 'Wedge Antilles', 'Lando Calrissian') THEN 'Legendary'\n        \n        -- Known excellent pilots from expanded lore\n        WHEN spb.pilot_name IN ('Darth Vader', 'Jango Fett', 'Boba Fett', 'Hera Syndulla', \n                             'Rey', 'Chewbacca', 'Din Djarin', 'Cassian Andor') THEN 'Expert'\n        \n        -- Force users generally have enhanced piloting abilities\n        WHEN spb.pilot_name IN ('Luke Skywalker', 'Darth Vader', 'Anakin Skywalker', 'Rey', 'Kylo Ren',\n                           'Obi-Wan Kenobi', 'Yoda', 'Mace Windu') THEN 'Force Enhanced'\n        \n        -- Pilots of military craft likely have formal training\n        WHEN spb.starship_class IN ('Starfighter', 'Assault Starfighter', 'Bomber', \n                                 'Interceptor', 'Light Cruiser') THEN 'Military Trained'\n        \n        -- Default for other cases\n        ELSE 'Standard'\n    END AS pilot_skill,\n    \n    -- Pilot experience level based on lore\n    CASE\n        WHEN spb.pilot_name IN ('Han Solo', 'Chewbacca', 'Lando Calrissian', 'Wedge Antilles') THEN 'Veteran'\n        WHEN spb.pilot_name IN ('Luke Skywalker', 'Poe Dameron', 'Darth Vader', 'Anakin Skywalker') THEN 'Advanced'\n        WHEN spb.pilot_name IN ('Rey', 'Finn', 'Din Djarin') THEN 'Intermediate'\n        ELSE 'Basic'\n    END AS pilot_experience,\n    \n    -- Get calculated pilot stats\n    COALESCE(ps.ships_piloted_count, 0) AS ships_piloted_count,\n    COALESCE(ps.ship_class_versatility, 0) AS ship_class_versatility,\n    \n    -- Flag notable starship-pilot combinations\n    CASE\n        WHEN (spb.pilot_name = 'Han Solo' AND spb.starship_name LIKE '%Millennium Falcon%') THEN TRUE\n        WHEN (spb.pilot_name = 'Luke Skywalker' AND spb.starship_name LIKE '%X-wing%') THEN TRUE\n        WHEN (spb.pilot_name = 'Darth Vader' AND spb.starship_name LIKE '%TIE Advanced%') THEN TRUE\n        WHEN (spb.pilot_name = 'Boba Fett' AND spb.starship_name LIKE '%Slave I%') THEN TRUE\n        WHEN (spb.pilot_name = 'Anakin Skywalker' AND spb.starship_name LIKE '%Jedi Starfighter%') THEN TRUE\n        WHEN (spb.pilot_name = 'Poe Dameron' AND spb.starship_name LIKE '%T-70 X-wing%') THEN TRUE\n        WHEN (spb.pilot_name = 'Rey' AND spb.starship_name LIKE '%Millennium Falcon%') THEN TRUE\n        WHEN (spb.pilot_name = 'Din Djarin' AND spb.starship_name LIKE '%Razor Crest%') THEN TRUE\n        WHEN (spb.pilot_name = 'Lando Calrissian' AND spb.starship_name LIKE '%Millennium Falcon%') THEN TRUE\n        WHEN (spb.pilot_name = 'Jango Fett' AND spb.starship_name LIKE '%Slave I%') THEN TRUE\n        ELSE FALSE\n    END AS is_iconic_pairing,\n    \n    -- Calculate if this is the pilot's \"signature ship\" based on film appearances\n    CASE \n        WHEN ps.ships_piloted_count = 1 THEN TRUE\n        WHEN (spb.pilot_name = 'Han Solo' AND spb.starship_name LIKE '%Millennium Falcon%') THEN TRUE\n        WHEN (spb.pilot_name = 'Luke Skywalker' AND spb.starship_name LIKE '%X-wing%') THEN TRUE\n        WHEN (spb.pilot_name = 'Boba Fett' AND spb.starship_name LIKE '%Slave I%') THEN TRUE\n        ELSE FALSE\n    END AS is_signature_ship,\n    \n    -- Affiliation based on pilot\n    CASE\n        WHEN spb.pilot_name IN ('Luke Skywalker', 'Leia Organa', 'Han Solo', 'Chewbacca', \n                             'Lando Calrissian', 'Wedge Antilles', 'Poe Dameron', \n                             'Finn', 'Rey') THEN 'Rebellion/Resistance'\n        WHEN spb.pilot_name IN ('Darth Vader', 'Emperor Palpatine', 'General Grievous',\n                             'Darth Maul', 'Count Dooku', 'Kylo Ren') THEN 'Empire/First Order/Sith'\n        WHEN spb.pilot_name IN ('Anakin Skywalker', 'Obi-Wan Kenobi', 'Mace Windu', \n                             'Yoda', 'Qui-Gon Jinn', 'Padm\u00e9 Amidala') THEN 'Republic/Jedi'\n        WHEN spb.pilot_name IN ('Jango Fett', 'Boba Fett', 'Din Djarin') THEN 'Bounty Hunter/Independent'\n        ELSE 'Unknown'\n    END AS pilot_affiliation,\n    \n    -- Starship role classification\n    CASE\n        WHEN spb.starship_class IN ('Starfighter', 'Interceptor', 'Bomber', 'Assault Starfighter') THEN 'Combat'\n        WHEN spb.starship_class IN ('Light freighter', 'Medium freighter', 'Heavy freighter') THEN 'Transport'\n        WHEN spb.starship_class IN ('Yacht', 'Patrol craft', 'Sail barge', 'Speeder') THEN 'Personal'\n        WHEN spb.starship_class IN ('Star Destroyer', 'Battlecruiser', 'Cruiser', 'Star Dreadnought') THEN 'Capital Ship'\n        ELSE 'Utility'\n    END AS starship_role,\n    \n    -- Era classification (simplified)\n    CASE\n        WHEN spb.pilot_name IN ('Anakin Skywalker', 'Obi-Wan Kenobi', 'Padm\u00e9 Amidala', \n                             'Qui-Gon Jinn', 'Mace Windu', 'Count Dooku', 'General Grievous') THEN 'Prequel Era'\n        WHEN spb.pilot_name IN ('Luke Skywalker', 'Han Solo', 'Leia Organa', 'Darth Vader', \n                             'Chewbacca', 'Lando Calrissian') THEN 'Original Trilogy Era'\n        WHEN spb.pilot_name IN ('Rey', 'Finn', 'Poe Dameron', 'Kylo Ren') THEN 'Sequel Era'\n        WHEN spb.pilot_name IN ('Din Djarin') THEN 'Mandalorian Era'\n        ELSE 'Unknown Era'\n    END AS story_era,\n    \n    -- Data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM starship_pilot_base spb\nLEFT JOIN pilot_films pf ON spb.pilot_id = pf.pilot_id\nLEFT JOIN starship_films sf ON spb.starship_id = sf.starship_id\nLEFT JOIN homeworlds hw ON spb.homeworld_id::INTEGER = hw.planet_id  -- Add explicit type cast to INTEGER\nLEFT JOIN pilot_stats ps ON spb.pilot_id = ps.pilot_id\nWHERE spb.pilot_id IS NOT NULL AND spb.starship_id IS NOT NULL\nORDER BY spb.starship_name, pilot_skill DESC, spb.pilot_name", "relation_name": "\"nerd_facts\".\"public\".\"bridge_sw_starships_pilots\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.367845Z", "completed_at": "2025-03-24T09:38:04.385554Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.386090Z", "completed_at": "2025-03-24T09:38:04.645602Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.30124998092651367, "adapter_response": {"_message": "SELECT 36", "code": "SELECT", "rows_affected": 36}, "message": "SELECT 36", "failures": null, "unique_id": "model.nerd_facts_dbt.fact_starships", "compiled": true, "compiled_code": "\n\n/*\n  Model: fact_starships (simplified)\n  Description: Fact table for Star Wars starships with basic fields\n*/\n\nWITH starships AS (\n    SELECT\n        s.starship_id,\n        s.starship_name,\n        s.model,\n        s.manufacturer,\n        s.cost_in_credits,\n        s.length,\n        s.max_atmosphering_speed,\n        s.crew,\n        s.passengers,\n        s.cargo_capacity,\n        s.consumables,\n        s.hyperdrive_rating,\n        s.MGLT,\n        s.starship_class\n    FROM \"nerd_facts\".\"public\".\"int_swapi_starships\" s\n    WHERE s.starship_id IS NOT NULL\n),\n\n-- Get film data for starships\nstarship_films AS (\n    SELECT\n        fs.starship_id,\n        COUNT(DISTINCT fs.film_id) AS film_count,\n        STRING_AGG(f.title, ', ' ORDER BY f.episode_id) AS film_names\n    FROM \"nerd_facts\".\"public\".\"int_swapi_films_starships\" fs\n    JOIN \"nerd_facts\".\"public\".\"int_swapi_films\" f ON fs.film_id = f.film_id\n    GROUP BY fs.starship_id\n)\n\nSELECT\n    -- Primary key\n    md5(cast(coalesce(cast(s.starship_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS starship_key,\n    \n    -- Core identifiers\n    s.starship_id,\n    s.starship_name,\n    s.model,\n    s.manufacturer,\n    \n    -- Classification\n    s.starship_class,\n    \n    -- Basic metrics with safe type handling\n    CASE WHEN s.cost_in_credits::TEXT ~ '^[0-9]+$' THEN s.cost_in_credits::NUMERIC ELSE NULL END AS cost_credits,\n    CASE WHEN s.length::TEXT ~ '^[0-9]+(\\.[0-9]+)?$' THEN s.length::NUMERIC ELSE NULL END AS length_m,\n    CASE WHEN s.max_atmosphering_speed::TEXT ~ '^[0-9]+$' THEN s.max_atmosphering_speed::NUMERIC ELSE NULL END AS max_speed,\n    CASE WHEN s.hyperdrive_rating::TEXT ~ '^[0-9]+(\\.[0-9]+)?$' THEN s.hyperdrive_rating::NUMERIC ELSE NULL END AS hyperdrive,\n    CASE WHEN s.MGLT::TEXT ~ '^[0-9]+$' THEN s.MGLT::NUMERIC ELSE NULL END AS MGLT,\n    \n    -- Film appearances\n    COALESCE(sf.film_count, 0) AS film_count,\n    COALESCE(sf.film_names, 'None') AS film_appearances,\n    \n    -- Data tracking field\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n    \nFROM starships s\nLEFT JOIN starship_films sf ON s.starship_id = sf.starship_id\nORDER BY s.starship_id", "relation_name": "\"nerd_facts\".\"public\".\"fact_starships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.462873Z", "completed_at": "2025-03-24T09:38:04.472638Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.473050Z", "completed_at": "2025-03-24T09:38:04.658917Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.2057335376739502, "adapter_response": {"_message": "SELECT 37", "code": "SELECT", "rows_affected": 37}, "message": "SELECT 37", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_sw_species", "compiled": true, "compiled_code": "\n\n/*\n  Model: dim_sw_species\n  Description: Species dimension table with enriched attributes and classifications\n*/\n\nWITH species_base AS (\n    SELECT\n        s.species_id,\n        s.species_name,  -- Using species_name directly instead of s.name\n        s.classification,\n        s.designation,\n        s.average_height,\n        s.skin_colors,\n        s.hair_colors,\n        s.eye_colors,\n        s.average_lifespan,\n        s.language,\n        s.homeworld AS homeworld_id  -- Use homeworld instead of homeworld_id\n    FROM \"nerd_facts\".\"public\".\"int_swapi_species\" s\n),\n\n-- Film appearances\nfilm_appearances AS (\n    SELECT\n        fs.species_id,\n        COUNT(DISTINCT fs.film_id) AS film_count\n    FROM \"nerd_facts\".\"public\".\"int_swapi_films_species\" fs\n    GROUP BY fs.species_id\n),\n\n-- Character counts - estimate based on species mentions in films\n-- Since we don't have direct access to character-species relationships\ncharacter_counts AS (\n    SELECT\n        fs.species_id,\n        COUNT(DISTINCT fc.people_id) AS character_count\n    FROM \"nerd_facts\".\"public\".\"int_swapi_films_species\" fs\n    JOIN \"nerd_facts\".\"public\".\"int_swapi_films_characters\" fc ON fs.film_id = fc.film_id\n    GROUP BY fs.species_id\n),\n\n-- Enriched species data\nspecies_enriched AS (\n    SELECT\n        sb.*,\n        COALESCE(fa.film_count, 0) AS film_count,\n        COALESCE(cc.character_count, 0) AS character_count\n    FROM species_base sb\n    LEFT JOIN film_appearances fa ON sb.species_id = fa.species_id\n    LEFT JOIN character_counts cc ON sb.species_id = cc.species_id\n)\n\nSELECT\n    -- Primary Key\n    md5(cast(coalesce(cast(se.species_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS species_key,\n    \n    -- Natural Key\n    se.species_id,\n    \n    -- Species Attributes\n    se.species_name,\n    se.classification,\n    se.designation,\n    se.average_height,\n    se.skin_colors,\n    se.hair_colors,\n    se.eye_colors,\n    se.average_lifespan,\n    se.language,\n    se.homeworld_id,\n    \n    -- Related Dimensions\n    md5(cast(coalesce(cast(se.homeworld_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS homeworld_key,\n    \n    -- Appearance Metrics\n    se.film_count,\n    se.character_count,\n    \n    -- Species Classifications\n    CASE\n        WHEN se.classification ILIKE '%mammal%' THEN 'Mammalian'\n        WHEN se.classification ILIKE '%reptile%' THEN 'Reptilian'\n        WHEN se.classification ILIKE '%amphibian%' THEN 'Amphibian'\n        WHEN se.classification ILIKE '%insect%' THEN 'Insectoid'\n        WHEN se.classification ILIKE '%sentient%' THEN 'Sentient'\n        ELSE se.classification\n    END AS species_type,\n    \n    -- Sentience level\n    CASE\n        WHEN se.designation ILIKE '%sentient%' THEN 'Sentient'\n        ELSE 'Non-sentient'\n    END AS sentience_level,\n    \n    -- Size classification based on average_height\n    CASE\n        WHEN se.average_height::NUMERIC > 200 THEN 'Tall'\n        WHEN se.average_height::NUMERIC BETWEEN 150 AND 200 THEN 'Medium'\n        WHEN se.average_height::NUMERIC > 0 AND se.average_height::NUMERIC < 150 THEN 'Short'\n        ELSE 'Unknown'\n    END AS size_classification,\n    \n    -- Longevity based on average_lifespan\n    CASE\n        WHEN se.average_lifespan::NUMERIC > 500 THEN 'Very Long-Lived'\n        WHEN se.average_lifespan::NUMERIC > 150 THEN 'Long-Lived'\n        WHEN se.average_lifespan::NUMERIC > 70 THEN 'Standard'\n        WHEN se.average_lifespan::NUMERIC > 0 THEN 'Short-Lived'\n        ELSE 'Unknown'\n    END AS longevity_classification,\n    \n    -- Notable Species flag\n    CASE \n        WHEN se.species_name IN ('Human', 'Wookiee', 'Droid', 'Hutt', 'Yoda''s species', \n                              'Zabrak', 'Twi''lek', 'Mon Calamari', 'Ewok', 'Gungan') \n            OR se.film_count >= 3  \n        THEN TRUE\n        ELSE FALSE\n    END AS is_notable_species,\n    \n    -- Force sensitivity prevalence\n    CASE \n        WHEN se.species_name IN ('Yoda''s species') THEN 'High'\n        WHEN se.species_name IN ('Human', 'Zabrak', 'Togruta') THEN 'Medium'\n        ELSE 'Low/Unknown'\n    END AS force_sensitivity_prevalence,\n    \n    -- Narrative importance\n    CASE\n        WHEN se.film_count >= 3 THEN 'Major'\n        WHEN se.film_count >= 2 THEN 'Significant'\n        WHEN se.film_count = 1 THEN 'Featured'\n        ELSE 'Minor'\n    END AS narrative_importance,\n    \n    -- Data Tracking\n    CURRENT_TIMESTAMP AS dbt_loaded_at\n\nFROM species_enriched se", "relation_name": "\"nerd_facts\".\"public\".\"dim_sw_species\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.484879Z", "completed_at": "2025-03-24T09:38:04.493962Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.497249Z", "completed_at": "2025-03-24T09:38:04.663721Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.1893906593322754, "adapter_response": {"_message": "SELECT 6", "code": "SELECT", "rows_affected": 6}, "message": "SELECT 6", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_sw_films", "compiled": true, "compiled_code": "\n\n/*\n  Model: dim_sw_films\n  Description: Film dimension table with enriched attributes\n*/\n\nWITH film_base AS (\n  SELECT\n    f.film_id,\n    f.title,\n    f.episode_id,\n    f.opening_crawl,\n    f.director,\n    f.producer,\n    f.release_date\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films\" f\n),\n\n-- Character counts\ncharacter_counts AS (\n  SELECT\n    fc.film_id,\n    COUNT(DISTINCT fc.people_id) AS character_count\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_characters\" fc\n  GROUP BY fc.film_id\n),\n\n-- Planet counts\nplanet_counts AS (\n  SELECT\n    fp.film_id,\n    COUNT(DISTINCT fp.planet_id) AS planet_count\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_planets\" fp\n  GROUP BY fp.film_id\n),\n\n-- Vehicle counts\nvehicle_counts AS (\n  SELECT\n    fv.film_id,\n    COUNT(DISTINCT fv.vehicle_id) AS vehicle_count\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_vehicles\" fv\n  GROUP BY fv.film_id\n),\n\n-- Starship counts\nstarship_counts AS (\n  SELECT\n    fs.film_id,\n    COUNT(DISTINCT fs.starship_id) AS starship_count\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_starships\" fs\n  GROUP BY fs.film_id\n),\n\n-- Species counts\nspecies_counts AS (\n  SELECT\n    fsp.film_id,\n    COUNT(DISTINCT fsp.species_id) AS species_count\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_species\" fsp\n  GROUP BY fsp.film_id\n)\n\nSELECT\n  -- Primary Key\n  md5(cast(coalesce(cast(fb.film_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS film_key,\n  \n  -- Natural Key\n  fb.film_id,\n  \n  -- Film Attributes\n  fb.title AS film_title,\n  fb.episode_id,\n  fb.opening_crawl,\n  fb.director,\n  fb.producer,\n  fb.release_date,\n  \n  -- Film Classification\n  CASE\n    WHEN fb.episode_id BETWEEN 1 AND 3 THEN 'Prequel Trilogy'\n    WHEN fb.episode_id BETWEEN 4 AND 6 THEN 'Original Trilogy'\n    WHEN fb.episode_id BETWEEN 7 AND 9 THEN 'Sequel Trilogy'\n    ELSE 'Anthology Films'\n  END AS film_saga,\n  \n  CASE\n    WHEN fb.episode_id BETWEEN 1 AND 3 THEN 'Republic Era'\n    WHEN fb.episode_id BETWEEN 4 AND 6 THEN 'Imperial Era'\n    WHEN fb.episode_id BETWEEN 7 AND 9 THEN 'New Republic Era'\n    ELSE 'Various'\n  END AS era,\n  \n  -- Release information\n  EXTRACT(YEAR FROM fb.release_date) AS release_year,\n  \n  -- Entity counts\n  COALESCE(cc.character_count, 0) AS character_count,\n  COALESCE(pc.planet_count, 0) AS planet_count,\n  COALESCE(vc.vehicle_count, 0) AS vehicle_count,\n  COALESCE(sc.starship_count, 0) AS starship_count,\n  COALESCE(spc.species_count, 0) AS species_count,\n  \n  -- Calculated metrics\n  COALESCE(cc.character_count, 0) + \n  COALESCE(pc.planet_count, 0) + \n  COALESCE(vc.vehicle_count, 0) + \n  COALESCE(sc.starship_count, 0) + \n  COALESCE(spc.species_count, 0) AS total_entity_count,\n  \n  -- Cast size classification\n  CASE\n    WHEN COALESCE(cc.character_count, 0) <= 10 THEN 'Small Cast'\n    WHEN COALESCE(cc.character_count, 0) <= 25 THEN 'Medium Cast'\n    ELSE 'Large Cast'\n  END AS cast_size_category,\n  \n  -- Film importance\n  CASE\n    WHEN fb.episode_id IN (4, 5, 6) THEN 'Foundational'\n    WHEN fb.episode_id IN (1, 2, 3, 7, 8, 9) THEN 'Main Saga'\n    ELSE 'Extended Universe'\n  END AS film_importance,\n  \n  -- Time Dimension\n  CURRENT_TIMESTAMP AS dbt_loaded_at\n\nFROM film_base fb\nLEFT JOIN character_counts cc ON fb.film_id = cc.film_id\nLEFT JOIN planet_counts pc ON fb.film_id = pc.film_id\nLEFT JOIN vehicle_counts vc ON fb.film_id = vc.film_id\nLEFT JOIN starship_counts sc ON fb.film_id = sc.film_id\nLEFT JOIN species_counts spc ON fb.film_id = spc.film_id\nORDER BY fb.episode_id", "relation_name": "\"nerd_facts\".\"public\".\"dim_sw_films\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.702861Z", "completed_at": "2025-03-24T09:38:04.709406Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.709848Z", "completed_at": "2025-03-24T09:38:04.820044Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.13999223709106445, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_test_directories", "compiled": true, "compiled_code": "with\n\nresources as (\n\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n\n),\n\nrelationships as (\n\n    select * from \"nerd_facts\".\"public\".\"int_direct_relationships\"\n\n),\n\nmodels_per_test as (\n\n    select\n        resource_name as test_name,\n        resource_id as test_id,\n        direct_parent_id as parent_model_id\n    from relationships\n    where resource_type = 'test'\n    and is_primary_test_relationship\n\n),\n\nmodel_file_paths as (\n\n    select\n        resources.resource_id as model_id,\n        resources.resource_name as model_name,\n        resources.directory_path as model_directory_path,\n        models_per_test.test_id,\n        models_per_test.parent_model_id\n    from resources\n    inner join models_per_test\n    on models_per_test.parent_model_id = resources.resource_id\n    where resource_type = 'model'\n\n),\n\ntest_file_paths as (\n\n    select\n        resource_id as test_id,\n        resource_name as test_name,\n        file_name as test_yml_name,\n        directory_path as test_yml_directory_path\n    from resources\n    where \n        resource_type = 'test'\n        and is_generic_test\n\n),\n\nall_file_paths as (\n\n    select\n        test_file_paths.test_id,\n        test_file_paths.test_name,\n        test_file_paths.test_yml_directory_path,\n        test_file_paths.test_yml_name,\n        model_file_paths.model_id,\n        model_file_paths.model_name,\n        model_file_paths.model_directory_path\n    from model_file_paths\n    inner join test_file_paths\n    on model_file_paths.test_id = test_file_paths.test_id\n\n),\n\ndifferent_directories as (\n\n    select\n        test_name,\n        model_name,\n        test_yml_directory_path as current_test_directory,\n        model_directory_path as change_test_directory_to\n    from all_file_paths\n    where model_directory_path != test_yml_directory_path\n\n)\n\nselect * from different_directories\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_test_directories\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.666967Z", "completed_at": "2025-03-24T09:38:04.676768Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.677534Z", "completed_at": "2025-03-24T09:38:04.835371Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.17949938774108887, "adapter_response": {"_message": "SELECT 39", "code": "SELECT", "rows_affected": 39}, "message": "SELECT 39", "failures": null, "unique_id": "model.nerd_facts_dbt.dim_sw_vehicles", "compiled": true, "compiled_code": "\n\n-- Get vehicle data from intermediate layer\nWITH vehicle_film_data AS (\n  SELECT\n    fv.vehicle_id,\n    COUNT(DISTINCT fv.film_id) AS film_count,\n    STRING_AGG(f.title, ', ' ORDER BY f.episode_id) AS film_appearances\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_vehicles\" fv\n  JOIN \"nerd_facts\".\"public\".\"int_swapi_films\" f ON fv.film_id = f.film_id\n  GROUP BY fv.vehicle_id\n),\n\n-- Add context data without trying numeric conversions\nvehicle_context AS (\n  SELECT\n    v.vehicle_id,\n    v.vehicle_name,  -- Already using vehicle_name\n    v.model,\n    v.manufacturer,\n    v.vehicle_class,\n    v.consumables,\n    COALESCE(vfd.film_count, 0) AS film_appearances_count,\n    COALESCE(vfd.film_appearances, 'None') AS film_appearances,\n    \n    -- Size classification based on known vehicle classes\n    CASE\n      WHEN v.vehicle_class ILIKE '%walker%' THEN 'Very Large'\n      WHEN v.vehicle_class ILIKE '%transport%' THEN 'Large'\n      WHEN v.vehicle_class ILIKE '%speeder%' THEN 'Medium'\n      WHEN v.vehicle_class ILIKE '%bike%' OR v.vehicle_class ILIKE '%pod%' THEN 'Small'\n      ELSE 'Medium'\n    END AS vehicle_size,\n    \n    -- Purpose classification\n    CASE \n      WHEN v.vehicle_class ILIKE '%combat%' OR \n           v.vehicle_class ILIKE '%assault%' OR\n           v.vehicle_class ILIKE '%walker%' OR\n           v.vehicle_class ILIKE '%fighter%' THEN 'Military'\n      WHEN v.vehicle_class ILIKE '%transport%' OR\n           v.vehicle_class ILIKE '%cargo%' THEN 'Transport'\n      WHEN v.vehicle_class ILIKE '%speeder%' THEN 'Civilian'\n      ELSE 'Multipurpose'\n    END AS vehicle_purpose,\n    \n    -- Terrain capability\n    CASE\n      WHEN v.vehicle_class ILIKE '%speeder%' AND v.vehicle_class ILIKE '%snow%' THEN 'Snow'\n      WHEN v.vehicle_class ILIKE '%speeder%' THEN 'Ground'\n      WHEN v.vehicle_class ILIKE '%submarine%' THEN 'Water'\n      WHEN v.vehicle_class ILIKE '%walker%' THEN 'All-Terrain'\n      WHEN v.vehicle_class ILIKE '%airspeeder%' THEN 'Air'\n      ELSE 'Ground'\n    END AS terrain_capability,\n    \n    -- Notable vehicles\n    CASE \n      WHEN v.vehicle_name IN ('AT-AT', 'AT-ST', 'Snowspeeder', 'Speeder bike',\n                     'Imperial Speeder Bike', 'Sand Crawler', 'TIE bomber',\n                     'TIE fighter', 'X-34 landspeeder') THEN TRUE\n      ELSE FALSE\n    END AS is_notable_vehicle,\n    \n    -- Move faction affiliation calculation to the CTE so it's available for ORDER BY\n    CASE\n      WHEN LOWER(v.vehicle_name) LIKE '%imperial%' OR\n           LOWER(v.vehicle_name) IN ('at-at', 'at-st', 'at-dp', 'tie bomber',\n                                 'tie fighter', 'tie interceptor') THEN 'Imperial'\n      WHEN LOWER(v.vehicle_name) LIKE '%republic%' THEN 'Republic'\n      WHEN LOWER(v.vehicle_name) LIKE '%rebel%' OR\n           LOWER(v.vehicle_name) IN ('snowspeeder', 'x-34 landspeeder') THEN 'Rebel Alliance'\n      ELSE 'Civilian/Neutral'\n    END AS faction_affiliation\n    \n  FROM \"nerd_facts\".\"public\".\"int_swapi_vehicles\" v\n  LEFT JOIN vehicle_film_data vfd ON v.vehicle_id = vfd.vehicle_id\n)\n\n-- Final output with surrogate key and enriched attributes\nSELECT \n  md5(cast(coalesce(cast(v.vehicle_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS vehicle_key,\n  v.vehicle_id,\n  v.vehicle_name,\n  v.model,\n  v.manufacturer,\n  \n  -- Technical classifications\n  v.vehicle_class,\n  v.vehicle_size,\n  v.vehicle_purpose,\n  v.terrain_capability,\n  v.consumables,\n  \n  -- Film information\n  v.film_appearances_count,\n  v.film_appearances,\n  \n  -- Star Wars universe context - using the pre-calculated field\n  v.faction_affiliation,\n  \n  -- Calculate effectiveness rating\n  CASE \n    WHEN v.vehicle_purpose = 'Military' THEN\n      GREATEST(1, LEAST(10, 5 + \n        CASE\n          WHEN v.vehicle_size = 'Very Large' THEN 3\n          WHEN v.vehicle_size = 'Large' THEN 2\n          WHEN v.vehicle_size = 'Medium' THEN 1\n          WHEN v.vehicle_size = 'Small' THEN 0\n          ELSE 0\n        END\n      ))\n    WHEN v.vehicle_purpose = 'Transport' THEN 5\n    ELSE 3\n  END AS effectiveness_rating,\n  \n  -- Notable flag\n  v.is_notable_vehicle AS is_iconic,\n  \n  -- Time dimension\n  CURRENT_TIMESTAMP AS dbt_loaded_at\n  \nFROM vehicle_context v\nWHERE v.vehicle_id IS NOT NULL\nORDER BY v.faction_affiliation, v.vehicle_name", "relation_name": "\"nerd_facts\".\"public\".\"dim_sw_vehicles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.716157Z", "completed_at": "2025-03-24T09:38:04.731027Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.731943Z", "completed_at": "2025-03-24T09:38:04.843341Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.14393901824951172, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.int_all_dag_relationships", "compiled": true, "compiled_code": "-- creates a cte called all_relationships that will either use \"with recursive\" or loops depending on the DW\n\n\nwith recursive direct_relationships as (\n    select\n        *\n    from \"nerd_facts\".\"public\".\"int_direct_relationships\"\n    where resource_type <> 'test'\n),\n\n-- should this be a fct_ model?\n\n-- recursive CTE\n-- one record for every resource and each of its downstream children (including itself)\nall_relationships (\n    parent_id,\n    parent,\n    parent_resource_type,\n    parent_model_type,\n    parent_materialized,\n    parent_access,\n    parent_is_public,\n    parent_source_name,\n    parent_file_path,\n    parent_directory_path,\n    parent_file_name,\n    parent_is_excluded,\n    child_id,\n    child,\n    child_resource_type,\n    child_model_type,\n    child_materialized,\n    child_access,\n    child_is_public,\n    child_source_name,\n    child_file_path,\n    child_directory_path,\n    child_file_name,\n    child_is_excluded,\n    distance,\n    path,\n    is_dependent_on_chain_of_views\n) as (\n    -- anchor\n    select distinct\n        resource_id as parent_id,\n        resource_name as parent,\n        resource_type as parent_resource_type,\n        model_type as parent_model_type,\n        materialized as parent_materialized,\n        access as parent_access,\n        is_public as parent_is_public,\n        source_name as parent_source_name,\n        file_path as parent_file_path,\n        directory_path as parent_directory_path,\n        file_name as parent_file_name,\n        is_excluded as parent_is_excluded,\n        resource_id as child_id,\n        resource_name as child,\n        resource_type as child_resource_type,\n        model_type as child_model_type,\n        materialized as child_materialized,\n        access as child_access,\n        is_public as child_is_public,\n        source_name as child_source_name,\n        file_path as child_file_path,\n        directory_path as child_directory_path,\n        file_name as child_file_name,\n        is_excluded as child_is_excluded,\n        0 as distance,\n        \n    array[ resource_name ]\n     as path,\n        cast(null as boolean) as is_dependent_on_chain_of_views\n\n    from direct_relationships\n    -- where direct_parent_id is null \n\n    union all\n\n    -- recursive clause\n    select\n        all_relationships.parent_id as parent_id,\n        all_relationships.parent as parent,\n        all_relationships.parent_resource_type as parent_resource_type,\n        all_relationships.parent_model_type as parent_model_type,\n        all_relationships.parent_materialized as parent_materialized,\n        all_relationships.parent_access as parent_access,\n        all_relationships.parent_is_public as parent_is_public,\n        all_relationships.parent_source_name as parent_source_name,\n        all_relationships.parent_file_path as parent_file_path,\n        all_relationships.parent_directory_path as parent_directory_path,\n        all_relationships.parent_file_name as parent_file_name,\n        all_relationships.parent_is_excluded as parent_is_excluded,\n        direct_relationships.resource_id as child_id,\n        direct_relationships.resource_name as child,\n        direct_relationships.resource_type as child_resource_type,\n        direct_relationships.model_type as child_model_type,\n        direct_relationships.materialized as child_materialized,\n        direct_relationships.access as child_access,\n        direct_relationships.is_public as child_is_public,\n        direct_relationships.source_name as child_source_name,\n        direct_relationships.file_path as child_file_path,\n        direct_relationships.directory_path as child_directory_path,\n        direct_relationships.file_name as child_file_name,\n        direct_relationships.is_excluded as child_is_excluded,\n        all_relationships.distance+1 as distance,\n        array_append(all_relationships.path, direct_relationships.resource_name) as path,\n        case\n            when\n                all_relationships.child_materialized in ('view', 'ephemeral')\n                and coalesce(all_relationships.is_dependent_on_chain_of_views, true)\n                then true\n            else false\n        end as is_dependent_on_chain_of_views\n\n    from direct_relationships\n    inner join all_relationships\n        on all_relationships.child_id = direct_relationships.direct_parent_id\n\n    \n\n)\n\n\n\nselect * from all_relationships\norder by parent, distance", "relation_name": "\"nerd_facts\".\"public\".\"int_all_dag_relationships\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.683663Z", "completed_at": "2025-03-24T09:38:04.694008Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.695105Z", "completed_at": "2025-03-24T09:38:04.878575Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.20422959327697754, "adapter_response": {"_message": "SELECT 6", "code": "SELECT", "rows_affected": 6}, "message": "SELECT 6", "failures": null, "unique_id": "model.nerd_facts_dbt.fact_sw_films", "compiled": true, "compiled_code": "\n\n/*\n  Model: fact_sw_films\n  Description: Film fact table with metrics about characters, planets, vehicles, starships and species\n*/\n\n-- Film base information\nWITH film_base AS (\n  SELECT\n    f.film_id,\n    f.title,\n    f.episode_id,\n    f.release_date,\n    EXTRACT(YEAR FROM f.release_date) AS release_year\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films\" f\n),\n\n-- Character counts with gender breakdown\ncharacter_metrics AS (\n  SELECT \n    fc.film_id,\n    COUNT(DISTINCT fc.people_id) AS total_characters,\n    SUM(CASE WHEN p.gender = 'male' THEN 1 ELSE 0 END) AS male_characters,\n    SUM(CASE WHEN p.gender = 'female' THEN 1 ELSE 0 END) AS female_characters,\n    SUM(CASE WHEN p.gender NOT IN ('male', 'female') OR p.gender IS NULL THEN 1 ELSE 0 END) AS other_gender_characters,\n    -- Force users\n    SUM(CASE \n      WHEN p.name IN ('Luke Skywalker', 'Darth Vader', 'Anakin Skywalker', 'Rey', 'Kylo Ren',\n                    'Obi-Wan Kenobi', 'Emperor Palpatine', 'Yoda', 'Mace Windu',\n                    'Count Dooku', 'Qui-Gon Jinn', 'Darth Maul', 'Ahsoka Tano')\n      THEN 1 ELSE 0 \n    END) AS force_users\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_characters\" fc\n  JOIN \"nerd_facts\".\"public\".\"int_swapi_people\" p ON fc.people_id = p.people_id\n  GROUP BY fc.film_id\n),\n\n-- Planet counts\nplanet_metrics AS (\n  SELECT \n    fp.film_id,\n    COUNT(DISTINCT fp.planet_id) AS total_planets\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_planets\" fp\n  GROUP BY fp.film_id\n),\n\n-- Vehicle counts\nvehicle_metrics AS (\n  SELECT \n    fv.film_id,\n    COUNT(DISTINCT fv.vehicle_id) AS total_vehicles\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_vehicles\" fv\n  GROUP BY fv.film_id\n),\n\n-- Starship counts\nstarship_metrics AS (\n  SELECT \n    fs.film_id,\n    COUNT(DISTINCT fs.starship_id) AS total_starships\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_starships\" fs\n  GROUP BY fs.film_id\n),\n\n-- Species counts\nspecies_metrics AS (\n  SELECT \n    fsp.film_id,\n    COUNT(DISTINCT fsp.species_id) AS total_species\n  FROM \"nerd_facts\".\"public\".\"int_swapi_films_species\" fsp\n  GROUP BY fsp.film_id\n)\n\nSELECT\n  -- Primary Key (same as dim_films)\n  md5(cast(coalesce(cast(fb.film_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS film_key,\n  \n  -- Natural Key\n  fb.film_id,\n  \n  -- Film Identifiers\n  fb.title AS film_title,\n  fb.episode_id,\n  fb.release_date,\n  fb.release_year,\n  \n  -- Character Metrics\n  COALESCE(cm.total_characters, 0) AS character_count,\n  COALESCE(cm.male_characters, 0) AS male_character_count,\n  COALESCE(cm.female_characters, 0) AS female_character_count,\n  COALESCE(cm.other_gender_characters, 0) AS other_gender_character_count,\n  COALESCE(cm.force_users, 0) AS force_user_count,\n  \n  -- Gender diversity ratio (percentage of non-male characters)\n  CASE \n    WHEN COALESCE(cm.total_characters, 0) > 0 \n    THEN ROUND((COALESCE(cm.female_characters, 0) * 100.0 / COALESCE(cm.total_characters, 1)), 1)\n    ELSE 0\n  END AS female_character_percentage,\n  \n  -- Force user ratio\n  CASE \n    WHEN COALESCE(cm.total_characters, 0) > 0 \n    THEN ROUND((COALESCE(cm.force_users, 0) * 100.0 / COALESCE(cm.total_characters, 1)), 1)\n    ELSE 0\n  END AS force_user_percentage,\n  \n  -- Planet Metrics\n  COALESCE(pm.total_planets, 0) AS planet_count,\n  \n  -- Vehicle Metrics\n  COALESCE(vm.total_vehicles, 0) AS vehicle_count,\n  \n  -- Starship Metrics\n  COALESCE(sm.total_starships, 0) AS starship_count,\n  \n  -- Species Metrics\n  COALESCE(spm.total_species, 0) AS species_count,\n  \n  -- Total Entity Count\n  (COALESCE(cm.total_characters, 0) + COALESCE(pm.total_planets, 0) + \n   COALESCE(vm.total_vehicles, 0) + COALESCE(sm.total_starships, 0) +\n   COALESCE(spm.total_species, 0)) AS total_entity_count,\n  \n  -- Vehicle to Character Ratio\n  CASE \n    WHEN COALESCE(cm.total_characters, 0) > 0\n    THEN ROUND(((COALESCE(vm.total_vehicles, 0) + COALESCE(sm.total_starships, 0)) * 1.0 / \n           NULLIF(COALESCE(cm.total_characters, 0), 0)), 2)\n    ELSE 0\n  END AS vehicle_character_ratio,\n  \n  -- Time Dimension\n  CURRENT_TIMESTAMP AS dbt_loaded_at\n\nFROM film_base fb\nLEFT JOIN character_metrics cm ON fb.film_id = cm.film_id\nLEFT JOIN planet_metrics pm ON fb.film_id = pm.film_id\nLEFT JOIN vehicle_metrics vm ON fb.film_id = vm.film_id\nLEFT JOIN starship_metrics sm ON fb.film_id = sm.film_id\nLEFT JOIN species_metrics spm ON fb.film_id = spm.film_id\nORDER BY fb.episode_id", "relation_name": "\"nerd_facts\".\"public\".\"fact_sw_films\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:04.851403Z", "completed_at": "2025-03-24T09:38:04.861087Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:04.861707Z", "completed_at": "2025-03-24T09:38:04.908792Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.06127429008483887, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.int_model_test_summary", "compiled": true, "compiled_code": "with \n\nall_graph_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n),\n\nrelationships as (\n    select * from \"nerd_facts\".\"public\".\"int_direct_relationships\"\n),\n\ncount_column_tests as (\n    \n    select \n        relationships.direct_parent_id, \n        all_graph_resources.column_name,\n        sum(case\n                when all_graph_resources.is_test_unique\n                then 1\n                else 0\n            end\n         ) as test_unique_count,count(distinct case when \n                all_graph_resources.is_test_unique or  \n                all_graph_resources.is_test_not_null\n            then relationships.resource_id else null end\n        ) as primary_key_method_1_count,count(distinct case when \n                all_graph_resources.is_test_unique_combination_of_columns\n            then relationships.resource_id else null end\n        ) as primary_key_method_2_count,\n        count(distinct relationships.resource_id) as tests_count\n    from all_graph_resources\n    left join relationships\n        on all_graph_resources.resource_id = relationships.resource_id\n    where all_graph_resources.resource_type = 'test'\n    and relationships.is_primary_test_relationship\n    group by 1,2\n),\n\ncount_column_constraints as (\n\n    select\n        node_unique_id as direct_parent_id,\n        name as column_name,\n        case\n            when has_not_null_constraint\n            then 1\n            else 0\n        end as constraint_not_null_count,\n        constraints_count\n    from \"nerd_facts\".\"public\".\"base_node_columns\"\n\n),\n\ncombine_column_counts as (\n\n    select\n        count_column_tests.*,\n        count_column_tests.test_unique_count + count_column_constraints.constraint_not_null_count as primary_key_mixed_method_count,\n        count_column_constraints.constraints_count\n    from count_column_tests\n    left join count_column_constraints\n        on count_column_tests.direct_parent_id = count_column_constraints.direct_parent_id\n        and count_column_tests.column_name = count_column_constraints.column_name\n\n),\n\nagg_test_relationships as (\n\n    select \n        direct_parent_id, \n        cast(sum(case \n                when (\n                    primary_key_method_1_count >= 2\n                        or\n                    primary_key_method_2_count >= 1\n                        or\n                    primary_key_mixed_method_count >= 2\n                ) then 1 \n                else 0 \n            end\n        ) >= 1 as boolean) as is_primary_key_tested,\n        cast(sum(tests_count) as integer) as number_of_tests_on_model,\n        cast(sum(constraints_count) as integer) as number_of_constraints_on_model\n    from combine_column_counts\n    group by 1\n\n),\n\nfinal as (\n    select \n        all_graph_resources.resource_name,\n        all_graph_resources.resource_type,\n        all_graph_resources.model_type,\n        cast(coalesce(agg_test_relationships.is_primary_key_tested, FALSE) as boolean) as is_primary_key_tested,\n        cast(coalesce(agg_test_relationships.number_of_tests_on_model, 0) as integer) as number_of_tests_on_model,\n        cast(coalesce(agg_test_relationships.number_of_constraints_on_model, 0) as integer) as number_of_constraints_on_model\n    from all_graph_resources\n    left join agg_test_relationships\n        on all_graph_resources.resource_id = agg_test_relationships.direct_parent_id\n    where\n        all_graph_resources.resource_type in ('model', 'seed', 'source', 'snapshot')\n)\n\nselect * from final", "relation_name": "\"nerd_facts\".\"public\".\"int_model_test_summary\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:05.557794Z", "completed_at": "2025-03-24T09:38:05.575734Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:05.577557Z", "completed_at": "2025-03-24T09:38:05.707388Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.15612125396728516, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_chained_views_dependencies", "compiled": true, "compiled_code": "with all_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where distance <> 0\n    and not parent_is_excluded\n    and not child_is_excluded\n),\n\nfinal as (\n    select\n        parent,\n        child, -- the model with potentially long run time / compilation time, improve performance by breaking the upstream chain of views\n        distance,\n        path\n    from all_relationships\n    where is_dependent_on_chain_of_views\n    and child_resource_type = 'model'\n    and distance > 5\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n\n\norder by distance desc", "relation_name": "\"nerd_facts\".\"public\".\"fct_chained_views_dependencies\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:05.572078Z", "completed_at": "2025-03-24T09:38:05.595533Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:05.598325Z", "completed_at": "2025-03-24T09:38:05.708785Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.16153311729431152, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_exposures_dependent_on_private_models", "compiled": true, "compiled_code": "with \n\ndirect_exposure_relationships as (\n    select * from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where \n        distance = 1\n        and child_resource_type = 'exposure'\n        and not (\n                parent_resource_type = 'model'\n                and parent_is_public\n            )\n        and not parent_is_excluded\n),\n\nfinal as (\n\n    select \n        child as exposure_name,\n        parent as parent_resource_name,\n        parent_access,\n        parent_resource_type\n\n    from direct_exposure_relationships\n\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_exposures_dependent_on_private_models\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:05.567601Z", "completed_at": "2025-03-24T09:38:05.576447Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:05.582881Z", "completed_at": "2025-03-24T09:38:05.699467Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.15396523475646973, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_exposure_parents_materializations", "compiled": true, "compiled_code": "with \n\ndirect_exposure_relationships as (\n    select * from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where \n        distance = 1\n        and child_resource_type = 'exposure'\n        and ((\n                parent_resource_type = 'model'\n                and parent_materialized in ('view', 'ephemeral')\n            )\n            or (\n                parent_resource_type = 'source'\n            )\n        )\n        -- no test on child_is_excluded because exposures are never excluded\n        and not parent_is_excluded\n),\n\nfinal as (\n\n    select \n        parent_resource_type,\n        parent as parent_resource_name,\n        child as exposure_name,\n        parent_materialized as parent_model_materialization\n\n    from direct_exposure_relationships\n\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_exposure_parents_materializations\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:05.562843Z", "completed_at": "2025-03-24T09:38:05.577009Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:05.589020Z", "completed_at": "2025-03-24T09:38:05.768268Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.21585988998413086, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_direct_join_to_source", "compiled": true, "compiled_code": "-- this model finds cases where a model has a reference to both a model and a source\n\nwith direct_model_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where child_resource_type = 'model'\n    and distance = 1\n    and not parent_is_excluded\n    and not child_is_excluded\n),\n\nmodel_and_source_joined as (\n    select\n        child,\n        case \n            when (\n                sum(case when parent_resource_type = 'model' then 1 else 0 end) > 0 \n                and sum(case when parent_resource_type = 'source' then 1 else 0 end) > 0\n            ) \n            then true\n            else false \n        end as keep_row \n    from direct_model_relationships\n    group by 1\n),\n\nfinal as (\n    select \n        direct_model_relationships.parent,\n        direct_model_relationships.parent_resource_type,\n        direct_model_relationships.child,\n        direct_model_relationships.child_resource_type,\n        direct_model_relationships.distance\n    from direct_model_relationships\n    inner join model_and_source_joined\n        on direct_model_relationships.child = model_and_source_joined.child\n    where model_and_source_joined.keep_row\n    order by direct_model_relationships.child\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_direct_join_to_source\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:05.743407Z", "completed_at": "2025-03-24T09:38:05.766732Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:05.775704Z", "completed_at": "2025-03-24T09:38:05.976936Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.25286054611206055, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_model_directories", "compiled": true, "compiled_code": "-- This model finds all cases where a model is NOT in the appropriate subdirectory:\n    -- For staging models: The files should be in nested in the staging folder in a subfolder that matches their source parent's name.\n    -- For non-staging models: The files should be nested closest to their appropriate folder.  \n\n \nwith all_graph_resources as (\n    select * from \"nerd_facts\".\"public\".\"int_all_graph_resources\"\n    where not is_excluded\n),\n\nfolders as (\n    select * from \"nerd_facts\".\"public\".\"stg_naming_convention_folders\"\n), \n\nall_dag_relationships as (\n    select * from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where not child_is_excluded\n),\n\nstaging_models as (\n    select  \n        child,\n        child_resource_type,\n        child_model_type,\n        child_file_path,\n        child_directory_path,\n        child_file_name,\n        parent_source_name\n    from all_dag_relationships\n    where parent_resource_type = 'source'\n    and child_resource_type = 'model'\n    and child_model_type = 'staging'\n),\n\n-- find all staging models that are NOT in their source parent's subdirectory\ninappropriate_subdirectories_staging as (\n    select distinct -- must do distinct to avoid duplicates when staging model has multiple paths to a given source\n        child as resource_name,\n        child_resource_type as resource_type,\n        child_model_type as model_type,\n        child_file_path as current_file_path,\n        'models/' || 'staging' || '/' || parent_source_name || '/' || child_file_name as change_file_path_to\n    from staging_models\n    where child_directory_path not like '%' || parent_source_name || '%'\n),\n\n-- find all non-staging models that are NOT nested closest to their appropriate folder\ninnappropriate_subdirectories_non_staging_models as (\n    select \n        all_graph_resources.resource_name,\n        all_graph_resources.resource_type,\n        all_graph_resources.model_type,\n        all_graph_resources.file_path as current_file_path,\n        'models' || '/.../' || folders.folder_name_value || '/.../' || all_graph_resources.file_name as change_file_path_to\n    from all_graph_resources\n    left join folders \n        on folders.model_type = all_graph_resources.model_type \n    -- either appropriate folder_name is not in the current_directory_path or a inappropriate folder name is closer to the file_name\n    where all_graph_resources.model_type <> all_graph_resources.model_type_folder \n),\n\nunioned as (\n    select * from inappropriate_subdirectories_staging\n    union all\n    select * from innappropriate_subdirectories_non_staging_models\n)\n\nselect * from unioned\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_model_directories\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:05.751002Z", "completed_at": "2025-03-24T09:38:05.758273Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:05.758837Z", "completed_at": "2025-03-24T09:38:05.989155Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.23987078666687012, "adapter_response": {"_message": "SELECT 11", "code": "SELECT", "rows_affected": 11}, "message": "SELECT 11", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_model_fanout", "compiled": true, "compiled_code": "with all_dag_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where not parent_is_excluded\n    and not child_is_excluded\n),\n\n-- find all models without children\nmodels_without_children as (\n    select\n        parent\n    from all_dag_relationships\n    where parent_resource_type = 'model'\n    group by 1\n    having max(distance) = 0\n),\n\n-- all parents with more direct children than the threshold for fanout (determined by variable models_fanout_threshold, default 3)\n    -- Note: only counts \"leaf children\" - direct chilren that are models AND are child-less (are at the right-most-point in the DAG)\nmodel_fanout as (\n    select \n        all_dag_relationships.parent,\n        all_dag_relationships.parent_model_type,\n        all_dag_relationships.child\n    from all_dag_relationships\n    inner join models_without_children\n        on all_dag_relationships.child = models_without_children.parent\n    where all_dag_relationships.distance = 1 and all_dag_relationships.child_resource_type = 'model'\n    group by 1, 2, 3\n    -- we order the CTE so that listagg returns values correctly sorted for some warehouses\n    order by 1, 2, 3\n),\n\nmodel_fanout_agg as (\n    select\n        parent,\n        parent_model_type,\n        \n    string_agg(\n        child,\n        ', '\n        \n        ) as leaf_children\n    from model_fanout\n    group by 1, 2\n    having count(*) >= 3\n)\n\nselect * from model_fanout_agg\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_model_fanout\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:05.729079Z", "completed_at": "2025-03-24T09:38:05.735710Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:05.736160Z", "completed_at": "2025-03-24T09:38:05.972631Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2603788375854492, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_marts_or_intermediate_dependent_on_source", "compiled": true, "compiled_code": "-- cases where a marts/intermediate model directly references a raw source\nwith direct_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where distance = 1\n    and not parent_is_excluded\n    and not child_is_excluded\n),\nfinal as (\n    select\n        parent,\n        parent_resource_type,\n        child,\n        child_model_type\n    from direct_relationships\n    where parent_resource_type = 'source'\n    and child_model_type in ('marts', 'intermediate')\n)\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_marts_or_intermediate_dependent_on_source\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:05.791000Z", "completed_at": "2025-03-24T09:38:05.809045Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:05.809651Z", "completed_at": "2025-03-24T09:38:06.035291Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.254896879196167, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_multiple_sources_joined", "compiled": true, "compiled_code": "-- this model finds cases where a model references more than one source\nwith direct_source_relationships as (\n    select distinct\n        child,\n        parent\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where distance = 1\n    and parent_resource_type = 'source'\n    and not parent_is_excluded\n    and not child_is_excluded\n    -- we order the CTE so that listagg returns values correctly sorted for some warehouses\n    order by 1, 2\n),\n\nmultiple_sources_joined as (\n    select\n        child,\n        \n    string_agg(\n        parent,\n        ', '\n        \n        ) as source_parents\n    from direct_source_relationships\n    group by 1\n    having count(*) > 1\n)\n\nselect * from multiple_sources_joined\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_multiple_sources_joined\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:05.995631Z", "completed_at": "2025-03-24T09:38:06.007425Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:06.009548Z", "completed_at": "2025-03-24T09:38:06.173402Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.18582677841186523, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_rejoining_of_upstream_concepts", "compiled": true, "compiled_code": "with all_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where parent_resource_type not in ('exposure', 'metric')\n    and child_resource_type not in ('exposure', 'metric')\n    and not parent_is_excluded\n    and not child_is_excluded\n),\n\n-- all parent/child relationships where the parent is BOTH the direct parent of the child and the second level parent of the child \nrejoined as (\n    select\n        parent,\n        child\n    from all_relationships\n    group by 1, 2\n    having (sum(case when distance = 1 then 1 else 0 end) >= 1 \n        and sum(case when distance = 2 then 1 else 0 end) >= 1)\n),\n\n-- resources with only one direct child\nsingle_use_resources as (\n    select\n        parent\n    from all_relationships\n    where distance = 1\n    group by 1\n    having count(*) = 1\n),\n\n-- all cases where one of the parent's direct children (child) is ALSO the direct child of ANOTHER one of the parent's direct childen (parent_and_child)\ntriad_relationships as (\n    select \n        rejoined.parent,\n        rejoined.child,\n        direct_child.parent as parent_and_child\n    from rejoined\n    left join all_relationships as direct_child\n        on rejoined.child = direct_child.child\n        and direct_child.distance = 1\n    left join all_relationships as direct_parent\n        on rejoined.parent = direct_parent.parent\n        and direct_parent.distance = 1\n    where direct_child.parent = direct_parent.child\n),\n\n-- additionally, only includes cases where the model \"in between\" the parent and parent_and_child has NO other downstream dependencies\n-- Note: when the \"in between\" model DOES have downstream dependencies, it's possible this DAG choice has been made to avoid duplicated code and as such is OKAY\nfinal as (\n    select\n        triad_relationships.*,\n        case \n            when single_use_resources.parent is not null then true \n            else false\n        end as is_loop_independent\n    from triad_relationships\n    left join single_use_resources \n        on triad_relationships.parent_and_child = single_use_resources.parent\n),\n\nfinal_filtered as (\n    select * from final\n    where is_loop_independent\n)\n\nselect * from final_filtered\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_rejoining_of_upstream_concepts\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:06.029727Z", "completed_at": "2025-03-24T09:38:06.036902Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:06.037503Z", "completed_at": "2025-03-24T09:38:06.237344Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.21797537803649902, "adapter_response": {"_message": "SELECT 4", "code": "SELECT", "rows_affected": 4}, "message": "SELECT 4", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_root_models", "compiled": true, "compiled_code": "-- this model finds cases where a model has 0 direct parents, likely due to a lack of source or ref function\n\nwith model_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where child_resource_type = 'model'\n    -- only filter out excluded children nodes\n        -- filtering parents could result in incorrectly flagging nodes that depend on excluded nodes\n    and not child_is_excluded\n    -- exclude required time spine\n    and child != 'metricflow_time_spine'\n),\n\nfinal as (\n    select\n        child\n    from model_relationships\n    group by 1\n    having max(distance) = 0\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_root_models\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:06.065205Z", "completed_at": "2025-03-24T09:38:06.074519Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:06.076414Z", "completed_at": "2025-03-24T09:38:06.240358Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.18382525444030762, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_staging_dependent_on_marts_or_intermediate", "compiled": true, "compiled_code": "-- cases where a staging model depends on a marts/intermediate model\n-- data should flow from raw -> staging -> intermediate -> marts\nwith direct_model_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where distance = 1\n    and parent_resource_type = 'model'\n    and child_resource_type = 'model'\n    and not parent_is_excluded\n    and not child_is_excluded\n),\nfinal as (\n    select\n        parent,\n        parent_model_type,\n        child,\n        child_model_type\n    from direct_model_relationships\n    where child_model_type = 'staging'\n    and parent_model_type in ('marts', 'intermediate')\n)\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_staging_dependent_on_marts_or_intermediate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:06.021955Z", "completed_at": "2025-03-24T09:38:06.056464Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:06.058005Z", "completed_at": "2025-03-24T09:38:06.235416Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2245495319366455, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_source_fanout", "compiled": true, "compiled_code": "-- this model finds cases where a source is used in multiple direct downstream models\nwith direct_source_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where distance = 1\n    and parent_resource_type = 'source'\n    and child_resource_type = 'model'\n    and not parent_is_excluded\n    and not child_is_excluded\n    -- we order the CTE so that listagg returns values correctly sorted for some warehouses\n    order by child\n),\n\nsource_fanout as (\n    select\n        parent,\n        \n    string_agg(\n        child,\n        ', '\n        \n        ) as model_children\n    from direct_source_relationships\n    group by 1\n    having count(*) > 1\n)\n\nselect * from source_fanout\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_source_fanout\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:06.194362Z", "completed_at": "2025-03-24T09:38:06.201429Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:06.204475Z", "completed_at": "2025-03-24T09:38:06.333635Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.14071226119995117, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_staging_dependent_on_staging", "compiled": true, "compiled_code": "-- check for cases where models in the staging layer are dependent on each other\nwith direct_model_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where parent_resource_type in ('model', 'snapshot')\n    and child_resource_type in ('model', 'snapshot')\n    and not parent_is_excluded\n    and not child_is_excluded\n    and distance = 1\n),\n\nbending_connections as (\n    select\n        parent,\n        parent_model_type,\n        child,\n        child_model_type\n    from direct_model_relationships\n    where parent_model_type = 'staging'\n    and child_model_type = 'staging'\n)\n\nselect * from bending_connections\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_staging_dependent_on_staging\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:06.250982Z", "completed_at": "2025-03-24T09:38:06.271466Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:06.273050Z", "completed_at": "2025-03-24T09:38:06.410546Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.1643061637878418, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": "SELECT 1", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_too_many_joins", "compiled": true, "compiled_code": "with all_dag_relationships as (\n    select\n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where not child_is_excluded\n    and child_resource_type = 'model'\n),\n\nfinal as (\n    select\n        child as resource_name,\n        child_file_path as file_path,\n        cast(count(distinct parent) as integer) as join_count\n    from all_dag_relationships\n    where distance = 1\n    group by 1, 2\n    having count(distinct parent) >= 7\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_too_many_joins\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:06.262398Z", "completed_at": "2025-03-24T09:38:06.283050Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:06.289406Z", "completed_at": "2025-03-24T09:38:06.416115Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.15950584411621094, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_missing_primary_key_tests", "compiled": true, "compiled_code": "with\n\ntests as (\n    select * from \"nerd_facts\".\"public\".\"int_model_test_summary\"\n    where resource_type in\n    (\n        'model'\n        \n    )\n),\n\nfinal as (\n\n    select\n        resource_name,\n        resource_type,\n        model_type,\n        is_primary_key_tested,\n        number_of_tests_on_model,\n        number_of_constraints_on_model\n    from tests\n    where not(is_primary_key_tested)\n\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_missing_primary_key_tests\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:06.284399Z", "completed_at": "2025-03-24T09:38:06.296995Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:06.298324Z", "completed_at": "2025-03-24T09:38:06.437225Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.17556500434875488, "adapter_response": {"_message": "SELECT 20", "code": "SELECT", "rows_affected": 20}, "message": "SELECT 20", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_unused_sources", "compiled": true, "compiled_code": "-- this model finds cases where a source has no children\n\nwith source_relationships as (\n    select  \n        *\n    from \"nerd_facts\".\"public\".\"int_all_dag_relationships\"\n    where parent_resource_type = 'source'\n    and not parent_is_excluded\n    and not child_is_excluded\n),\n\nfinal as (\n    select\n        parent\n    from source_relationships\n    group by 1\n    having max(distance) = 0\n)\n\nselect * from final\n\n\n\n    \n\n    \n    \n\n    \n\n    \n\n", "relation_name": "\"nerd_facts\".\"public\".\"fct_unused_sources\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T09:38:06.353124Z", "completed_at": "2025-03-24T09:38:06.376192Z"}, {"name": "execute", "started_at": "2025-03-24T09:38:06.379887Z", "completed_at": "2025-03-24T09:38:06.448184Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.09988641738891602, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.dbt_project_evaluator.fct_test_coverage", "compiled": true, "compiled_code": "with\n\ntest_counts as (\n    select * from \"nerd_facts\".\"public\".\"int_model_test_summary\"\n    where resource_type = 'model'\n),\n\nconversion as (\n    select\n        resource_name,\n        cast(case when number_of_tests_on_model > 0 then 1 else 0 end as boolean) as is_tested_model,\n        \n            case when model_type = 'base' then 1.0 else NULL end as is_base_model,\n            case when number_of_tests_on_model > 0 and model_type = 'base' then 1.0 else 0 end as is_tested_base_model,\n        \n            case when model_type = 'staging' then 1.0 else NULL end as is_staging_model,\n            case when number_of_tests_on_model > 0 and model_type = 'staging' then 1.0 else 0 end as is_tested_staging_model,\n        \n            case when model_type = 'intermediate' then 1.0 else NULL end as is_intermediate_model,\n            case when number_of_tests_on_model > 0 and model_type = 'intermediate' then 1.0 else 0 end as is_tested_intermediate_model,\n        \n            case when model_type = 'marts' then 1.0 else NULL end as is_marts_model,\n            case when number_of_tests_on_model > 0 and model_type = 'marts' then 1.0 else 0 end as is_tested_marts_model,\n        \n            case when model_type = 'other' then 1.0 else NULL end as is_other_model,\n            case when number_of_tests_on_model > 0 and model_type = 'other' then 1.0 else 0 end as is_tested_other_model\n        \n\n    from test_counts\n),\n\nfinal as (\n    select\n        now() as measured_at,\n        cast(count(*) as integer) as total_models,\n        cast(sum(number_of_tests_on_model) as integer) as total_tests,\n        sum(cast(is_tested_model as integer)) as tested_models,\n        round(sum(cast(is_tested_model as integer)) * 100.0 / count(*), 2) as test_coverage_pct,\n        \n            round(\n                \n    ( sum(is_tested_base_model) * 100.0 ) / nullif( ( count(is_base_model) ), 0)\n\n            , 2) as base_test_coverage_pct,\n        \n            round(\n                \n    ( sum(is_tested_staging_model) * 100.0 ) / nullif( ( count(is_staging_model) ), 0)\n\n            , 2) as staging_test_coverage_pct,\n        \n            round(\n                \n    ( sum(is_tested_intermediate_model) * 100.0 ) / nullif( ( count(is_intermediate_model) ), 0)\n\n            , 2) as intermediate_test_coverage_pct,\n        \n            round(\n                \n    ( sum(is_tested_marts_model) * 100.0 ) / nullif( ( count(is_marts_model) ), 0)\n\n            , 2) as marts_test_coverage_pct,\n        \n            round(\n                \n    ( sum(is_tested_other_model) * 100.0 ) / nullif( ( count(is_other_model) ), 0)\n\n            , 2) as other_test_coverage_pct,\n        \n        round(sum(number_of_tests_on_model) * 1.0000 / count(*), 4) as test_to_model_ratio\n\n    from test_counts\n    left join conversion\n    on test_counts.resource_name = conversion.resource_name\n)\n\nselect * from final", "relation_name": "\"nerd_facts\".\"public\".\"fct_test_coverage\"", "batch_results": null}], "elapsed_time": 16.17685317993164, "args": {"write_json": true, "invocation_command": "dbt run", "warn_error_options": {"include": [], "exclude": []}, "project_dir": "/home/janne/nerd-facts-dbt/dbt_project", "log_format_file": "debug", "log_file_max_bytes": 10485760, "macro_debugging": false, "send_anonymous_usage_stats": true, "strict_mode": false, "defer": false, "select": [], "require_explicit_package_overrides_for_builtin_materializations": true, "skip_nodes_if_on_run_start_fails": false, "require_resource_names_without_spaces": false, "source_freshness_run_project_hooks": false, "quiet": false, "favor_state": false, "use_colors_file": true, "which": "run", "indirect_selection": "eager", "printer_width": 80, "empty": false, "profiles_dir": "/home/janne/nerd-facts-dbt/dbt_project", "cache_selected_only": false, "vars": {}, "use_colors": true, "populate_cache": true, "state_modified_compare_vars": false, "exclude": [], "log_level_file": "debug", "state_modified_compare_more_unrendered_values": false, "require_batched_execution_for_custom_microbatch_strategy": false, "partial_parse_file_diff": true, "log_path": "/home/janne/nerd-facts-dbt/dbt_project/logs", "log_format": "default", "static_parser": true, "print": true, "require_nested_cumulative_type_params": false, "introspect": true, "partial_parse": true, "version_check": true, "log_level": "info", "require_yaml_configuration_for_mf_time_spines": false, "show_resource_report": false}}